"use strict";var e=require("obsidian");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function t(e,t,s,i){return new(s||(s=Promise))((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function d(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,d)}l((i=i.apply(e,t||[])).next())}))}function s(e,t,s){var i=void 0===t?null:t,n=function(e,t){var s=atob(e);if(t){for(var i=new Uint8Array(s.length),n=0,a=s.length;n<a;++n)i[n]=s.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return s}(e,void 0!==s&&s),a=n.indexOf("\n",10)+1,o=n.substring(a)+(i?"//# sourceMappingURL="+i:""),d=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(d)}var i,n,a,o,d=(i="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIGU9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTt2YXIgcixuLG8sdD17ZXhwb3J0czp7fX07bj1lLG89ZnVuY3Rpb24oKXt2YXIgZT0idW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdyxyPW5ldyBNYXAsbj1uZXcgTWFwLG89W107by50b3RhbD0wO3ZhciB0PVtdLGk9W107ZnVuY3Rpb24gYSgpe3IuY2xlYXIoKSxuLmNsZWFyKCksdD1bXSxpPVtdfWZ1bmN0aW9uIGwoZSl7Zm9yKHZhciByPS05MDA3MTk5MjU0NzQwOTkxLG49ZS5sZW5ndGgtMTtuPj0wOy0tbil7dmFyIG89ZVtuXTtpZihudWxsIT09byl7dmFyIHQ9by5zY29yZTt0PnImJihyPXQpfX1yZXR1cm4tOTAwNzE5OTI1NDc0MDk5MT09PXI/bnVsbDpyfWZ1bmN0aW9uIHMoZSxyKXt2YXIgbj1lW3JdO2lmKHZvaWQgMCE9PW4pcmV0dXJuIG47dmFyIG89cjtBcnJheS5pc0FycmF5KHIpfHwobz1yLnNwbGl0KCIuIikpO2Zvcih2YXIgdD1vLmxlbmd0aCxpPS0xO2UmJisraTx0OyllPWVbb1tpXV07cmV0dXJuIGV9ZnVuY3Rpb24gZihlKXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIGV9dmFyIHU9ZnVuY3Rpb24oKXt2YXIgZT1bXSxyPTAsbj17fTtmdW5jdGlvbiBvKCl7Zm9yKHZhciBuPTAsbz1lW25dLHQ9MTt0PHI7KXt2YXIgaT10KzE7bj10LGk8ciYmZVtpXS5zY29yZTxlW3RdLnNjb3JlJiYobj1pKSxlW24tMT4+MV09ZVtuXSx0PTErKG48PDEpfWZvcih2YXIgYT1uLTE+PjE7bj4wJiZvLnNjb3JlPGVbYV0uc2NvcmU7YT0obj1hKS0xPj4xKWVbbl09ZVthXTtlW25dPW99cmV0dXJuIG4uYWRkPWZ1bmN0aW9uKG4pe3ZhciBvPXI7ZVtyKytdPW47Zm9yKHZhciB0PW8tMT4+MTtvPjAmJm4uc2NvcmU8ZVt0XS5zY29yZTt0PShvPXQpLTE+PjEpZVtvXT1lW3RdO2Vbb109bn0sbi5wb2xsPWZ1bmN0aW9uKCl7aWYoMCE9PXIpe3ZhciBuPWVbMF07cmV0dXJuIGVbMF09ZVstLXJdLG8oKSxufX0sbi5wZWVrPWZ1bmN0aW9uKG4pe2lmKDAhPT1yKXJldHVybiBlWzBdfSxuLnJlcGxhY2VUb3A9ZnVuY3Rpb24ocil7ZVswXT1yLG8oKX0sbn0scD11KCk7cmV0dXJuIGZ1bmN0aW9uIGQoYyl7dmFyIGc9e3NpbmdsZTpmdW5jdGlvbihlLHIsbil7cmV0dXJuIGU/KGYoZSl8fChlPWcuZ2V0UHJlcGFyZWRTZWFyY2goZSkpLHI/KGYocil8fChyPWcuZ2V0UHJlcGFyZWQocikpLCgobiYmdm9pZCAwIT09bi5hbGxvd1R5cG8/bi5hbGxvd1R5cG86IWN8fHZvaWQgMD09PWMuYWxsb3dUeXBvfHxjLmFsbG93VHlwbyk/Zy5hbGdvcml0aG06Zy5hbGdvcml0aG1Ob1R5cG8pKGUscixlWzBdKSk6bnVsbCk6bnVsbH0sZ286ZnVuY3Rpb24oZSxyLG4pe2lmKCFlKXJldHVybiBvO3ZhciB0PShlPWcucHJlcGFyZVNlYXJjaChlKSlbMF0saT1uJiZuLnRocmVzaG9sZHx8YyYmYy50aHJlc2hvbGR8fC05MDA3MTk5MjU0NzQwOTkxLGE9biYmbi5saW1pdHx8YyYmYy5saW1pdHx8OTAwNzE5OTI1NDc0MDk5MSx1PShuJiZ2b2lkIDAhPT1uLmFsbG93VHlwbz9uLmFsbG93VHlwbzohY3x8dm9pZCAwPT09Yy5hbGxvd1R5cG98fGMuYWxsb3dUeXBvKT9nLmFsZ29yaXRobTpnLmFsZ29yaXRobU5vVHlwbyxkPTAsdj0wLGg9ci5sZW5ndGg7aWYobiYmbi5rZXlzKWZvcih2YXIgdz1uLnNjb3JlRm58fGwseD1uLmtleXMseT14Lmxlbmd0aCxtPWgtMTttPj0wOy0tbSl7Zm9yKHZhciBUPXJbbV0saz1uZXcgQXJyYXkoeSksYj15LTE7Yj49MDstLWIpKEI9cyhULEM9eFtiXSkpPyhmKEIpfHwoQj1nLmdldFByZXBhcmVkKEIpKSxrW2JdPXUoZSxCLHQpKTprW2JdPW51bGw7ay5vYmo9VDt2YXIgST13KGspO251bGwhPT1JJiYoSTxpfHwoay5zY29yZT1JLGQ8YT8ocC5hZGQoayksKytkKTooKyt2LEk+cC5wZWVrKCkuc2NvcmUmJnAucmVwbGFjZVRvcChrKSkpKX1lbHNlIGlmKG4mJm4ua2V5KXt2YXIgQz1uLmtleTtmb3IobT1oLTE7bT49MDstLW0pKEI9cyhUPXJbbV0sQykpJiYoZihCKXx8KEI9Zy5nZXRQcmVwYXJlZChCKSksbnVsbCE9PShfPXUoZSxCLHQpKSYmKF8uc2NvcmU8aXx8KF89e3RhcmdldDpfLnRhcmdldCxfdGFyZ2V0TG93ZXJDb2RlczpudWxsLF9uZXh0QmVnaW5uaW5nSW5kZXhlczpudWxsLHNjb3JlOl8uc2NvcmUsaW5kZXhlczpfLmluZGV4ZXMsb2JqOlR9LGQ8YT8ocC5hZGQoXyksKytkKTooKyt2LF8uc2NvcmU+cC5wZWVrKCkuc2NvcmUmJnAucmVwbGFjZVRvcChfKSkpKSl9ZWxzZSBmb3IobT1oLTE7bT49MDstLW0pe3ZhciBCLF87KEI9clttXSkmJihmKEIpfHwoQj1nLmdldFByZXBhcmVkKEIpKSxudWxsIT09KF89dShlLEIsdCkpJiYoXy5zY29yZTxpfHwoZDxhPyhwLmFkZChfKSwrK2QpOigrK3YsXy5zY29yZT5wLnBlZWsoKS5zY29yZSYmcC5yZXBsYWNlVG9wKF8pKSkpKX1pZigwPT09ZClyZXR1cm4gbzt2YXIgQT1uZXcgQXJyYXkoZCk7Zm9yKG09ZC0xO20+PTA7LS1tKUFbbV09cC5wb2xsKCk7cmV0dXJuIEEudG90YWw9ZCt2LEF9LGdvQXN5bmM6ZnVuY3Rpb24ocixuLHQpe3ZhciBpPSExLGE9bmV3IFByb21pc2UoKGZ1bmN0aW9uKGEscCl7aWYoIXIpcmV0dXJuIGEobyk7dmFyIGQ9KHI9Zy5wcmVwYXJlU2VhcmNoKHIpKVswXSx2PXUoKSxoPW4ubGVuZ3RoLTEsdz10JiZ0LnRocmVzaG9sZHx8YyYmYy50aHJlc2hvbGR8fC05MDA3MTk5MjU0NzQwOTkxLHg9dCYmdC5saW1pdHx8YyYmYy5saW1pdHx8OTAwNzE5OTI1NDc0MDk5MSx5PSh0JiZ2b2lkIDAhPT10LmFsbG93VHlwbz90LmFsbG93VHlwbzohY3x8dm9pZCAwPT09Yy5hbGxvd1R5cG98fGMuYWxsb3dUeXBvKT9nLmFsZ29yaXRobTpnLmFsZ29yaXRobU5vVHlwbyxtPTAsVD0wO2Z1bmN0aW9uIGsoKXtpZihpKXJldHVybiBwKCJjYW5jZWxlZCIpO3ZhciB1PURhdGUubm93KCk7aWYodCYmdC5rZXlzKWZvcih2YXIgYz10LnNjb3JlRm58fGwsYj10LmtleXMsST1iLmxlbmd0aDtoPj0wOy0taCl7Zm9yKHZhciBDPW5baF0sQj1uZXcgQXJyYXkoSSksXz1JLTE7Xz49MDstLV8pKFA9cyhDLEw9YltfXSkpPyhmKFApfHwoUD1nLmdldFByZXBhcmVkKFApKSxCW19dPXkocixQLGQpKTpCW19dPW51bGw7Qi5vYmo9Qzt2YXIgQT1jKEIpO2lmKG51bGwhPT1BJiYhKEE8dykmJihCLnNjb3JlPUEsbTx4Pyh2LmFkZChCKSwrK20pOigrK1QsQT52LnBlZWsoKS5zY29yZSYmdi5yZXBsYWNlVG9wKEIpKSxoJTFlMz09MCYmRGF0ZS5ub3coKS11Pj0xMCkpcmV0dXJuIHZvaWQoZT9zZXRJbW1lZGlhdGUoayk6c2V0VGltZW91dChrKSl9ZWxzZSBpZih0JiZ0LmtleSl7Zm9yKHZhciBMPXQua2V5O2g+PTA7LS1oKWlmKChQPXMoQz1uW2hdLEwpKSYmKGYoUCl8fChQPWcuZ2V0UHJlcGFyZWQoUCkpLG51bGwhPT0oaj15KHIsUCxkKSkmJiEoai5zY29yZTx3KSYmKGo9e3RhcmdldDpqLnRhcmdldCxfdGFyZ2V0TG93ZXJDb2RlczpudWxsLF9uZXh0QmVnaW5uaW5nSW5kZXhlczpudWxsLHNjb3JlOmouc2NvcmUsaW5kZXhlczpqLmluZGV4ZXMsb2JqOkN9LG08eD8odi5hZGQoaiksKyttKTooKytULGouc2NvcmU+di5wZWVrKCkuc2NvcmUmJnYucmVwbGFjZVRvcChqKSksaCUxZTM9PTAmJkRhdGUubm93KCktdT49MTApKSlyZXR1cm4gdm9pZChlP3NldEltbWVkaWF0ZShrKTpzZXRUaW1lb3V0KGspKX1lbHNlIGZvcig7aD49MDstLWgpe3ZhciBQLGo7aWYoKFA9bltoXSkmJihmKFApfHwoUD1nLmdldFByZXBhcmVkKFApKSxudWxsIT09KGo9eShyLFAsZCkpJiYhKGouc2NvcmU8dykmJihtPHg/KHYuYWRkKGopLCsrbSk6KCsrVCxqLnNjb3JlPnYucGVlaygpLnNjb3JlJiZ2LnJlcGxhY2VUb3AoaikpLGglMWUzPT0wJiZEYXRlLm5vdygpLXU+PTEwKSkpcmV0dXJuIHZvaWQoZT9zZXRJbW1lZGlhdGUoayk6c2V0VGltZW91dChrKSl9aWYoMD09PW0pcmV0dXJuIGEobyk7Zm9yKHZhciBOPW5ldyBBcnJheShtKSxTPW0tMTtTPj0wOy0tUylOW1NdPXYucG9sbCgpO04udG90YWw9bStULGEoTil9ZT9zZXRJbW1lZGlhdGUoayk6aygpfSkpO3JldHVybiBhLmNhbmNlbD1mdW5jdGlvbigpe2k9ITB9LGF9LGhpZ2hsaWdodDpmdW5jdGlvbihlLHIsbil7aWYobnVsbD09PWUpcmV0dXJuIG51bGw7dm9pZCAwPT09ciYmKHI9IjxiPiIpLHZvaWQgMD09PW4mJihuPSI8L2I+Iik7Zm9yKHZhciBvPSIiLHQ9MCxpPSExLGE9ZS50YXJnZXQsbD1hLmxlbmd0aCxzPWUuaW5kZXhlcyxmPTA7ZjxsOysrZil7dmFyIHU9YVtmXTtpZihzW3RdPT09Zil7aWYoaXx8KGk9ITAsbys9ciksKyt0PT09cy5sZW5ndGgpe28rPXUrbithLnN1YnN0cihmKzEpO2JyZWFrfX1lbHNlIGkmJihpPSExLG8rPW4pO28rPXV9cmV0dXJuIG99LHByZXBhcmU6ZnVuY3Rpb24oZSl7aWYoZSlyZXR1cm57dGFyZ2V0OmUsX3RhcmdldExvd2VyQ29kZXM6Zy5wcmVwYXJlTG93ZXJDb2RlcyhlKSxfbmV4dEJlZ2lubmluZ0luZGV4ZXM6bnVsbCxzY29yZTpudWxsLGluZGV4ZXM6bnVsbCxvYmo6bnVsbH19LHByZXBhcmVTbG93OmZ1bmN0aW9uKGUpe2lmKGUpcmV0dXJue3RhcmdldDplLF90YXJnZXRMb3dlckNvZGVzOmcucHJlcGFyZUxvd2VyQ29kZXMoZSksX25leHRCZWdpbm5pbmdJbmRleGVzOmcucHJlcGFyZU5leHRCZWdpbm5pbmdJbmRleGVzKGUpLHNjb3JlOm51bGwsaW5kZXhlczpudWxsLG9iajpudWxsfX0scHJlcGFyZVNlYXJjaDpmdW5jdGlvbihlKXtpZihlKXJldHVybiBnLnByZXBhcmVMb3dlckNvZGVzKGUpfSxnZXRQcmVwYXJlZDpmdW5jdGlvbihlKXtpZihlLmxlbmd0aD45OTkpcmV0dXJuIGcucHJlcGFyZShlKTt2YXIgbj1yLmdldChlKTtyZXR1cm4gdm9pZCAwIT09bnx8KG49Zy5wcmVwYXJlKGUpLHIuc2V0KGUsbikpLG59LGdldFByZXBhcmVkU2VhcmNoOmZ1bmN0aW9uKGUpe2lmKGUubGVuZ3RoPjk5OSlyZXR1cm4gZy5wcmVwYXJlU2VhcmNoKGUpO3ZhciByPW4uZ2V0KGUpO3JldHVybiB2b2lkIDAhPT1yfHwocj1nLnByZXBhcmVTZWFyY2goZSksbi5zZXQoZSxyKSkscn0sYWxnb3JpdGhtOmZ1bmN0aW9uKGUscixuKXtmb3IodmFyIG89ci5fdGFyZ2V0TG93ZXJDb2RlcyxhPWUubGVuZ3RoLGw9by5sZW5ndGgscz0wLGY9MCx1PTAscD0wOzspe2lmKG49PT1vW2ZdKXtpZih0W3ArK109ZiwrK3M9PT1hKWJyZWFrO249ZVswPT09dT9zOnU9PT1zP3MrMTp1PT09cy0xP3MtMTpzXX1pZigrK2Y+PWwpZm9yKDs7KXtpZihzPD0xKXJldHVybiBudWxsO2lmKDA9PT11KXtpZihuPT09ZVstLXNdKWNvbnRpbnVlO3U9c31lbHNle2lmKDE9PT11KXJldHVybiBudWxsO2lmKChuPWVbMSsocz0tLXUpXSk9PT1lW3NdKWNvbnRpbnVlfWY9dFsocD1zKS0xXSsxO2JyZWFrfX1zPTA7dmFyIGQ9MCxjPSExLHY9MCxoPXIuX25leHRCZWdpbm5pbmdJbmRleGVzO251bGw9PT1oJiYoaD1yLl9uZXh0QmVnaW5uaW5nSW5kZXhlcz1nLnByZXBhcmVOZXh0QmVnaW5uaW5nSW5kZXhlcyhyLnRhcmdldCkpO3ZhciB3PWY9MD09PXRbMF0/MDpoW3RbMF0tMV07aWYoZiE9PWwpZm9yKDs7KWlmKGY+PWwpe2lmKHM8PTApe2lmKCsrZD5hLTIpYnJlYWs7aWYoZVtkXT09PWVbZCsxXSljb250aW51ZTtmPXc7Y29udGludWV9LS1zLGY9aFtpWy0tdl1dfWVsc2UgaWYoZVswPT09ZD9zOmQ9PT1zP3MrMTpkPT09cy0xP3MtMTpzXT09PW9bZl0pe2lmKGlbdisrXT1mLCsrcz09PWEpe2M9ITA7YnJlYWt9KytmfWVsc2UgZj1oW2ZdO2lmKGMpdmFyIHg9aSx5PXY7ZWxzZSB4PXQseT1wO2Zvcih2YXIgbT0wLFQ9LTEsaz0wO2s8YTsrK2spVCE9PShmPXhba10pLTEmJihtLT1mKSxUPWY7Zm9yKGM/MCE9PWQmJihtKz0tMjApOihtKj0xZTMsMCE9PXUmJihtKz0tMjApKSxtLT1sLWEsci5zY29yZT1tLHIuaW5kZXhlcz1uZXcgQXJyYXkoeSksaz15LTE7az49MDstLWspci5pbmRleGVzW2tdPXhba107cmV0dXJuIHJ9LGFsZ29yaXRobU5vVHlwbzpmdW5jdGlvbihlLHIsbil7Zm9yKHZhciBvPXIuX3RhcmdldExvd2VyQ29kZXMsYT1lLmxlbmd0aCxsPW8ubGVuZ3RoLHM9MCxmPTAsdT0wOzspe2lmKG49PT1vW2ZdKXtpZih0W3UrK109ZiwrK3M9PT1hKWJyZWFrO249ZVtzXX1pZigrK2Y+PWwpcmV0dXJuIG51bGx9cz0wO3ZhciBwPSExLGQ9MCxjPXIuX25leHRCZWdpbm5pbmdJbmRleGVzO2lmKG51bGw9PT1jJiYoYz1yLl9uZXh0QmVnaW5uaW5nSW5kZXhlcz1nLnByZXBhcmVOZXh0QmVnaW5uaW5nSW5kZXhlcyhyLnRhcmdldCkpLChmPTA9PT10WzBdPzA6Y1t0WzBdLTFdKSE9PWwpZm9yKDs7KWlmKGY+PWwpe2lmKHM8PTApYnJlYWs7LS1zLGY9Y1tpWy0tZF1dfWVsc2UgaWYoZVtzXT09PW9bZl0pe2lmKGlbZCsrXT1mLCsrcz09PWEpe3A9ITA7YnJlYWt9KytmfWVsc2UgZj1jW2ZdO2lmKHApdmFyIHY9aSxoPWQ7ZWxzZSB2PXQsaD11O2Zvcih2YXIgdz0wLHg9LTEseT0wO3k8YTsrK3kpeCE9PShmPXZbeV0pLTEmJih3LT1mKSx4PWY7Zm9yKHB8fCh3Kj0xZTMpLHctPWwtYSxyLnNjb3JlPXcsci5pbmRleGVzPW5ldyBBcnJheShoKSx5PWgtMTt5Pj0wOy0teSlyLmluZGV4ZXNbeV09dlt5XTtyZXR1cm4gcn0scHJlcGFyZUxvd2VyQ29kZXM6ZnVuY3Rpb24oZSl7Zm9yKHZhciByPWUubGVuZ3RoLG49W10sbz1lLnRvTG93ZXJDYXNlKCksdD0wO3Q8cjsrK3Qpblt0XT1vLmNoYXJDb2RlQXQodCk7cmV0dXJuIG59LHByZXBhcmVCZWdpbm5pbmdJbmRleGVzOmZ1bmN0aW9uKGUpe2Zvcih2YXIgcj1lLmxlbmd0aCxuPVtdLG89MCx0PSExLGk9ITEsYT0wO2E8cjsrK2Epe3ZhciBsPWUuY2hhckNvZGVBdChhKSxzPWw+PTY1JiZsPD05MCxmPXN8fGw+PTk3JiZsPD0xMjJ8fGw+PTQ4JiZsPD01Nyx1PXMmJiF0fHwhaXx8IWY7dD1zLGk9Zix1JiYobltvKytdPWEpfXJldHVybiBufSxwcmVwYXJlTmV4dEJlZ2lubmluZ0luZGV4ZXM6ZnVuY3Rpb24oZSl7Zm9yKHZhciByPWUubGVuZ3RoLG49Zy5wcmVwYXJlQmVnaW5uaW5nSW5kZXhlcyhlKSxvPVtdLHQ9blswXSxpPTAsYT0wO2E8cjsrK2EpdD5hP29bYV09dDoodD1uWysraV0sb1thXT12b2lkIDA9PT10P3I6dCk7cmV0dXJuIG99LGNsZWFudXA6YSxuZXc6ZH07cmV0dXJuIGd9KCl9LChyPXQpLmV4cG9ydHM/ci5leHBvcnRzPW8oKTpuLmZ1enp5c29ydD1vKCk7dmFyIGk7IWZ1bmN0aW9uKGUpe2VbZS5Db21tYW5kcz0wXT0iQ29tbWFuZHMiLGVbZS5GaWxlcz0xXT0iRmlsZXMiLGVbZS5UYWdzPTJdPSJUYWdzIn0oaXx8KGk9e30pKSxzZWxmLm9ubWVzc2FnZT1lPT57Y29uc3R7cXVlcnk6cixpdGVtczpufT1lLmRhdGEsW28sLi4uaV09ci5zcGxpdCgiQCIpO2xldCBhPW47aWYoby5pbmNsdWRlcygifHwiKSl7Y29uc3QgZT1vLnNwbGl0KCJ8fCIpLm1hcCgoZT0+ZS50cmltKCkpKTthPW4uZmlsdGVyKChyPT5lLnNvbWUoKGU9PnIudGV4dC5pbmNsdWRlcyhlKSkpKSl9ZWxzZSIiIT09byYmKGE9dC5leHBvcnRzLmdvKG8sbix7a2V5OiJ0ZXh0In0pLm1hcCgoZT0+ZS5vYmopKSk7cmV0dXJuIGkubGVuZ3RoJiYoYT1hLmZpbHRlcigoZT0+ZnVuY3Rpb24oZSxyKXtmb3IobGV0IG49MDtuPHIubGVuZ3RoO24rPTEpe2NvbnN0IG89cltuXTtmb3IobGV0IHI9MDtyPGUubGVuZ3RoO3IrPTEpe2NvbnN0IG49ZVtyXTtpZihuPT09bylyZXR1cm4hMDtjb25zdCB0PWAke299L2A7aWYobi5zdGFydHNXaXRoKHQpKXJldHVybiEwfX1yZXR1cm4hMX0oZS50YWdzLGkpKSkpLHNlbGYucG9zdE1lc3NhZ2UoYSl9fSgpOwoK",n=null,a=!1,function(e){return o=o||s(i,n,a),new Worker(o,e)});class l{constructor(e=[]){this.map=new Map,e.forEach((e=>this.map.set(e.value(),e)))}has(e){return this.map.has(e.value())}add(e){return this.delete(e),this.map.set(e.value(),e)}addAll(e){e.forEach((e=>this.add(e)))}delete(e){this.map.delete(e.value())}values(){return Array.from(this.map.values())}valuesByLastAdd(){return Array.from(this.map.values()).reverse()}}class h{constructor(e,t,s=[]){this.id=e,this.text=t,this.tags=s}value(){return this.id}}class c{constructor(e,t,s,i){this.app=e,this.prevItems=t,this.recentAbovePinned=s.settings.recentAbovePinned,this.plugin=s,this.palette=i,this.allItems=[],this.pinnedItems=[],this.initialized=!1,this.hiddenIds=[],this.keymapHandlers=[]}getTitleText(){return this.titleText}getEmptyStateText(){return this.emptyStateText}getInstructions(){return[]}checkInitialized(){if(!this.initialized)throw new Error("This adapter has not been initialized")}initialize(){this.initialized=!0}mount(){}unmount(){this.keymapHandlers.forEach((e=>this.palette.scope.unregister(e))),this.keymapHandlers=[]}cleanQuery(e){return e}getPinnedItems(){return this.checkInitialized(),this.pinnedItems}getItems(){return this.checkInitialized(),this.allItems}getPrevItems(){return this.prevItems}getSortedItems(){const e=new l(this.getItems()),t=this.recentAbovePinned?this.getPrevItems().values():this.getPinnedItems();return[this.recentAbovePinned?this.getPinnedItems():this.getPrevItems().values(),t].forEach((t=>{t.forEach((t=>{e.has(t)&&e.add(t)}))})),e.valuesByLastAdd()}toggleHideId(e){return t(this,void 0,void 0,(function*(){this.hiddenIds.includes(e)?this.hiddenIds=this.hiddenIds.filter((t=>e!==t)):this.hiddenIds.push(e),this.plugin.settings[this.hiddenIdsSettingsKey]=this.hiddenIds,yield this.plugin.saveSettings(),yield this.plugin.loadSettings(),this.palette.updateSuggestions()}))}}class m{constructor(e,t,s,i=[],n=200){this.app=e,this.id=t,this.name=s,this.commandIds=i,this.delay=n}addCommand(e){this.commandIds.push(e)}removeCommand(e){this.commandIds=this.commandIds.filter((t=>t===e))}commandIsAvailable(e){const t=this.app.commands.findCommand(e);return!t.checkCallback||t.checkCallback(!0)}callAllCommands(){return t(this,void 0,void 0,(function*(){const t=new e.Notice(`Running "${this.name}"...`,1e4);for(let e=0;e<this.commandIds.length;e+=1){const s=this.commandIds[e],i=this.app.commands.findCommand(s);if(!this.commandIsAvailable(s)){t.setMessage(`Error: "${i.name}" cannot be used in this context. The macro is stopping.`);break}t.setMessage(`Running "${i.name}"`),this.app.commands.executeCommandById(s),yield new Promise((e=>{setTimeout(e,this.delay)}))}return t.hide(),new e.Notice(`Successfully ran "${this.name}"`),!0}))}checkCallback(e){return e?this.commandIsAvailable(this.commandIds[0]):(this.callAllCommands(),null)}}const r=new Set(["Alt","Ctrl","Mod","Shift"]),p={Mod:"Ctrl +",Ctrl:"Ctrl +",Meta:"Win +",Alt:"Alt +",Shift:"Shift +",Hyper:"Caps +"},u={Mod:"⌘",Ctrl:"^",Meta:"⌘",Alt:"⌥",Shift:"⇧",Hyper:"⇪"},g={TAB:"↹",ENTER:"↵",ARROWLEFT:"←",ARROWRIGHT:"→",ARROWUP:"↑",ARROWDOWN:"↓",BACKSPACE:"⌫",ESC:"Esc"};var y;function Z(t,s){let i=e.Platform.isMacOS?u:p;"mac"===s.hotkeyStyle?i=u:"windows"===s.hotkeyStyle&&(i=p);const n=[];var a;s.hyperKeyOverride&&(4===(a=t.modifiers).length&&a.every((e=>r.has(e))))?n.push(i.Hyper):t.modifiers.forEach((e=>{n.push(i[e])}));const o=t.key.toUpperCase();return n.push(g[o]||o),n.join(" ")}function b(e){return e.name}function S(t,s){const i=t.getCache(s);if(!i)return[];const n=(i.tags||[]).map((e=>e.tag)),a=e.parseFrontMatterTags(i.frontmatter)||[],o=n.concat(a),d=e.parseFrontMatterAliases(i.frontmatter)||[];return[new h(s,s,o),...d.map((e=>new h(`${e}:${s}`,e,o)))]}!function(e){e[e.Commands=0]="Commands",e[e.Files=1]="Files",e[e.Tags=2]="Tags"}(y||(y={}));class T extends e.FuzzySuggestModal{constructor(e,t){super(e),this.getItemText=b,this.callback=t}getItems(){return Object.values(this.app.commands.commands)}onChooseItem(e){this.callback(e)}}class W extends c{constructor(){super(...arguments),this.COMMAND_PLUGIN_NAME_SEPARATOR=": "}initialize(){super.initialize(),this.titleText="Better Command Palette: Commands",this.emptyStateText="No matching commands.",this.hiddenIds=this.plugin.settings.hiddenCommands,this.hiddenIdsSettingsKey="hiddenCommands",this.allItems=this.app.commands.listCommands().sort(((e,t)=>t.name.localeCompare(e.name))).map((e=>new h(e.id,e.name)));const e=this.app.internalPlugins.getPluginById("command-palette").instance.options.pinned||[];this.pinnedItems=e.reduce(((e,t)=>{const s=this.app.commands.findCommand(t);return s&&e.push(new h(t,s.name)),e}),[]).reverse()}mount(){this.keymapHandlers=[this.palette.scope.register(["Mod"],this.plugin.settings.fileSearchHotkey,(()=>this.palette.changeActionType(y.Files))),this.palette.scope.register(["Mod"],this.plugin.settings.tagSearchHotkey,(()=>this.palette.changeActionType(y.Tags)))]}getInstructions(){return[{command:Z({modifiers:[],key:"ENTER"},this.plugin.settings),purpose:"Run command"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.fileSearchHotkey},this.plugin.settings),purpose:"Search Files"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.tagSearchHotkey},this.plugin.settings),purpose:"Search Tags"}]}renderSuggestion(t,s,i){const n=this.app.commands.findCommand(t.id),a=this.app.hotkeyManager.getHotkeys(n.id),o=this.app.hotkeyManager.getDefaultHotkeys(n.id),d=a||o||[];if(this.getPinnedItems().find((e=>e.id===t.id))){const t=i.querySelector(".suggestion-flair");e.setIcon(t,"filled-pin",13),t.ariaLabel="Pinned",t.onClickEvent((()=>{}))}let{text:l}=t,h="";if(l.includes(this.COMMAND_PLUGIN_NAME_SEPARATOR)){const e=l.split(this.COMMAND_PLUGIN_NAME_SEPARATOR);h=e.shift(),l=e.join(this.COMMAND_PLUGIN_NAME_SEPARATOR)}s.createEl("span",{cls:"suggestion-title",text:l}),h&&this.plugin.settings.showPluginName&&s.createEl("span",{cls:"suggestion-note",text:h}),d.forEach((e=>{i.createEl("kbd",{cls:"suggestion-hotkey",text:Z(e,this.plugin.settings)})}))}onChooseSuggestion(e){return t(this,void 0,void 0,(function*(){this.getPrevItems().add(e),this.app.commands.executeCommandById(e.id)}))}}class P extends c{initialize(){super.initialize(),this.titleText="Better Command Palette: Files",this.emptyStateText="No matching files.",this.fileSearchPrefix=this.plugin.settings.fileSearchPrefix,this.hiddenIds=this.plugin.settings.hiddenFiles,this.hiddenIdsSettingsKey="hiddenFiles",this.allItems=[],this.unresolvedItems=new l,this.app.metadataCache.getCachedFiles().forEach((e=>{if(this.plugin.settings.fileTypeExclusion.some((t=>e.endsWith(`.${t}`))))return;const t=S(this.app.metadataCache,e);this.allItems=this.allItems.concat(t),Object.keys(this.app.metadataCache.unresolvedLinks[e]||{}).forEach((e=>this.unresolvedItems.add(new h(e,e))))})),this.allItems=this.allItems.concat(Array.from(this.unresolvedItems.values())).reverse(),[...this.app.workspace.getLastOpenFiles()].reverse().forEach((e=>{const t=S(this.app.metadataCache,e);t[0]&&this.prevItems.add(t[0])}))}mount(){this.keymapHandlers=[this.palette.scope.register(["Mod"],this.plugin.settings.commandSearchHotkey,(()=>this.palette.changeActionType(y.Commands))),this.palette.scope.register(["Mod"],this.plugin.settings.tagSearchHotkey,(()=>this.palette.changeActionType(y.Tags)))]}getInstructions(){const{createNewPaneMod:e,createNewFileMod:t}=this.plugin.settings;return[{command:Z({modifiers:[],key:"ENTER"},this.plugin.settings),purpose:"Open file"},{command:Z({modifiers:[e],key:"ENTER"},this.plugin.settings),purpose:"Open file in new pane"},{command:Z({modifiers:[t],key:"ENTER"},this.plugin.settings),purpose:"Create file"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.commandSearchHotkey},this.plugin.settings),purpose:"Search Commands"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.tagSearchHotkey},this.plugin.settings),purpose:"Search Tags"}]}cleanQuery(e){return e.replace(this.fileSearchPrefix,"")}renderSuggestion(t,s){const i=s.createEl("div",{cls:"suggestion-title",text:t.text});if(this.unresolvedItems.has(t)&&i.addClass("unresolved"),t.id.includes(":")){i.createEl("span",{cls:"suggestion-name",text:t.text}).ariaLabel="Alias",e.setIcon(i,"right-arrow-with-tail");const[,s]=t.id.split(":");i.createEl("span",{cls:"suggestion-note",text:s})}s.createEl("div",{cls:"suggestion-note",text:`${t.tags.join(" ")}`})}onChooseSuggestion(s,i){return t(this,void 0,void 0,(function*(){let n=s&&s.id;if(s)n.includes(":")&&([,n]=n.split(":"));else{n=i.target.value.replace(this.fileSearchPrefix,"")}const a=yield function(s,i){return t(this,void 0,void 0,(function*(){let t=s.metadataCache.getFirstLinkpathDest(i,"");if(!t){const n=e.normalizePath(`${i}.md`),a=n.split("/").slice(0,-1).join("/");try{yield s.vault.createFolder(a)}catch(e){}t=yield s.vault.create(n,"")}return t}))}(this.app,n);a&&this.getPrevItems().add(s||new h(a.path,a.path)),function(e,t,s,i){const{workspace:n}=e;let a=n.activeLeaf;("Shift"===t.createNewPaneMod?i.shiftKey:i.metaKey)&&(a=n.createLeafBySplit(n.activeLeaf),n.setActiveLeaf(a)),a.openFile(s)}(this.app,this.plugin.settings,a,i)}))}}class v extends c{initialize(){super.initialize(),this.hiddenIds=this.plugin.settings.hiddenTags,this.hiddenIdsSettingsKey="hiddenTags",this.tagSearchPrefix=this.plugin.settings.tagSearchPrefix,this.titleText="Better Command Palette: Tags",this.emptyStateText="No matching tags.",this.allItems=Object.entries(this.app.metadataCache.getTags()).map((([e,t])=>new h(e,e,[t])))}mount(){this.keymapHandlers=[this.palette.scope.register(["Mod"],this.plugin.settings.commandSearchHotkey,(()=>this.palette.changeActionType(y.Commands))),this.palette.scope.register(["Mod"],this.plugin.settings.fileSearchHotkey,(()=>this.palette.changeActionType(y.Files)))]}getInstructions(){return[{command:Z({modifiers:[],key:"ENTER"},this.plugin.settings),purpose:"See file usage"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.commandSearchHotkey},this.plugin.settings),purpose:"Search Commands"},{command:Z({modifiers:["Mod"],key:this.plugin.settings.fileSearchHotkey},this.plugin.settings),purpose:"Search Files"}]}cleanQuery(e){return e.replace(this.tagSearchPrefix,"")}renderSuggestion(e,t,s){t.createEl("span",{cls:"suggestion-content",text:e.text});const i=parseInt(e.tags[0],10);s.createEl("span",{cls:"suggestion-flair",text:`Found in ${i} file${1===i?"":"s"}`})}onChooseSuggestion(e){return t(this,void 0,void 0,(function*(){this.getPrevItems().add(e),this.palette.open(),this.palette.setQuery(`${this.plugin.settings.fileSearchPrefix}@${e.text}`,1)}))}}class X extends e.SuggestModal{constructor(e,t,s,i,n,a=""){super(e),this.toggleHiddenItems=()=>{this.showHiddenItems=!this.showHiddenItems,this.updateSuggestions()},this.fileSearchPrefix=i.settings.fileSearchPrefix,this.tagSearchPrefix=i.settings.tagSearchPrefix,this.suggestionLimit=i.settings.suggestionLimit,this.initialInputValue=a,this.plugin=i,this.modalEl.addClass("better-command-palette"),this.setPlaceholder("Select a command"),this.commandAdapter=new W(e,t,i,this),this.fileAdapter=new P(e,new l,i,this),this.tagAdapter=new v(e,s,i,this),this.suggestionsWorker=n,this.suggestionsWorker.onmessage=e=>this.receivedSuggestions(e),this.modalTitleEl=createEl("p",{cls:"better-command-palette-title"}),this.updateActionType(),this.modalEl.insertBefore(this.modalTitleEl,this.modalEl.firstChild),this.hiddenItemsHeaderEl=createEl("p","hidden-items-header"),this.showHiddenItems=!1,this.hiddenItemsHeaderEl.onClickEvent(this.toggleHiddenItems),this.modalEl.insertBefore(this.hiddenItemsHeaderEl,this.resultContainerEl),this.setScopes(i)}close(e){super.close(),e&&e.preventDefault()}setScopes(e){const t=t=>{const s=t.target;e.settings.closeWithBackspace&&""===s.value&&this.close(t)},{createNewPaneMod:s,createNewFileMod:i}=e.settings;this.scope.register([],"Backspace",(e=>{t(e)})),this.scope.register(["Mod"],"Backspace",(e=>{t(e)})),this.scope.register([i],"Enter",(e=>{this.actionType===y.Files&&(this.currentAdapter.onChooseSuggestion(null,e),this.close(e))})),this.scope.register([i,s],"Enter",(e=>{this.actionType===y.Files&&(this.currentAdapter.onChooseSuggestion(null,e),this.close(e))})),this.scope.register([s],"Enter",(e=>{this.actionType===y.Files&&this.currentSuggestions.length&&(this.currentAdapter.onChooseSuggestion(this.currentSuggestions[0],e),this.close(e))})),this.scope.register(["Mod"],"I",this.toggleHiddenItems)}onOpen(){super.onOpen(),this.initialInputValue&&this.setQuery(this.initialInputValue)}changeActionType(e){let t="";e===y.Files?t=this.plugin.settings.fileSearchPrefix:e===y.Tags&&(t=this.plugin.settings.tagSearchPrefix);const s=this.inputEl.value,i=this.currentAdapter.cleanQuery(s);this.inputEl.value=t+i,this.updateSuggestions()}setQuery(e,t=-1){this.inputEl.value=e,t>-1&&this.inputEl.setSelectionRange(t,t),this.updateSuggestions()}updateActionType(){var e;const t=this.inputEl.value;let s,i;t.startsWith(this.fileSearchPrefix)?(i=y.Files,s=this.fileAdapter):t.startsWith(this.tagSearchPrefix)?(i=y.Tags,s=this.tagAdapter):(i=y.Commands,s=this.commandAdapter),i!==this.actionType&&(null===(e=this.currentAdapter)||void 0===e||e.unmount(),this.currentAdapter=s,this.currentAdapter.mount()),this.currentAdapter.initialized||this.currentAdapter.initialize();const n=i!==this.actionType;return this.actionType=i,n&&(this.updateEmptyStateText(),this.updateTitleText(),this.updateInstructions(),this.currentSuggestions=this.currentAdapter.getSortedItems().slice(0,this.suggestionLimit)),n}updateTitleText(){this.plugin.settings.showPluginName?this.modalTitleEl.setText(this.currentAdapter.getTitleText()):this.modalTitleEl.setText("")}updateEmptyStateText(){this.emptyStateText=this.currentAdapter.getEmptyStateText()}updateInstructions(){Array.from(this.modalEl.getElementsByClassName("prompt-instructions")).forEach((e=>{this.modalEl.removeChild(e)})),this.setInstructions([...this.currentAdapter.getInstructions(),{command:Z({modifiers:[],key:"ESC"},this.plugin.settings),purpose:"Close palette"},{command:Z({modifiers:["Mod"],key:"I"},this.plugin.settings),purpose:"Toggle Hidden Items"}])}getItems(){return this.currentAdapter.getSortedItems()}receivedSuggestions(e){const t=[];let s=0;for(let i=0;i<e.data.length&&t.length<this.suggestionLimit+s;i+=1)t.push(e.data[i]),this.currentAdapter.hiddenIds.includes(e.data[i].id)&&(s+=1);const i=t.map((e=>new h(e.id,e.text,e.tags))),n=this.currentAdapter.getPrevItems();i.sort(((e,t)=>+n.has(t)-+n.has(e))),this.currentSuggestions=i,this.limit=this.currentSuggestions.length,this.updateSuggestions()}getSuggestionsAsync(e){const t=this.getItems();this.suggestionsWorker.postMessage({query:e,items:t})}getSuggestions(e){this.updateActionType();const t=e!==this.lastQuery;this.lastQuery=e;const s=this.currentAdapter.cleanQuery(e.trim());t&&this.getSuggestionsAsync(s);const i=this.currentSuggestions.filter((e=>!this.currentAdapter.hiddenIds.includes(e.id))),n=this.currentSuggestions.length-i.length;return this.updateHiddenItemCountHeader(n),this.showHiddenItems?this.currentSuggestions:i}updateHiddenItemCountHeader(e){if(this.hiddenItemsHeaderEl.empty(),0!==e){const t=`${this.showHiddenItems?"Hide":"Show"} hidden items (${e})`;this.hiddenItemsHeaderEl.setText(t)}}renderSuggestion(t,s){s.addClass("mod-complex");const i=this.currentAdapter.hiddenIds.includes(t.id);i&&s.addClass("hidden");const n=s.createEl("span","suggestion-content"),a=s.createEl("span","suggestion-aux"),o=a.createEl("span","suggestion-flair");!function(e,t,s){s.has(e)&&(t.addClass("recent"),t.createEl("span",{cls:"suggestion-note",text:"(recently used)"}))}(t,n,this.currentAdapter.getPrevItems()),e.setIcon(o,"cross",13),o.ariaLabel=i?"Click to Unhide":"Click to Hide",o.setAttr("data-id",t.id),o.onClickEvent((e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.currentAdapter.toggleHideId(t.getAttr("data-id"))})),this.currentAdapter.renderSuggestion(t,n,a)}onChooseSuggestion(e,s){return t(this,void 0,void 0,(function*(){this.currentAdapter.onChooseSuggestion(e,s)}))}}const f={closeWithBackspace:!0,showPluginName:!0,fileSearchPrefix:"/",tagSearchPrefix:"#",commandSearchHotkey:"p",fileSearchHotkey:"o",tagSearchHotkey:"t",suggestionLimit:50,recentAbovePinned:!1,hyperKeyOverride:!1,macros:[],hotkeyStyle:"auto",createNewFileMod:"Mod",createNewPaneMod:"Shift",hiddenCommands:[],hiddenFiles:[],hiddenTags:[],fileTypeExclusion:[]};class I extends e.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){this.containerEl.empty(),this.displayBasicSettings(),this.displayMacroSettings()}displayBasicSettings(){const{containerEl:s}=this,{settings:i}=this.plugin;s.empty(),s.createEl("h2",{text:"Better Command Palette Settings"}),new e.Setting(s).setName("Close on Backspace").setDesc("Close the palette when there is no text and backspace is pressed").addToggle((e=>e.setValue(i.closeWithBackspace).onChange((e=>t(this,void 0,void 0,(function*(){i.closeWithBackspace=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Show Plugin Name").setDesc("Show the plugin name in the command palette").addToggle((e=>e.setValue(i.showPluginName).onChange((e=>t(this,void 0,void 0,(function*(){i.showPluginName=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Recent above Pinned").setDesc("Sorts the suggestion so that the recently used items show before pinned items.").addToggle((e=>e.setValue(i.recentAbovePinned).onChange((e=>t(this,void 0,void 0,(function*(){i.recentAbovePinned=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Caps Lock Hyper Key Hotkey Override").setDesc('For those users who have use a "Hyper Key", enabling this maps the icons "⌥ ^ ⌘ ⇧" to the caps lock icon "⇪" ').addToggle((e=>e.setValue(i.hyperKeyOverride).onChange((e=>t(this,void 0,void 0,(function*(){i.hyperKeyOverride=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Use shift to create files and cmd to open in new panes").setDesc("By default cmd is used to create files and shift is used to open in new panes. This setting reverses that to mimic the functionality of the standard quick switcher").addToggle((e=>e.setValue("Shift"===i.createNewFileMod).onChange((e=>t(this,void 0,void 0,(function*(){i.createNewFileMod=e?"Shift":"Mod",i.createNewPaneMod=e?"Mod":"Shift",yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("File Type Exclusions").setDesc('A comma separated list of file extensions (ex: "pdf,jpg,png") that should not be shown when searching files.').addText((e=>e.setValue(i.fileTypeExclusion.join(",")).onChange((e=>t(this,void 0,void 0,(function*(){const t=e.split(",").map((e=>e.trim()));i.fileTypeExclusion=t,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("File Search Prefix").setDesc("The prefix used to tell the palette you want to search files").addText((e=>e.setValue(i.fileSearchPrefix).onChange((e=>t(this,void 0,void 0,(function*(){i.fileSearchPrefix=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Tag Search Prefix").setDesc("The prefix used to tell the palette you want to search tags").addText((e=>e.setValue(i.tagSearchPrefix).onChange((e=>t(this,void 0,void 0,(function*(){i.tagSearchPrefix=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Command Search Hotkey").setDesc("The hotkey used to switch to command search while using the command palette.").addText((e=>e.setValue(i.commandSearchHotkey).onChange((e=>t(this,void 0,void 0,(function*(){i.commandSearchHotkey=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("File Search Hotkey").setDesc("The hotkey used to switch to file search while using the command palette.").addText((e=>e.setValue(i.fileSearchHotkey).onChange((e=>t(this,void 0,void 0,(function*(){i.fileSearchHotkey=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Tag Search Hotkey").setDesc("The hotkey used to switch to tag search while using the command palette.").addText((e=>e.setValue(i.tagSearchHotkey).onChange((e=>t(this,void 0,void 0,(function*(){i.tagSearchHotkey=e,yield this.plugin.saveSettings()}))))));const n={10:"10",20:"20",50:"50",100:"100",200:"200",500:"500",1e3:"1000"};new e.Setting(s).setName("Suggestion Limit").setDesc("The number of items that will be in the suggestion list of the palette. Really high numbers can affect performance").addDropdown((e=>e.addOptions(n).setValue(i.suggestionLimit.toString()).onChange((e=>t(this,void 0,void 0,(function*(){i.suggestionLimit=parseInt(e,10),yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Hotkey Modifier Style").setDesc("Allows autodetecting of hotkey modifier or forcing to Mac or Windows").addDropdown((e=>e.addOptions({auto:"Auto Detect",mac:"Force Mac Hotkeys",windows:"Force Windows Hotkeys"}).setValue(i.hotkeyStyle).onChange((e=>t(this,void 0,void 0,(function*(){i.hotkeyStyle=e,yield this.plugin.saveSettings()})))))),new e.Setting(s).setName("Add new macro").setDesc("Create a new grouping of commands that can be run together").addButton((e=>e.setButtonText("+").onClick((()=>t(this,void 0,void 0,(function*(){i.macros.push({name:`Macro ${i.macros.length+1}`,commandIds:[],delay:200}),yield this.plugin.saveSettings(),this.display()}))))))}displayMacroSettings(){const{containerEl:s}=this,{settings:i}=this.plugin;i.macros.forEach(((n,a)=>{const o=new e.Setting(s).setClass("macro-setting").setName(`Macro #${a+1}`).addButton((e=>e.setButtonText("Delete Macro").onClick((()=>t(this,void 0,void 0,(function*(){i.macros.splice(a,1),yield this.plugin.saveSettings(),this.display()})))))),d=o.settingEl.createEl("div","macro-main-settings");d.createEl("label",{text:"Macro Name"}),d.createEl("input",{cls:"name-input",type:"text",value:n.name}).on("change",".name-input",(e=>t(this,void 0,void 0,(function*(){const t=e.target;i.macros[a]=Object.assign(Object.assign({},n),{name:t.value}),yield this.plugin.saveSettings()})))),d.createEl("label",{text:"Delay (ms)"}),d.createEl("input",{cls:"delay-input",type:"number",value:n.delay.toString()}).on("change",".delay-input",(e=>t(this,void 0,void 0,(function*(){const t=e.target.value;i.macros[a].delay=parseInt(t,10),yield this.plugin.saveSettings()})))),d.createEl("label",{text:"Add a new Command to the macro"}),d.createEl("button",{text:"Add Command"}).onClickEvent((()=>t(this,void 0,void 0,(function*(){new T(this.app,(e=>t(this,void 0,void 0,(function*(){i.macros[a].commandIds.push(e.id),yield this.plugin.saveSettings(),this.display()})))).open()})))),n.commandIds.forEach(((s,n)=>{const d=this.app.commands.findCommand(s),l=o.settingEl.createEl("div","macro-command"),h=l.createEl("button",`delete-command-${n}`);l.createEl("p",{text:`${n+1}: ${d.name}`,cls:"command"}),e.setIcon(h,"trash"),h.onClickEvent((()=>t(this,void 0,void 0,(function*(){i.macros[a].commandIds.splice(n,1),yield this.plugin.saveSettings(),this.display()}))))}))}))}}class x extends e.Plugin{onload(){return t(this,void 0,void 0,(function*(){console.log("Loading plugin: Better Command Palette"),yield this.loadSettings(),this.prevCommands=new l,this.prevTags=new l,this.suggestionsWorker=new d({}),this.addCommand({id:"open-better-commmand-palette",name:"Open better command palette",hotkeys:[{modifiers:["Mod","Shift"],key:"p"}],callback:()=>{new X(this.app,this.prevCommands,this.prevTags,this,this.suggestionsWorker).open()}}),this.addCommand({id:"open-better-commmand-palette-file-search",name:"Open better command palette: File Search",hotkeys:[],callback:()=>{new X(this.app,this.prevCommands,this.prevTags,this,this.suggestionsWorker,this.settings.fileSearchPrefix).open()}}),this.addCommand({id:"open-better-commmand-palette-tag-search",name:"Open better command palette: Tag Search",hotkeys:[],callback:()=>{new X(this.app,this.prevCommands,this.prevTags,this,this.suggestionsWorker,this.settings.tagSearchPrefix).open()}}),this.addSettingTab(new I(this.app,this))}))}onunload(){this.suggestionsWorker.terminate()}loadMacroCommands(){this.settings.macros.forEach(((e,t)=>{if(!e.name||!e.commandIds.length)return;const s=new m(this.app,`obsidian-better-command-palette-macro-${t}`,e.name,e.commandIds,e.delay);this.addCommand(s),this.prevCommands&&(this.prevCommands=this.prevCommands.values().reduce(((e,t)=>(t.id===s.id&&t.text!==s.name||e.add(t),e)),new l))}))}deleteMacroCommands(){Object.keys(this.app.commands.commands).filter((e=>e.includes("obsidian-better-command-palette-macro-"))).forEach((e=>{this.app.commands.removeCommand(e)}))}loadSettings(){return t(this,void 0,void 0,(function*(){this.settings=Object.assign(Object.assign({},f),yield this.loadData()),this.loadMacroCommands()}))}saveSettings(){return t(this,void 0,void 0,(function*(){this.deleteMacroCommands(),yield this.saveData(this.settings),this.loadMacroCommands()}))}}module.exports=x;
