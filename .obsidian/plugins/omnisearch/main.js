/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Kc=Object.create;var Mr=Object.defineProperty,zc=Object.defineProperties,Vc=Object.getOwnPropertyDescriptor,Hc=Object.getOwnPropertyDescriptors,$c=Object.getOwnPropertyNames,gs=Object.getOwnPropertySymbols,Wc=Object.getPrototypeOf,ys=Object.prototype.hasOwnProperty,Uc=Object.prototype.propertyIsEnumerable;var vs=(t,e,r)=>e in t?Mr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ue=(t,e)=>{for(var r in e||(e={}))ys.call(e,r)&&vs(t,r,e[r]);if(gs)for(var r of gs(e))Uc.call(e,r)&&vs(t,r,e[r]);return t},Oe=(t,e)=>zc(t,Hc(e)),_s=t=>Mr(t,"__esModule",{value:!0});var yn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Gc=(t,e)=>{_s(t);for(var r in e)Mr(t,r,{get:e[r],enumerable:!0})},Qc=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $c(e))!ys.call(t,n)&&n!=="default"&&Mr(t,n,{get:()=>e[n],enumerable:!(r=Vc(e,n))||r.enumerable});return t},Fe=t=>Qc(_s(Mr(t!=null?Kc(Wc(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Ta=yn((un,Po)=>{(function(t,e){if(typeof un=="object"&&typeof Po=="object")Po.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var r=e();for(var n in r)(typeof un=="object"?un:t)[n]=r[n]}})(typeof self!="undefined"?self:un,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(n,i,o){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:o})},r.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var s in n)r.d(o,s,function(a){return n[a]}.bind(null,s));return o},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"md5",function(){return x});var n="0123456789abcdef".split(""),i=function(b){for(var h="",_=0;_<4;_++)h+=n[b>>8*_+4&15]+n[b>>8*_&15];return h},o=function(b){for(var h=b.length,_=0;_<h;_++)b[_]=i(b[_]);return b.join("")},s=function(b,h){return b+h&4294967295},a=function(b,h,_,p,m,v,g){return function(j,C,S){return s(j<<C|j>>>32-C,S)}(h=function(j,C,S,E){return C=s(s(C,j),s(S,E))}(b,h,p,v),m,_)},l=function(b,h,_,p,m,v,g,j){return a(_&p|~_&m,h,_,v,g,j,b)},u=function(b,h,_,p,m,v,g,j){return a(_&m|p&~m,h,_,v,g,j,b)},d=function(b,h,_,p,m,v,g,j){return a(_^p^m,h,_,v,g,j,b)},f=function(b,h,_,p,m,v,g,j){return a(p^(_|~m),h,_,v,g,j,b)},c=function(b,h,_){_===void 0&&(_=s);var p=b[0],m=b[1],v=b[2],g=b[3],j=l.bind(null,_);p=j(p,m,v,g,h[0],7,-680876936),g=j(g,p,m,v,h[1],12,-389564586),v=j(v,g,p,m,h[2],17,606105819),m=j(m,v,g,p,h[3],22,-1044525330),p=j(p,m,v,g,h[4],7,-176418897),g=j(g,p,m,v,h[5],12,1200080426),v=j(v,g,p,m,h[6],17,-1473231341),m=j(m,v,g,p,h[7],22,-45705983),p=j(p,m,v,g,h[8],7,1770035416),g=j(g,p,m,v,h[9],12,-1958414417),v=j(v,g,p,m,h[10],17,-42063),m=j(m,v,g,p,h[11],22,-1990404162),p=j(p,m,v,g,h[12],7,1804603682),g=j(g,p,m,v,h[13],12,-40341101),v=j(v,g,p,m,h[14],17,-1502002290),m=j(m,v,g,p,h[15],22,1236535329);var C=u.bind(null,_);p=C(p,m,v,g,h[1],5,-165796510),g=C(g,p,m,v,h[6],9,-1069501632),v=C(v,g,p,m,h[11],14,643717713),m=C(m,v,g,p,h[0],20,-373897302),p=C(p,m,v,g,h[5],5,-701558691),g=C(g,p,m,v,h[10],9,38016083),v=C(v,g,p,m,h[15],14,-660478335),m=C(m,v,g,p,h[4],20,-405537848),p=C(p,m,v,g,h[9],5,568446438),g=C(g,p,m,v,h[14],9,-1019803690),v=C(v,g,p,m,h[3],14,-187363961),m=C(m,v,g,p,h[8],20,1163531501),p=C(p,m,v,g,h[13],5,-1444681467),g=C(g,p,m,v,h[2],9,-51403784),v=C(v,g,p,m,h[7],14,1735328473),m=C(m,v,g,p,h[12],20,-1926607734);var S=d.bind(null,_);p=S(p,m,v,g,h[5],4,-378558),g=S(g,p,m,v,h[8],11,-2022574463),v=S(v,g,p,m,h[11],16,1839030562),m=S(m,v,g,p,h[14],23,-35309556),p=S(p,m,v,g,h[1],4,-1530992060),g=S(g,p,m,v,h[4],11,1272893353),v=S(v,g,p,m,h[7],16,-155497632),m=S(m,v,g,p,h[10],23,-1094730640),p=S(p,m,v,g,h[13],4,681279174),g=S(g,p,m,v,h[0],11,-358537222),v=S(v,g,p,m,h[3],16,-722521979),m=S(m,v,g,p,h[6],23,76029189),p=S(p,m,v,g,h[9],4,-640364487),g=S(g,p,m,v,h[12],11,-421815835),v=S(v,g,p,m,h[15],16,530742520),m=S(m,v,g,p,h[2],23,-995338651);var E=f.bind(null,_);p=E(p,m,v,g,h[0],6,-198630844),g=E(g,p,m,v,h[7],10,1126891415),v=E(v,g,p,m,h[14],15,-1416354905),m=E(m,v,g,p,h[5],21,-57434055),p=E(p,m,v,g,h[12],6,1700485571),g=E(g,p,m,v,h[3],10,-1894986606),v=E(v,g,p,m,h[10],15,-1051523),m=E(m,v,g,p,h[1],21,-2054922799),p=E(p,m,v,g,h[8],6,1873313359),g=E(g,p,m,v,h[15],10,-30611744),v=E(v,g,p,m,h[6],15,-1560198380),m=E(m,v,g,p,h[13],21,1309151649),p=E(p,m,v,g,h[4],6,-145523070),g=E(g,p,m,v,h[11],10,-1120210379),v=E(v,g,p,m,h[2],15,718787259),m=E(m,v,g,p,h[9],21,-343485551),b[0]=_(p,b[0]),b[1]=_(m,b[1]),b[2]=_(v,b[2]),b[3]=_(g,b[3])},y=function(b){for(var h=[],_=0;_<64;_+=4)h[_>>2]=b.charCodeAt(_)+(b.charCodeAt(_+1)<<8)+(b.charCodeAt(_+2)<<16)+(b.charCodeAt(_+3)<<24);return h},w=function(b,h){var _,p=b.length,m=[1732584193,-271733879,-1732584194,271733878];for(_=64;_<=p;_+=64)c(m,y(b.substring(_-64,_)),h);var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=(b=b.substring(_-64)).length;for(_=0;_<g;_++)v[_>>2]|=b.charCodeAt(_)<<(_%4<<3);if(v[_>>2]|=128<<(_%4<<3),_>55)for(c(m,v,h),_=16;_--;)v[_]=0;return v[14]=8*p,c(m,v,h),m};function x(b){var h;return o(w("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(h=function(_,p){var m=(65535&_)+(65535&p);return(_>>16)+(p>>16)+(m>>16)<<16|65535&m}),o(w(b,h))}}])})});var nl=yn(ii=>{ii.parse=function(t,e){if(e?e.offsets=typeof e.offsets=="undefined"?!0:e.offsets:e={offsets:!0},t||(t=""),t.indexOf(":")===-1&&!e.tokenize)return t;if(!e.keywords&&!e.ranges&&!e.tokenize)return t;var r={text:[]};e.offsets&&(r.offsets=[]);for(var n={},i=[],o=/(\S+:'(?:[^'\\]|\\.)*')|(\S+:"(?:[^"\\]|\\.)*")|(-?"(?:[^"\\]|\\.)*")|(-?'(?:[^'\\]|\\.)*')|\S+|\S+:\S+/g,s;(s=o.exec(t))!==null;){var c=s[0],a=c.indexOf(":");if(a!==-1){var l=c.split(":"),u=c.slice(0,a),d=c.slice(a+1);d=d.replace(/^\"|\"$|^\'|\'$/g,""),d=(d+"").replace(/\\(.?)/g,function(g,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),i.push({keyword:u,value:d,offsetStart:s.index,offsetEnd:s.index+c.length})}else{var f=!1;c[0]==="-"&&(f=!0,c=c.slice(1)),c=c.replace(/^\"|\"$|^\'|\'$/g,""),c=(c+"").replace(/\\(.?)/g,function(g,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),f?n.text?(n.text instanceof Array||(n.text=[n.text]),n.text.push(c)):n.text=c:i.push({text:c,offsetStart:s.index,offsetEnd:s.index+c.length})}}i.reverse();for(var c;c=i.pop();)if(c.text)r.text.push(c.text),e.offsets&&r.offsets.push(c);else{var u=c.keyword;e.keywords=e.keywords||[];var y=!1,w=!1;if(!/^-/.test(u))y=e.keywords.indexOf(u)!==-1;else if(u[0]==="-"){var x=u.slice(1);y=e.keywords.indexOf(x)!==-1,y&&(u=x,w=!0)}e.ranges=e.ranges||[];var b=e.ranges.indexOf(u)!==-1;if(y){e.offsets&&r.offsets.push({keyword:u,value:c.value,offsetStart:w?c.offsetStart+1:c.offsetStart,offsetEnd:c.offsetEnd});var h=c.value;if(h.length){var _=h.split(",");w?n[u]?n[u]instanceof Array?_.length>1?n[u]=n[u].concat(_):n[u].push(h):(n[u]=[n[u]],n[u].push(h)):_.length>1?n[u]=_:e.alwaysArray?n[u]=[h]:n[u]=h:r[u]?r[u]instanceof Array?_.length>1?r[u]=r[u].concat(_):r[u].push(h):(r[u]=[r[u]],r[u].push(h)):_.length>1?r[u]=_:e.alwaysArray?r[u]=[h]:r[u]=h}}else if(b){e.offsets&&r.offsets.push(c);var h=c.value,p=h.split("-");r[u]={},p.length===2?(r[u].from=p[0],r[u].to=p[1]):!p.length%2||(r[u].from=h)}else{var m=c.keyword+":"+c.value;r.text.push(m),e.offsets&&r.offsets.push({text:m,offsetStart:c.offsetStart,offsetEnd:c.offsetEnd})}}return r.text.length?e.tokenize||(r.text=r.text.join(" ").trim()):delete r.text,r.exclude=n,r};ii.stringify=function(t,e,r){if(e||(e={offsets:!0}),!t)return"";if(typeof t=="string")return t;if(Array.isArray(t))return t.join(" ");if(!Object.keys(t).length)return"";if(Object.keys(t).length===3&&!!t.text&&!!t.offsets&&!!t.exclude&&typeof t.text=="string")return t.text;r||(r="");var n=function(a){return a.indexOf(" ")>-1?JSON.stringify(a):a},i=function(a){return r+a},o=[];if(t.text){var s=[];typeof t.text=="string"?s.push(t.text):s.push.apply(s,t.text),s.length>0&&o.push(s.map(n).map(i).join(" "))}return e.keywords&&e.keywords.forEach(function(a){if(!!t[a]){var l=[];typeof t[a]=="string"?l.push(t[a]):l.push.apply(l,t[a]),l.length>0&&o.push(i(a+":"+l.map(n).join(",")))}}),e.ranges&&e.ranges.forEach(function(a){if(!!t[a]){var l=t[a].from,u=t[a].to;u&&(l=l+"-"+u),l&&o.push(i(a+":"+l))}}),t.exclude&&Object.keys(t.exclude).length>0&&o.push(ii.stringify(t.exclude,e,"-")),o.join(" ")}});var ol=yn((n_,il)=>{il.exports=nl()});var xc=yn(Si=>{function fs(t){return fs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fs(t)}(function(t,e){if(typeof define=="function"&&define.amd)define(["exports"],e);else if(typeof Si!="undefined")e(Si);else{var r={exports:{}};e(r.exports),t.CancelablePromise=r.exports}})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:Si,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelablePromise=void 0,t.cancelable=L,t.default=void 0,t.isCancelablePromise=k;function e(A,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(F&&F.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),F&&r(A,F)}function r(A,F){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,O){return N.__proto__=O,N},r(A,F)}function n(A){var F=s();return function(){var N=a(A),O;if(F){var X=a(this).constructor;O=Reflect.construct(N,arguments,X)}else O=N.apply(this,arguments);return i(this,O)}}function i(A,F){if(F&&(fs(F)==="object"||typeof F=="function"))return F;if(F!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(A)}function o(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(A){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)},a(A)}function l(A,F){var D=typeof Symbol!="undefined"&&A[Symbol.iterator]||A["@@iterator"];if(!D){if(Array.isArray(A)||(D=u(A))||F&&A&&typeof A.length=="number"){D&&(A=D);var N=0,O=function(){};return{s:O,n:function(){return N>=A.length?{done:!0}:{done:!1,value:A[N++]}},e:function(te){throw te},f:O}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var X=!0,le=!1,_e;return{s:function(){D=D.call(A)},n:function(){var te=D.next();return X=te.done,te},e:function(te){le=!0,_e=te},f:function(){try{!X&&D.return!=null&&D.return()}finally{if(le)throw _e}}}}function u(A,F){if(!!A){if(typeof A=="string")return d(A,F);var D=Object.prototype.toString.call(A).slice(8,-1);if(D==="Object"&&A.constructor&&(D=A.constructor.name),D==="Map"||D==="Set")return Array.from(A);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return d(A,F)}}function d(A,F){(F==null||F>A.length)&&(F=A.length);for(var D=0,N=new Array(F);D<F;D++)N[D]=A[D];return N}function f(A,F){if(!(A instanceof F))throw new TypeError("Cannot call a class as a function")}function c(A,F){for(var D=0;D<F.length;D++){var N=F[D];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(A,N.key,N)}}function y(A,F,D){return F&&c(A.prototype,F),D&&c(A,D),Object.defineProperty(A,"prototype",{writable:!1}),A}function w(A,F,D){return F in A?Object.defineProperty(A,F,{value:D,enumerable:!0,configurable:!0,writable:!0}):A[F]=D,A}function x(A,F,D){b(A,F),F.set(A,D)}function b(A,F){if(F.has(A))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(A,F){var D=m(A,F,"get");return _(A,D)}function _(A,F){return F.get?F.get.call(A):F.value}function p(A,F,D){var N=m(A,F,"set");return v(A,N,D),D}function m(A,F,D){if(!F.has(A))throw new TypeError("attempted to "+D+" private field on non-instance");return F.get(A)}function v(A,F,D){if(F.set)F.set.call(A,D);else{if(!F.writable)throw new TypeError("attempted to set read only private field");F.value=D}}var g=typeof Symbol!="undefined"?Symbol.toStringTag:"@@toStringTag",j=new WeakMap,C=new WeakMap,S=function(){function A(F){var D=F.executor,N=D===void 0?function(){}:D,O=F.internals,X=O===void 0?Z():O,le=F.promise,_e=le===void 0?new Promise(function(Ce,te){return N(Ce,te,function(q){X.onCancelList.push(q)})}):le;f(this,A),x(this,j,{writable:!0,value:void 0}),x(this,C,{writable:!0,value:void 0}),w(this,g,"CancelablePromise"),this.cancel=this.cancel.bind(this),p(this,j,X),p(this,C,_e||new Promise(function(Ce,te){return N(Ce,te,function(q){X.onCancelList.push(q)})}))}return y(A,[{key:"then",value:function(D,N){return J(h(this,C).then(z(D,h(this,j)),z(N,h(this,j))),h(this,j))}},{key:"catch",value:function(D){return J(h(this,C).catch(z(D,h(this,j))),h(this,j))}},{key:"finally",value:function(D,N){var O=this;return N&&h(this,j).onCancelList.push(D),J(h(this,C).finally(z(function(){if(D)return N&&(h(O,j).onCancelList=h(O,j).onCancelList.filter(function(X){return X!==D})),D()},h(this,j))),h(this,j))}},{key:"cancel",value:function(){h(this,j).isCanceled=!0;var D=h(this,j).onCancelList;h(this,j).onCancelList=[];var N=l(D),O;try{for(N.s();!(O=N.n()).done;){var X=O.value;if(typeof X=="function")try{X()}catch(le){console.error(le)}}}catch(le){N.e(le)}finally{N.f()}}},{key:"isCanceled",value:function(){return h(this,j).isCanceled===!0}}]),A}(),E=function(A){e(D,A);var F=n(D);function D(N){return f(this,D),F.call(this,{executor:N})}return y(D)}(S);t.CancelablePromise=E,w(E,"all",function(F){return Q(F,Promise.all(F))}),w(E,"allSettled",function(F){return Q(F,Promise.allSettled(F))}),w(E,"any",function(F){return Q(F,Promise.any(F))}),w(E,"race",function(F){return Q(F,Promise.race(F))}),w(E,"resolve",function(F){return L(Promise.resolve(F))}),w(E,"reject",function(F){return L(Promise.reject(F))}),w(E,"isCancelable",k);var P=E;t.default=P;function L(A){return J(A,Z())}function k(A){return A instanceof E||A instanceof S}function z(A,F){if(A)return function(D){if(!F.isCanceled){var N=A(D);return k(N)&&F.onCancelList.push(N.cancel),N}return D}}function J(A,F){return new S({internals:F,promise:A})}function Q(A,F){var D=Z();return D.onCancelList.push(function(){var N=l(A),O;try{for(N.s();!(O=N.n()).done;){var X=O.value;k(X)&&X.cancel()}}catch(le){N.e(le)}finally{N.f()}}),new S({internals:D,promise:F})}function Z(){return{isCanceled:!1,onCancelList:[]}}})});Gc(exports,{default:()=>ps});var Pr=Fe(require("obsidian"));var Lc=Fe(require("obsidian"));function ce(){}function qc(t,e){for(let r in e)t[r]=e[r];return t}function Di(t){return t()}function bs(){return Object.create(null)}function Ue(t){t.forEach(Di)}function er(t){return typeof t=="function"}function be(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var vn;function Ti(t,e){return vn||(vn=document.createElement("a")),vn.href=e,t===vn.href}function xs(t){return Object.keys(t).length===0}function ws(t,...e){if(t==null)return ce;let r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function _n(t,e,r){t.$$.on_destroy.push(ws(e,r))}function tr(t,e,r,n){if(t){let i=js(t,e,r,n);return t[0](i)}}function js(t,e,r,n){return t[1]&&n?qc(r.ctx.slice(),t[1](n(e))):r.ctx}function rr(t,e,r,n){if(t[2]&&n){let i=t[2](n(r));if(e.dirty===void 0)return i;if(typeof i=="object"){let o=[],s=Math.max(e.dirty.length,i.length);for(let a=0;a<s;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function nr(t,e,r,n,i,o){if(i){let s=js(e,r,n,o);t.p(s,i)}}function ir(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let n=0;n<r;n++)e[n]=-1;return e}return-1}function Cs(t){return t&&er(t.destroy)?t.destroy:ce}var As=!1;function Yc(){As=!0}function Jc(){As=!1}function T(t,e){t.appendChild(e)}function $(t,e,r){t.insertBefore(e,r||null)}function H(t){t.parentNode&&t.parentNode.removeChild(t)}function bn(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function R(t){return document.createElement(t)}function xe(t){return document.createTextNode(t)}function W(){return xe(" ")}function or(){return xe("")}function Ke(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function B(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function Xc(t){return Array.from(t.childNodes)}function Ge(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Ii(t,e){t.value=e??""}function ze(t,e,r,n){r===null?t.style.removeProperty(e):t.style.setProperty(e,r,n?"important":"")}function Oi(t,e,r){t.classList[r?"add":"remove"](e)}function Zc(t,e,{bubbles:r=!1,cancelable:n=!1}={}){let i=document.createEvent("CustomEvent");return i.initCustomEvent(t,r,n,e),i}var Rr;function Lr(t){Rr=t}function ki(){if(!Rr)throw new Error("Function called outside component initialization");return Rr}function Br(t){ki().$$.on_mount.push(t)}function Nr(t){ki().$$.on_destroy.push(t)}function Pi(){let t=ki();return(e,r,{cancelable:n=!1}={})=>{let i=t.$$.callbacks[e];if(i){let o=Zc(e,r,{cancelable:n});return i.slice().forEach(s=>{s.call(t,o)}),!o.defaultPrevented}return!0}}function $e(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(n=>n.call(this,e))}var Kr=[];var tt=[],xn=[],Ss=[],Fs=Promise.resolve(),Mi=!1;function Es(){Mi||(Mi=!0,Fs.then(Ds))}function mt(){return Es(),Fs}function Ri(t){xn.push(t)}var Li=new Set,wn=0;function Ds(){let t=Rr;do{for(;wn<Kr.length;){let e=Kr[wn];wn++,Lr(e),ef(e.$$)}for(Lr(null),Kr.length=0,wn=0;tt.length;)tt.pop()();for(let e=0;e<xn.length;e+=1){let r=xn[e];Li.has(r)||(Li.add(r),r())}xn.length=0}while(Kr.length);for(;Ss.length;)Ss.pop()();Mi=!1,Li.clear(),Lr(t)}function ef(t){if(t.fragment!==null){t.update(),Ue(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ri)}}var jn=new Set,Rt;function Lt(){Rt={r:0,c:[],p:Rt}}function Bt(){Rt.r||Ue(Rt.c),Rt=Rt.p}function ee(t,e){t&&t.i&&(jn.delete(t),t.i(e))}function re(t,e,r,n){if(t&&t.o){if(jn.has(t))return;jn.add(t),Rt.c.push(()=>{jn.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}var qy=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Le(t){t&&t.c()}function ke(t,e,r,n){let{fragment:i,after_update:o}=t.$$;i&&i.m(e,r),n||Ri(()=>{let s=t.$$.on_mount.map(Di).filter(er);t.$$.on_destroy?t.$$.on_destroy.push(...s):Ue(s),t.$$.on_mount=[]}),o.forEach(Ri)}function Ee(t,e){let r=t.$$;r.fragment!==null&&(Ue(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function tf(t,e){t.$$.dirty[0]===-1&&(Kr.push(t),Es(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function De(t,e,r,n,i,o,s,a=[-1]){let l=Rr;Lr(t);let u=t.$$={fragment:null,ctx:[],props:o,update:ce,not_equal:i,bound:bs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:bs(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(u.root);let d=!1;if(u.ctx=r?r(t,e.props||{},(f,c,...y)=>{let w=y.length?y[0]:c;return u.ctx&&i(u.ctx[f],u.ctx[f]=w)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](w),d&&tf(t,f)),c}):[],u.update(),d=!0,Ue(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){Yc();let f=Xc(e.target);u.fragment&&u.fragment.l(f),f.forEach(H)}else u.fragment&&u.fragment.c();e.intro&&ee(t.$$.fragment),ke(t,e.target,e.anchor,e.customElement),Jc(),Ds()}Lr(l)}var rf;typeof HTMLElement=="function"&&(rf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(Di).filter(er);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,r){this[t]=r}disconnectedCallback(){Ue(this.$$.on_disconnect)}$destroy(){Ee(this,1),this.$destroy=ce}$on(t,e){if(!er(e))return ce;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{let n=r.indexOf(e);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!xs(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var Ae=class{$destroy(){Ee(this,1),this.$destroy=ce}$on(e,r){if(!er(r))return ce;let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{let i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!xs(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Mt=Fe(require("obsidian"));var Ha=Fe(require("obsidian"));var Bi=class{constructor(){this.handlers=new Map;this.disabled=[]}on(e,r,n){if(e.includes("@")||r.includes("@"))throw new Error("Invalid context/event name - Cannot contain @");this.handlers.set(`${e}@${r}`,n)}off(e,r){if(r)this.handlers.delete(`${e}@${r}`);else for(let[n]of this.handlers.entries())n.startsWith(`${e}@`)&&this.handlers.delete(n)}disable(e){this.enable(e),this.disabled.push(e)}enable(e){this.disabled=this.disabled.filter(r=>r!==e)}emit(e,...r){let n=[...this.handlers.entries()].filter(([i,o])=>!this.disabled.includes(i.split("@")[0]));for(let[i,o]of n)i.endsWith(`@${e}`)&&o(...r)}};var sr=[];function Cn(t,e=ce){let r,n=new Set;function i(a){if(be(t,a)&&(t=a,r)){let l=!sr.length;for(let u of n)u[1](),sr.push(u,t);if(l){for(let u=0;u<sr.length;u+=2)sr[u][0](sr[u+1]);sr.length=0}}}function o(a){i(a(t))}function s(a,l=ce){let u=[a,l];return n.add(u),n.size===1&&(r=e(i)||ce),a(t),()=>{n.delete(u),n.size===0&&(r(),r=null)}}return{set:i,update:o,subscribe:s}}var Y=Fe(require("obsidian"));var ie=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,he=Object.keys,Te=Array.isArray;typeof Promise!="undefined"&&!ie.Promise&&(ie.Promise=Promise);function Pe(t,e){return typeof e!="object"||he(e).forEach(function(r){t[r]=e[r]}),t}var zr=Object.getPrototypeOf,nf={}.hasOwnProperty;function Ve(t,e){return nf.call(t,e)}function ar(t,e){typeof e=="function"&&(e=e(zr(t))),(typeof Reflect=="undefined"?he:Reflect.ownKeys)(e).forEach(r=>{rt(t,r,e[r])})}var Ts=Object.defineProperty;function rt(t,e,r,n){Ts(t,e,Pe(r&&Ve(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function lr(t){return{from:function(e){return t.prototype=Object.create(e.prototype),rt(t.prototype,"constructor",t),{extend:ar.bind(null,t.prototype)}}}}var of=Object.getOwnPropertyDescriptor;function Ni(t,e){let r=of(t,e),n;return r||(n=zr(t))&&Ni(n,e)}var sf=[].slice;function An(t,e,r){return sf.call(t,e,r)}function Is(t,e){return e(t)}function Vr(t){if(!t)throw new Error("Assertion Failed")}function Os(t){ie.setImmediate?setImmediate(t):setTimeout(t,0)}function ks(t,e){return t.reduce((r,n,i)=>{var o=e(n,i);return o&&(r[o[0]]=o[1]),r},{})}function af(t,e,r){try{t.apply(null,r)}catch(n){e&&e(n)}}function nt(t,e){if(Ve(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,i=e.length;n<i;++n){var o=nt(t,e[n]);r.push(o)}return r}var s=e.indexOf(".");if(s!==-1){var a=t[e.substr(0,s)];return a===void 0?void 0:nt(a,e.substr(s+1))}}function Qe(t,e,r){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Vr(typeof r!="string"&&"length"in r);for(var n=0,i=e.length;n<i;++n)Qe(t,e[n],r[n])}else{var o=e.indexOf(".");if(o!==-1){var s=e.substr(0,o),a=e.substr(o+1);if(a==="")r===void 0?Te(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=r;else{var l=t[s];(!l||!Ve(t,s))&&(l=t[s]={}),Qe(l,a,r)}}else r===void 0?Te(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function lf(t,e){typeof e=="string"?Qe(t,e,void 0):"length"in e&&[].map.call(e,function(r){Qe(t,r,void 0)})}function Ps(t){var e={};for(var r in t)Ve(t,r)&&(e[r]=t[r]);return e}var uf=[].concat;function Ms(t){return uf.apply([],t)}var Rs="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ms([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>ie[t]),cf=Rs.map(t=>ie[t]);ks(Rs,t=>[t,!0]);var gt=null;function Hr(t){gt=typeof WeakMap!="undefined"&&new WeakMap;let e=Ki(t);return gt=null,e}function Ki(t){if(!t||typeof t!="object")return t;let e=gt&&gt.get(t);if(e)return e;if(Te(t)){e=[],gt&&gt.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(Ki(t[r]))}else if(cf.indexOf(t.constructor)>=0)e=t;else{let o=zr(t);e=o===Object.prototype?{}:Object.create(o),gt&&gt.set(t,e);for(var i in t)Ve(t,i)&&(e[i]=Ki(t[i]))}return e}var{toString:ff}={};function zi(t){return ff.call(t).slice(8,-1)}var Vi=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",df=typeof Vi=="symbol"?function(t){var e;return t!=null&&(e=t[Vi])&&e.apply(t)}:function(){return null},ur={};function it(t){var e,r,n,i;if(arguments.length===1){if(Te(t))return t.slice();if(this===ur&&typeof t=="string")return[t];if(i=df(t)){for(r=[];n=i.next(),!n.done;)r.push(n.value);return r}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var Hi=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,Je=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ls(t,e){Je=t,Bs=e}var Bs=()=>!0,hf=!new Error("").stack;function Nt(){if(hf)try{throw Nt.arguments,new Error}catch(t){return t}return new Error}function $i(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(Bs).map(n=>`
`+n).join("")):""}var pf=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Ns=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Wi=pf.concat(Ns),mf={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function cr(t,e){this._e=Nt(),this.name=t,this.message=e}lr(cr).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$i(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Ks(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Sn(t,e,r,n){this._e=Nt(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=Ks(t,e)}lr(Sn).from(cr);function $r(t,e){this._e=Nt(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=Ks(t,e)}lr($r).from(cr);var Ui=Wi.reduce((t,e)=>(t[e]=e+"Error",t),{}),gf=cr,V=Wi.reduce((t,e)=>{var r=e+"Error";function n(i,o){this._e=Nt(),this.name=r,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=mf[e]||r,this.inner=null)}return lr(n).from(gf),t[e]=n,t},{});V.Syntax=SyntaxError;V.Type=TypeError;V.Range=RangeError;var zs=Ns.reduce((t,e)=>(t[e+"Error"]=V[e],t),{});function yf(t,e){if(!t||t instanceof cr||t instanceof TypeError||t instanceof SyntaxError||!t.name||!zs[t.name])return t;var r=new zs[t.name](e||t.message,t);return"stack"in t&&rt(r,"stack",{get:function(){return this.inner.stack}}),r}var Fn=Wi.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=V[e]),t),{});Fn.ModifyError=Sn;Fn.DexieError=cr;Fn.BulkError=$r;function ne(){}function Wr(t){return t}function vf(t,e){return t==null||t===Wr?e:function(r){return e(t(r))}}function Kt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function _f(t,e){return t===ne?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Kt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?Kt(i,this.onerror):i),o!==void 0?o:r}}function bf(t,e){return t===ne?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Kt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Kt(n,this.onerror):n)}}function xf(t,e){return t===ne?e:function(r){var n=t.apply(this,arguments);Pe(r,n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Kt(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Kt(o,this.onerror):o),n===void 0?s===void 0?void 0:s:Pe(n,s)}}function wf(t,e){return t===ne?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function Gi(t,e){return t===ne?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then(function(){return e.apply(n,o)})}return e.apply(this,arguments)}}var Ur={},jf=100,Cf=20,Vs=100,[Qi,En,qi]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,zr(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,zr(e),t]})(),Hs=En&&En.then,Dn=Qi&&Qi.constructor,Yi=!!qi,Ji=!1,Af=qi?()=>{qi.then(kn)}:ie.setImmediate?setImmediate.bind(null,kn):ie.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{kn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(kn,0)},Gr=function(t,e){Qr.push([t,e]),Tn&&(Af(),Tn=!1)},Xi=!0,Tn=!0,zt=[],In=[],Zi=null,eo=Wr,fr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Zs,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Zs(t[0],t[1])}catch{}})}},K=fr,Qr=[],Vt=0,On=[];function M(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ne,this._lib=!1;var e=this._PSD=K;if(Je&&(this._stackHolder=Nt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ur)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ro(this,this._value);return}this._state=null,this._value=null,++e.ref,Ws(this,t)}var to={get:function(){var t=K,e=Rn;function r(n,i){var o=!t.global&&(t!==K||e!==Rn);let s=o&&!ot();var a=new M((l,u)=>{no(this,new $s(Bn(n,t,o,s),Bn(i,t,o,s),l,u,t))});return Je&&Qs(a,this),a}return r.prototype=Ur,r},set:function(t){rt(this,"then",t&&t.prototype===Ur?to:{get:function(){return t},set:to.set})}};ar(M.prototype,{then:to,_then:function(t,e){no(this,new $s(null,null,t,e,K))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):Pn(n)):this.then(null,n=>n&&n.name===e?r(n):Pn(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Pn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ji=!0;var t=Gs(this,[],Cf),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Ji=!1}}},timeout:function(t,e){return t<1/0?new M((r,n)=>{var i=setTimeout(()=>n(new V.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&rt(M.prototype,Symbol.toStringTag,"Dexie.Promise");fr.env=qs();function $s(t,e,r,n,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=i}ar(M,{all:function(){var t=it.apply(null,arguments).map(Ln);return new M(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((i,o)=>M.resolve(i).then(s=>{t[o]=s,--n||e(t)},r))})},resolve:t=>{if(t instanceof M)return t;if(t&&typeof t.then=="function")return new M((r,n)=>{t.then(r,n)});var e=new M(Ur,!0,t);return Qs(e,Zi),e},reject:Pn,race:function(){var t=it.apply(null,arguments).map(Ln);return new M((e,r)=>{t.map(n=>M.resolve(n).then(e,r))})},PSD:{get:()=>K,set:t=>K=t},totalEchoes:{get:()=>Rn},newPSD:yt,usePSD:hr,scheduler:{get:()=>Gr,set:t=>{Gr=t}},rejectionMapper:{get:()=>eo,set:t=>{eo=t}},follow:(t,e)=>new M((r,n)=>yt((i,o)=>{var s=K;s.unhandleds=[],s.onunhandled=o,s.finalize=Kt(function(){Ff(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},s.finalize),t()},e,r,n))});Dn&&(Dn.allSettled&&rt(M,"allSettled",function(){let t=it.apply(null,arguments).map(Ln);return new M(e=>{t.length===0&&e([]);let r=t.length,n=new Array(r);t.forEach((i,o)=>M.resolve(i).then(s=>n[o]={status:"fulfilled",value:s},s=>n[o]={status:"rejected",reason:s}).then(()=>--r||e(n)))})}),Dn.any&&typeof AggregateError!="undefined"&&rt(M,"any",function(){let t=it.apply(null,arguments).map(Ln);return new M((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length,i=new Array(n);t.forEach((o,s)=>M.resolve(o).then(a=>e(a),a=>{i[s]=a,--n||r(new AggregateError(i))}))})}));function Ws(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&qr();r&&typeof r.then=="function"?Ws(t,(i,o)=>{r instanceof M?r._then(i,o):r.then(i,o)}):(t._state=!0,t._value=r,Us(t)),n&&Yr()}},ro.bind(null,t))}catch(r){ro(t,r)}}function ro(t,e){if(In.push(e),t._state===null){var r=t._lib&&qr();e=eo(e),t._state=!1,t._value=e,Je&&e!==null&&typeof e=="object"&&!e._promise&&af(()=>{var n=Ni(e,"stack");e._promise=t,rt(e,"stack",{get:()=>Ji?n&&(n.get?n.get.apply(e):n.value):t.stack})}),Ef(t),Us(t),r&&Yr()}}function Us(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)no(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),Vt===0&&(++Vt,Gr(()=>{--Vt==0&&io()},[]))}function no(t,e){if(t._state===null){t._listeners.push(e);return}var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Vt,Gr(Sf,[r,t,e])}function Sf(t,e,r){try{Zi=e;var n,i=e._value;e._state?n=t(i):(In.length&&(In=[]),n=t(i),In.indexOf(i)===-1&&Df(e)),r.resolve(n)}catch(o){r.reject(o)}finally{Zi=null,--Vt==0&&io(),--r.psd.ref||r.psd.finalize()}}function Gs(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var i=t._value,o,s;i!=null?(o=i.name||"Error",s=i.message||i,n=$i(i,0)):(o=i,s=""),e.push(o+(s?": "+s:"")+n)}return Je&&(n=$i(t._stackHolder,2),n&&e.indexOf(n)===-1&&e.push(n),t._prev&&Gs(t._prev,e,r)),e}function Qs(t,e){var r=e?e._numPrev+1:0;r<jf&&(t._prev=e,t._numPrev=r)}function kn(){qr()&&Yr()}function qr(){var t=Xi;return Xi=!1,Tn=!1,t}function Yr(){var t,e,r;do for(;Qr.length>0;)for(t=Qr,Qr=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(Qr.length>0);Xi=!0,Tn=!0}function io(){var t=zt;zt=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=On.slice(0),r=e.length;r;)e[--r]()}function Ff(t){function e(){t(),On.splice(On.indexOf(e),1)}On.push(e),++Vt,Gr(()=>{--Vt==0&&io()},[])}function Ef(t){zt.some(e=>e._value===t._value)||zt.push(t)}function Df(t){for(var e=zt.length;e;)if(zt[--e]._value===t._value){zt.splice(e,1);return}}function Pn(t){return new M(Ur,!1,t)}function se(t,e){var r=K;return function(){var n=qr(),i=K;try{return vt(r,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{vt(i,!1),n&&Yr()}}}var Ie={awaits:0,echoes:0,id:0},Tf=0,Mn=[],oo=0,Rn=0,If=0;function yt(t,e,r,n){var i=K,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++If;var s=fr.env;o.env=Yi?{Promise:M,PromiseProp:{value:M,configurable:!0,writable:!0},all:M.all,race:M.race,allSettled:M.allSettled,any:M.any,resolve:M.resolve,reject:M.reject,nthen:Js(s.nthen,o),gthen:Js(s.gthen,o)}:{},e&&Pe(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=hr(o,t,r,n);return o.ref===0&&o.finalize(),a}function dr(){return Ie.id||(Ie.id=++Tf),++Ie.awaits,Ie.echoes+=Vs,Ie.id}function ot(){return Ie.awaits?(--Ie.awaits==0&&(Ie.id=0),Ie.echoes=Ie.awaits*Vs,!0):!1}(""+Hs).indexOf("[native code]")===-1&&(dr=ot=ne);function Ln(t){return Ie.echoes&&t&&t.constructor===Dn?(dr(),t.then(e=>(ot(),e),e=>(ot(),ye(e)))):t}function Of(t){++Rn,(!Ie.echoes||--Ie.echoes==0)&&(Ie.echoes=Ie.id=0),Mn.push(K),vt(t,!0)}function kf(){var t=Mn[Mn.length-1];Mn.pop(),vt(t,!1)}function vt(t,e){var r=K;if((e?Ie.echoes&&(!oo++||t!==K):oo&&(!--oo||t!==K))&&Ys(e?Of.bind(null,t):kf),t!==K&&(K=t,r===fr&&(fr.env=qs()),Yi)){var n=fr.env.Promise,i=t.env;En.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(ie,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function qs(){var t=ie.Promise;return Yi?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(ie,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:En.then,gthen:t.prototype.then}:{}}function hr(t,e,r,n,i){var o=K;try{return vt(t,!0),e(r,n,i)}finally{vt(o,!1)}}function Ys(t){Hs.call(Qi,t)}function Bn(t,e,r,n){return typeof t!="function"?t:function(){var i=K;r&&dr(),vt(e,!0);try{return t.apply(this,arguments)}finally{vt(i,!1),n&&Ys(ot)}}}function Js(t,e){return function(r,n){return t.call(this,Bn(r,e),Bn(n,e))}}var Xs="unhandledrejection";function Zs(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,i={promise:e,reason:t};if(ie.document&&document.createEvent?(n=document.createEvent("Event"),n.initEvent(Xs,!0,!0),Pe(n,i)):ie.CustomEvent&&(n=new CustomEvent(Xs,{detail:i}),Pe(n,i)),n&&ie.dispatchEvent&&(dispatchEvent(n),!ie.PromiseRejectionEvent&&ie.onunhandledrejection))try{ie.onunhandledrejection(n)}catch{}Je&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var ye=M.reject;function so(t,e,r,n){if(!t.idbdb||!t._state.openComplete&&!K.letThrough&&!t._vip){if(t._state.openComplete)return ye(new V.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ye(new V.DatabaseClosed);t.open().catch(ne)}return t._state.dbReadyPromise.then(()=>so(t,e,r,n))}else{var i=t._createTransaction(e,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Ui.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>so(t,e,r,n))):ye(o)}return i._promise(e,(o,s)=>yt(()=>(K.trans=i,n(o,s,i)))).then(o=>i._completion.then(()=>o))}}var ea="3.2.2",Ht=String.fromCharCode(65535),ao=-1/0,st="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ta="String expected.",Jr=[],Nn=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Pf=Nn,Mf=Nn,ra=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Kn="__dbnames",lo="readonly",uo="readwrite";function $t(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var na={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function zn(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Hr(e),delete e[t]),e):e=>e}var ia=class{_trans(e,r,n){let i=this._tx||K.trans,o=this.name;function s(l,u,d){if(!d.schema[o])throw new V.NotFound("Table "+o+" not part of transaction");return r(d.idbtrans,d)}let a=qr();try{return i&&i.db===this.db?i===K.trans?i._promise(e,s,n):yt(()=>i._promise(e,s,n),{trans:i,transless:K.transless||K}):so(this.db,e,[this.name],s)}finally{a&&Yr()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Te(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let r=he(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&r.every(d=>u.keyPath.indexOf(d)>=0)&&u.keyPath.every(d=>r.indexOf(d)>=0))[0];if(n&&this.db._maxKey!==Ht)return this.where(n.name).equals(n.keyPath.map(u=>e[u]));!n&&Je&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);let{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function s(u,d){try{return o.cmp(u,d)===0}catch{return!1}}let[a,l]=r.reduce(([u,d],f)=>{let c=i[f],y=e[f];return[u||c,u||!c?$t(d,c&&c.multi?w=>{let x=nt(w,f);return Te(x)&&x.some(b=>s(y,b))}:w=>s(y,nt(w,f))):d]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):n?this.filter(l):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Te(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let r=n=>{if(!n)return n;let i=Object.create(e.prototype);for(var o in n)if(Ve(n,o))try{i[o]=n[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){function e(r){Pe(this,r)}return this.mapToClass(e)}add(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=zn(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:r!=null?[r]:null,values:[o]})).then(s=>s.numFailures?M.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Qe(e,i,s)}catch{}return s})}update(e,r){if(typeof e=="object"&&!Te(e)){let n=nt(e,this.schema.primKey.keyPath);if(n===void 0)return ye(new V.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?he(r).forEach(i=>{Qe(e,i,r[i])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}else return this.where(":id").equals(e).modify(r)}put(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=zn(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[o],keys:r!=null?[r]:null})).then(s=>s.numFailures?M.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Qe(e,i,s)}catch{}return s})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?M.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:na})).then(e=>e.numFailures?M.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new V.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,d=l&&a?e.map(zn(l)):e;return this.core.mutate({trans:s,type:"add",keys:i,values:d,wantResults:o}).then(({numFailures:f,results:c,lastResult:y,failures:w})=>{let x=o?c:y;if(f===0)return x;throw new $r(`${this.name}.bulkAdd(): ${f} of ${u} operations failed`,w)})})}bulkPut(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new V.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,d=l&&a?e.map(zn(l)):e;return this.core.mutate({trans:s,type:"put",keys:i,values:d,wantResults:o}).then(({numFailures:f,results:c,lastResult:y,failures:w})=>{let x=o?c:y;if(f===0)return x;throw new $r(`${this.name}.bulkPut(): ${f} of ${u} operations failed`,w)})})}bulkDelete(e){let r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:o})=>{if(n===0)return i;throw new $r(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,o)})}};function Xr(t){var e={},r=function(a,l){if(l){for(var u=arguments.length,d=new Array(u-1);--u;)d[u-1]=arguments[u];return e[a].subscribe.apply(null,d),t}else if(typeof a=="string")return e[a]};r.addEventType=o;for(var n=1,i=arguments.length;n<i;++n)o(arguments[n]);return r;function o(a,l,u){if(typeof a=="object")return s(a);l||(l=wf),u||(u=ne);var d={subscribers:[],fire:u,subscribe:function(f){d.subscribers.indexOf(f)===-1&&(d.subscribers.push(f),d.fire=l(d.fire,f))},unsubscribe:function(f){d.subscribers=d.subscribers.filter(function(c){return c!==f}),d.fire=d.subscribers.reduce(l,u)}};return e[a]=r[a]=d,d}function s(a){he(a).forEach(function(l){var u=a[l];if(Te(u))o(l,a[l][0],a[l][1]);else if(u==="asap")var d=o(l,Wr,function(){for(var c=arguments.length,y=new Array(c);c--;)y[c]=arguments[c];d.subscribers.forEach(function(w){Os(function(){w.apply(null,y)})})});else throw new V.InvalidArgument("Invalid event config")})}}function Zr(t,e){return lr(e).from({prototype:t}),e}function Rf(t){return Zr(ia.prototype,function(r,n,i){this.db=t,this._tx=i,this.name=r,this.schema=n,this.hook=t._allTables[r]?t._allTables[r].hook:Xr(null,{creating:[_f,ne],reading:[vf,Wr],updating:[xf,ne],deleting:[bf,ne]})})}function pr(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function co(t,e){t.filter=$t(t.filter,e)}function fo(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>$t(n(),e()):e,t.justLimit=r&&!n}function Lf(t,e){t.isMatch=$t(t.isMatch,e)}function Vn(t,e){if(t.isPrimKey)return e.primaryKey;let r=e.getIndexByKeyPath(t.index);if(!r)throw new V.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function oa(t,e,r){let n=Vn(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function Hn(t,e,r,n){let i=t.replayFilter?$t(t.filter,t.replayFilter()):t.filter;if(t.or){let o={},s=(a,l,u)=>{if(!i||i(l,u,c=>l.stop(c),c=>l.fail(c))){var d=l.primaryKey,f=""+d;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(d)),Ve(o,f)||(o[f]=!0,e(a,l,u))}};return Promise.all([t.or._iterate(s,r),sa(oa(t,n,r),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}else return sa(oa(t,n,r),$t(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function sa(t,e,r,n){var i=n?(s,a,l)=>r(n(s),a,l):r,o=se(i);return t.then(s=>{if(s)return s.start(()=>{var a=()=>s.continue();(!e||e(s,l=>a=l,l=>{s.stop(l),a=ne},l=>{s.fail(l),a=ne}))&&o(s.value,s,l=>a=l),a()})})}function Me(t,e){try{let r=aa(t),n=aa(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Nf(la(t),la(e));case"Array":return Bf(t,e)}}catch{}return NaN}function Bf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o){let s=Me(t[o],e[o]);if(s!==0)return s}return r===n?0:r<n?-1:1}function Nf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return r===n?0:r<n?-1:1}function aa(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let r=zi(t);return r==="ArrayBuffer"?"binary":r}function la(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var ua=class{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,ye.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,ye.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=$t(r.algorithm,e)}_iterate(e,r){return Hn(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Pe(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>Hn(r,e,n,r.table.core))}count(e){return this._read(r=>{let n=this._ctx,i=n.table.core;if(pr(n,!0))return i.count({trans:r,query:{index:Vn(n,i.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var o=0;return Hn(n,()=>(++o,!1),r,i).then(()=>o)}).then(e)}sortBy(e,r){let n=e.split(".").reverse(),i=n[0],o=n.length-1;function s(u,d){return d?s(u[n[d]],d-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,d){var f=s(u,o),c=s(d,o);return f<c?-a:f>c?a:0}return this.toArray(function(u){return u.sort(l)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&pr(n,!0)&&n.limit>0){let{valueMapper:i}=n,o=Vn(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:s})=>i?s.map(i):s)}else{let i=[];return Hn(n,o=>i.push(o),r,n.table.core).then(()=>i)}},e)}offset(e){var r=this._ctx;return e<=0?this:(r.offset+=e,pr(r)?fo(r,()=>{var n=e;return(i,o)=>n===0?!0:n===1?(--n,!1):(o(()=>{i.advance(n),n=0}),!1)}):fo(r,()=>{var n=e;return()=>--n<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),fo(this._ctx,()=>{var r=e;return function(n,i,o){return--r<=0&&i(o),r>=0}},!0),this}until(e,r){return co(this._ctx,function(n,i,o){return e(n.value)?(i(o),r):!0}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return co(this._ctx,function(r){return e(r.value)}),Lf(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&pr(r,!0)&&r.limit>0)return this._read(i=>{var o=Vn(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:i})=>i).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return co(this._ctx,function(i){var o=i.primaryKey.toString(),s=Ve(n,o);return n[o]=!0,!s}),this}modify(e){var r=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var o=he(e),s=o.length;i=function(x){for(var b=!1,h=0;h<s;++h){var _=o[h],p=e[_];nt(x,_)!==p&&(Qe(x,_,p),b=!0)}return b}}let a=r.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,d=this.db._options.modifyChunkSize||200,f=[],c=0,y=[],w=(x,b)=>{let{failures:h,numFailures:_}=b;c+=x-_;for(let p of he(h))f.push(h[p])};return this.clone().primaryKeys().then(x=>{let b=h=>{let _=Math.min(d,x.length-h);return a.getMany({trans:n,keys:x.slice(h,h+_),cache:"immutable"}).then(p=>{let m=[],v=[],g=l?[]:null,j=[];for(let S=0;S<_;++S){let E=p[S],P={value:Hr(E),primKey:x[h+S]};i.call(P,P.value,P)!==!1&&(P.value==null?j.push(x[h+S]):!l&&Me(u(E),u(P.value))!==0?(j.push(x[h+S]),m.push(P.value)):(v.push(P.value),l&&g.push(x[h+S])))}let C=pr(r)&&r.limit===1/0&&(typeof e!="function"||e===ho)&&{index:r.index,range:r.range};return Promise.resolve(m.length>0&&a.mutate({trans:n,type:"add",values:m}).then(S=>{for(let E in S.failures)j.splice(parseInt(E),1);w(m.length,S)})).then(()=>(v.length>0||C&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:g,values:v,criteria:C,changeSpec:typeof e!="function"&&e}).then(S=>w(v.length,S))).then(()=>(j.length>0||C&&e===ho)&&a.mutate({trans:n,type:"delete",keys:j,criteria:C}).then(S=>w(j.length,S))).then(()=>x.length>h+_&&b(h+d))})};return b(0).then(()=>{if(f.length>0)throw new Sn("Error modifying one or more objects",f,c,y);return x.length})})})}delete(){var e=this._ctx,r=e.range;return pr(e)&&(e.isPrimKey&&!Mf||r.type===3)?this._write(n=>{let{primaryKey:i}=e.table.core.schema,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(s=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:a,lastResult:l,results:u,numFailures:d})=>{if(d)throw new Sn("Could not delete some values",Object.keys(a).map(f=>a[f]),s-d);return s-d}))}):this.modify(ho)}},ho=(t,e)=>e.value=null;function Kf(t){return Zr(ua.prototype,function(r,n){this.db=t;let i=na,o=null;if(n)try{i=n()}catch(u){o=u}let s=r._ctx,a=s.table,l=a.hook.reading.fire;this._ctx={table:a,index:s.index,isPrimKey:!s.index||a.schema.primKey.keyPath&&s.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:s.or,valueMapper:l!==Wr?l:null}})}function zf(t,e){return t<e?-1:t===e?0:1}function Vf(t,e){return t>e?-1:t===e?0:1}function He(t,e,r){var n=t instanceof po?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function mr(t){return new t.Collection(t,()=>ca("")).limit(0)}function Hf(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function $f(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function Wf(t,e,r,n,i,o){for(var s=Math.min(t.length,n.length),a=-1,l=0;l<s;++l){var u=e[l];if(u!==n[l])return i(t[l],r[l])<0?t.substr(0,l)+r[l]+r.substr(l+1):i(t[l],n[l])<0?t.substr(0,l)+n[l]+r.substr(l+1):a>=0?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[l],u)<0&&(a=l)}return s<n.length&&o==="next"?t+r.substr(t.length):s<t.length&&o==="prev"?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function $n(t,e,r,n){var i,o,s,a,l,u,d,f=r.length;if(!r.every(x=>typeof x=="string"))return He(t,ta);function c(x){i=Hf(x),o=$f(x),s=x==="next"?zf:Vf;var b=r.map(function(h){return{lower:o(h),upper:i(h)}}).sort(function(h,_){return s(h.lower,_.lower)});a=b.map(function(h){return h.upper}),l=b.map(function(h){return h.lower}),u=x,d=x==="next"?"":n}c("next");var y=new t.Collection(t,()=>_t(a[0],l[f-1]+n));y._ondirectionchange=function(x){c(x)};var w=0;return y._addAlgorithm(function(x,b,h){var _=x.key;if(typeof _!="string")return!1;var p=o(_);if(e(p,l,w))return!0;for(var m=null,v=w;v<f;++v){var g=Wf(_,p,a[v],l[v],s,u);g===null&&m===null?w=v+1:(m===null||s(m,g)>0)&&(m=g)}return b(m!==null?function(){x.continue(m+d)}:h),!1}),y}function _t(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function ca(t){return{type:1,lower:t,upper:t}}var po=class{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||i)&&!(n&&i)?mr(this):new this.Collection(this,()=>_t(e,r,!n,!i))}catch{return He(this,st)}}equals(e){return e==null?He(this,st):new this.Collection(this,()=>ca(e))}above(e){return e==null?He(this,st):new this.Collection(this,()=>_t(e,void 0,!0))}aboveOrEqual(e){return e==null?He(this,st):new this.Collection(this,()=>_t(e,void 0,!1))}below(e){return e==null?He(this,st):new this.Collection(this,()=>_t(void 0,e,!1,!0))}belowOrEqual(e){return e==null?He(this,st):new this.Collection(this,()=>_t(void 0,e))}startsWith(e){return typeof e!="string"?He(this,ta):this.between(e,e+Ht,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):$n(this,(r,n)=>r.indexOf(n[0])===0,[e],Ht)}equalsIgnoreCase(e){return $n(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=it.apply(ur,arguments);return e.length===0?mr(this):$n(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=it.apply(ur,arguments);return e.length===0?mr(this):$n(this,(r,n)=>n.some(i=>r.indexOf(i)===0),e,Ht)}anyOf(){let e=it.apply(ur,arguments),r=this._cmp;try{e.sort(r)}catch{return He(this,st)}if(e.length===0)return mr(this);let n=new this.Collection(this,()=>_t(e[0],e[e.length-1]));n._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,e.sort(r)};let i=0;return n._addAlgorithm((o,s,a)=>{let l=o.key;for(;r(l,e[i])>0;)if(++i,i===e.length)return s(a),!1;return r(l,e[i])===0?!0:(s(()=>{o.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[ao,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=it.apply(ur,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return He(this,st)}let r=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[ao,i]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){let n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(e.length===0)return mr(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&i(m[0],m[1])<=0))return He(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",V.InvalidArgument);let l=!r||r.includeLowers!==!1,u=r&&r.includeUppers===!0;function d(m,v){let g=0,j=m.length;for(;g<j;++g){let C=m[g];if(n(v[0],C[1])<0&&n(v[1],C[0])>0){C[0]=s(C[0],v[0]),C[1]=a(C[1],v[1]);break}}return g===j&&m.push(v),m}let f=i;function c(m,v){return f(m[0],v[0])}let y;try{y=e.reduce(d,[]),y.sort(c)}catch{return He(this,st)}let w=0,x=u?m=>i(m,y[w][1])>0:m=>i(m,y[w][1])>=0,b=l?m=>o(m,y[w][0])>0:m=>o(m,y[w][0])>=0;function h(m){return!x(m)&&!b(m)}let _=x,p=new this.Collection(this,()=>_t(y[0][0],y[y.length-1][1],!l,!u));return p._ondirectionchange=m=>{m==="next"?(_=x,f=i):(_=b,f=o),y.sort(c)},p._addAlgorithm((m,v,g)=>{for(var j=m.key;_(j);)if(++w,w===y.length)return v(g),!1;return h(j)?!0:(this._cmp(j,y[w][1])===0||this._cmp(j,y[w][0])===0||v(()=>{f===i?m.continue(y[w][0]):m.continue(y[w][1])}),!1)}),p}startsWithAnyOf(){let e=it.apply(ur,arguments);return e.every(r=>typeof r=="string")?e.length===0?mr(this):this.inAnyRange(e.map(r=>[r,r+Ht])):He(this,"startsWithAnyOf() only works with strings")}};function Uf(t){return Zr(po.prototype,function(r,n,i){this.db=t,this._ctx={table:r,index:n===":id"?null:n,or:i};let o=t._deps.indexedDB;if(!o)throw new V.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(s,a)=>o.cmp(a,s),this._max=(s,a)=>o.cmp(s,a)>0?s:a,this._min=(s,a)=>o.cmp(s,a)<0?s:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function Xe(t){return se(function(e){return en(e),t(e.target.error),!1})}function en(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var tn="storagemutated",bt="x-storagemutated-1",xt=Xr(null,tn),fa=class{_lock(){return Vr(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this}_unlock(){if(Vr(!K.global),--this._reculock==0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{hr(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&K.lockOwnerFor!==this}create(e){if(!this.mode)return this;let r=this.db.idbdb,n=this.db._state.dbOpenError;if(Vr(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new V.DatabaseClosed(n);case"MissingAPIError":throw new V.MissingAPI(n.message,n);default:throw new V.OpenFailed(n)}if(!this.active)throw new V.TransactionInactive;return Vr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=se(i=>{en(i),this._reject(e.error)}),e.onabort=se(i=>{en(i),this.active&&this._reject(new V.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=se(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&xt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return ye(new V.ReadOnly("Transaction is readonly"));if(!this.active)return ye(new V.TransactionInactive);if(this._locked())return new M((o,s)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(o,s)},K])});if(n)return yt(()=>{var o=new M((s,a)=>{this._lock();let l=r(s,a,this);l&&l.then&&l.then(s,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new M((o,s)=>{var a=r(o,s,this);a&&a.then&&a.then(o,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();let n=M.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function s(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=r._waitingFor;return new M((s,a)=>{n.then(l=>r._waitingQueue.push(se(s.bind(null,l))),l=>r._waitingQueue.push(se(a.bind(null,l)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new V.Abort))}table(e){let r=this._memoizedTables||(this._memoizedTables={});if(Ve(r,e))return r[e];let n=this.schema[e];if(!n)throw new V.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),r[e]=i,i}};function Gf(t){return Zr(fa.prototype,function(r,n,i,o,s){this.db=t,this.mode=r,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Xr(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new M((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),ye(a)})})}function mo(t,e,r,n,i,o,s){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+da(e)}}function da(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function ha(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:ks(r,n=>[n.name,n])}}function Qf(t){return t.length===1?t[0]:t}var rn=t=>{try{return t.only([[]]),rn=()=>[[]],[[]]}catch{return rn=()=>Ht,Ht}};function go(t){return t==null?()=>{}:typeof t=="string"?qf(t):e=>nt(e,t)}function qf(t){return t.split(".").length===1?r=>r[t]:r=>nt(r,t)}function pa(t){return[].slice.call(t)}var Yf=0;function nn(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Jf(t,e,r){function n(d,f){let c=pa(d.objectStoreNames);return{schema:{name:d.name,tables:c.map(y=>f.objectStore(y)).map(y=>{let{keyPath:w,autoIncrement:x}=y,b=Te(w),h=w==null,_={},p={name:y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:h,compound:b,keyPath:w,autoIncrement:x,unique:!0,extractKey:go(w)},indexes:pa(y.indexNames).map(m=>y.index(m)).map(m=>{let{name:v,unique:g,multiEntry:j,keyPath:C}=m,S=Te(C),E={name:v,compound:S,keyPath:C,unique:g,multiEntry:j,extractKey:go(C)};return _[nn(C)]=E,E}),getIndexByKeyPath:m=>_[nn(m)]};return _[":id"]=p.primaryKey,w!=null&&(_[nn(w)]=p.primaryKey),p})},hasGetAll:c.length>0&&"getAll"in f.objectStore(c[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:f,upper:c,lowerOpen:y,upperOpen:w}=d;return f===void 0?c===void 0?null:e.upperBound(c,!!w):c===void 0?e.lowerBound(f,!!y):e.bound(f,c,!!y,!!w)}function o(d){let f=d.name;function c({trans:x,type:b,keys:h,values:_,range:p}){return new Promise((m,v)=>{m=se(m);let g=x.objectStore(f),j=g.keyPath==null,C=b==="put"||b==="add";if(!C&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);let{length:S}=h||_||{length:1};if(h&&_&&h.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(S===0)return m({numFailures:0,failures:{},results:[],lastResult:void 0});let E,P=[],L=[],k=0,z=Q=>{++k,en(Q)};if(b==="deleteRange"){if(p.type===4)return m({numFailures:k,failures:L,results:[],lastResult:void 0});p.type===3?P.push(E=g.clear()):P.push(E=g.delete(i(p)))}else{let[Q,Z]=C?j?[_,h]:[_,null]:[h,null];if(C)for(let A=0;A<S;++A)P.push(E=Z&&Z[A]!==void 0?g[b](Q[A],Z[A]):g[b](Q[A])),E.onerror=z;else for(let A=0;A<S;++A)P.push(E=g[b](Q[A])),E.onerror=z}let J=Q=>{let Z=Q.target.result;P.forEach((A,F)=>A.error!=null&&(L[F]=A.error)),m({numFailures:k,failures:L,results:b==="delete"?h:P.map(A=>A.result),lastResult:Z})};E.onerror=Q=>{z(Q),J(Q)},E.onsuccess=J})}function y({trans:x,values:b,query:h,reverse:_,unique:p}){return new Promise((m,v)=>{m=se(m);let{index:g,range:j}=h,C=x.objectStore(f),S=g.isPrimaryKey?C:C.index(g.name),E=_?p?"prevunique":"prev":p?"nextunique":"next",P=b||!("openKeyCursor"in S)?S.openCursor(i(j),E):S.openKeyCursor(i(j),E);P.onerror=Xe(v),P.onsuccess=se(L=>{let k=P.result;if(!k){m(null);return}k.___id=++Yf,k.done=!1;let z=k.continue.bind(k),J=k.continuePrimaryKey;J&&(J=J.bind(k));let Q=k.advance.bind(k),Z=()=>{throw new Error("Cursor not started")},A=()=>{throw new Error("Cursor not stopped")};k.trans=x,k.stop=k.continue=k.continuePrimaryKey=k.advance=Z,k.fail=se(v),k.next=function(){let F=1;return this.start(()=>F--?this.continue():this.stop()).then(()=>this)},k.start=F=>{let D=new Promise((O,X)=>{O=se(O),P.onerror=Xe(X),k.fail=X,k.stop=le=>{k.stop=k.continue=k.continuePrimaryKey=k.advance=A,O(le)}}),N=()=>{if(P.result)try{F()}catch(O){k.fail(O)}else k.done=!0,k.start=()=>{throw new Error("Cursor behind last entry")},k.stop()};return P.onsuccess=se(O=>{P.onsuccess=N,N()}),k.continue=z,k.continuePrimaryKey=J,k.advance=Q,N(),D},m(k)},v)})}function w(x){return b=>new Promise((h,_)=>{h=se(h);let{trans:p,values:m,limit:v,query:g}=b,j=v===1/0?void 0:v,{index:C,range:S}=g,E=p.objectStore(f),P=C.isPrimaryKey?E:E.index(C.name),L=i(S);if(v===0)return h({result:[]});if(x){let k=m?P.getAll(L,j):P.getAllKeys(L,j);k.onsuccess=z=>h({result:z.target.result}),k.onerror=Xe(_)}else{let k=0,z=m||!("openKeyCursor"in P)?P.openCursor(L):P.openKeyCursor(L),J=[];z.onsuccess=Q=>{let Z=z.result;if(!Z)return h({result:J});if(J.push(m?Z.value:Z.primaryKey),++k===v)return h({result:J});Z.continue()},z.onerror=Xe(_)}})}return{name:f,schema:d,mutate:c,getMany({trans:x,keys:b}){return new Promise((h,_)=>{h=se(h);let p=x.objectStore(f),m=b.length,v=new Array(m),g=0,j=0,C,S=P=>{let L=P.target;(v[L._pos]=L.result)!=null,++j===g&&h(v)},E=Xe(_);for(let P=0;P<m;++P)b[P]!=null&&(C=p.get(b[P]),C._pos=P,C.onsuccess=S,C.onerror=E,++g);g===0&&h(v)})},get({trans:x,key:b}){return new Promise((h,_)=>{h=se(h);let m=x.objectStore(f).get(b);m.onsuccess=v=>h(v.target.result),m.onerror=Xe(_)})},query:w(a),openCursor:y,count({query:x,trans:b}){let{index:h,range:_}=x;return new Promise((p,m)=>{let v=b.objectStore(f),g=h.isPrimaryKey?v:v.index(h.name),j=i(_),C=j?g.count(j):g.count();C.onsuccess=se(S=>p(S.target.result)),C.onerror=Xe(m)})}}}let{schema:s,hasGetAll:a}=n(t,r),l=s.tables.map(d=>o(d)),u={};return l.forEach(d=>u[d.name]=d),{stack:"dbcore",transaction:t.transaction.bind(t),table(d){if(!u[d])throw new Error(`Table '${d}' not found`);return u[d]},MIN_KEY:-1/0,MAX_KEY:rn(e),schema:s}}function Xf(t,e){return e.reduce((r,{create:n})=>ue(ue({},r),n(r)),t)}function Zf(t,e,{IDBKeyRange:r,indexedDB:n},i){return{dbcore:Xf(Jf(e,r,i),t.dbcore)}}function yo({_novip:t},e){let r=e.db,n=Zf(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(i=>{let o=i.name;t.core.schema.tables.some(s=>s.name===o)&&(i.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=i.core))})}function Wn({_novip:t},e,r,n){r.forEach(i=>{let o=n[i];e.forEach(s=>{let a=Ni(s,i);(!a||"value"in a&&a.value===void 0)&&(s===t.Transaction.prototype||s instanceof t.Transaction?rt(s,i,{get(){return this.table(i)},set(l){Ts(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new t.Table(i,o))})})}function vo({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function ed(t,e){return t._cfg.version-e._cfg.version}function td(t,e,r,n){let i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(r),o._completion.catch(n);let s=o._reject.bind(o),a=K.transless||K;yt(()=>{K.trans=o,K.transless=a,e===0?(he(i).forEach(l=>{_o(r,l,i[l].primKey,i[l].indexes)}),yo(t,r),M.follow(()=>t.on.populate.fire(o)).catch(s)):rd(t,e,o,r).catch(s)})}function rd({_novip:t},e,r,n){let i=[],o=t._versions,s=t._dbSchema=xo(t,t.idbdb,n),a=!1;o.filter(d=>d._cfg.version>=e).forEach(d=>{i.push(()=>{let f=s,c=d._cfg.dbschema;wo(t,f,n),wo(t,c,n),s=t._dbSchema=c;let y=ma(f,c);y.add.forEach(x=>{_o(n,x[0],x[1].primKey,x[1].indexes)}),y.change.forEach(x=>{if(x.recreate)throw new V.Upgrade("Not yet support for changing primary key");{let b=n.objectStore(x.name);x.add.forEach(h=>bo(b,h)),x.change.forEach(h=>{b.deleteIndex(h.name),bo(b,h)}),x.del.forEach(h=>b.deleteIndex(h))}});let w=d._cfg.contentUpgrade;if(w&&d._cfg.version>e){yo(t,n),r._memoizedTables={},a=!0;let x=Ps(c);y.del.forEach(p=>{x[p]=f[p]}),vo(t,[t.Transaction.prototype]),Wn(t,[t.Transaction.prototype],he(x),x),r.schema=x;let b=Hi(w);b&&dr();let h,_=M.follow(()=>{if(h=w(r),h&&b){var p=ot.bind(null,null);h.then(p,p)}});return h&&typeof h.then=="function"?M.resolve(h):_.then(()=>h)}}),i.push(f=>{if(!a||!Pf){let c=d._cfg.dbschema;id(c,f)}vo(t,[t.Transaction.prototype]),Wn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})});function u(){return i.length?M.resolve(i.shift()(r.idbtrans)).then(u):M.resolve()}return u().then(()=>{nd(s,n)})}function ma(t,e){let r={del:[],add:[],change:[]},n;for(n in t)e[n]||r.del.push(n);for(n in e){let i=t[n],o=e[n];if(!i)r.add.push([n,o]);else{let s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Nn)s.recreate=!0,r.change.push(s);else{let a=i.idxByName,l=o.idxByName,u;for(u in a)l[u]||s.del.push(u);for(u in l){let d=a[u],f=l[u];d?d.src!==f.src&&s.change.push(f):s.add.push(f)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}}return r}function _o(t,e,r,n){let i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(o=>bo(i,o)),i}function nd(t,e){he(t).forEach(r=>{e.db.objectStoreNames.contains(r)||_o(e,r,t[r].primKey,t[r].indexes)})}function id(t,e){[].slice.call(e.db.objectStoreNames).forEach(r=>t[r]==null&&e.db.deleteObjectStore(r))}function bo(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function xo(t,e,r){let n={};return An(e.objectStoreNames,0).forEach(o=>{let s=r.objectStore(o),a=s.keyPath,l=mo(da(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),u=[];for(let f=0;f<s.indexNames.length;++f){let c=s.index(s.indexNames[f]);a=c.keyPath;var d=mo(c.name,a,!!c.unique,!!c.multiEntry,!1,a&&typeof a!="string",!1);u.push(d)}n[o]=ha(o,l,u)}),n}function od({_novip:t},e,r){t.verno=e.version/10;let n=t._dbSchema=xo(t,e,r);t._storeNames=An(e.objectStoreNames,0),Wn(t,[t._allTables],he(n),n)}function sd(t,e){let r=xo(t,t.idbdb,e),n=ma(r,t._dbSchema);return!(n.add.length||n.change.some(i=>i.add.length||i.change.length))}function wo({_novip:t},e,r){let n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){let o=n[i],s=r.objectStore(o);t._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){let l=s.indexNames[a],u=s.index(l).keyPath,d=typeof u=="string"?u:"["+An(u).join("+")+"]";if(e[o]){let f=e[o].idxByName[d];f&&(f.name=l,delete e[o].idxByName[d],e[o].idxByName[l]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ie.WorkerGlobalScope&&ie instanceof ie.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function ad(t){return t.split(",").map((e,r)=>{e=e.trim();let n=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return mo(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Te(i),r===0)})}var ga=class{_parseStoresSpec(e,r){he(e).forEach(n=>{if(e[n]!==null){var i=ad(e[n]),o=i.shift();if(o.multi)throw new V.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new V.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new V.Schema("Index must have a name and cannot be an empty string")}),r[n]=ha(n,o,i)}})}stores(e){let r=this.db;this._cfg.storesSource=this._cfg.storesSource?Pe(this._cfg.storesSource,e):e;let n=r._versions,i={},o={};return n.forEach(s=>{Pe(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),r._dbSchema=o,vo(r,[r._allTables,r,r.Transaction.prototype]),Wn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],he(o),o),r._storeNames=he(o),this}upgrade(e){return this._cfg.contentUpgrade=Gi(this._cfg.contentUpgrade||ne,e),this}};function ld(t){return Zr(ga.prototype,function(r){this.db=t,this._cfg={version:r,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function jo(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new lt(Kn,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Co(t){return t&&typeof t.databases=="function"}function ud({indexedDB:t,IDBKeyRange:e}){return Co(t)?Promise.resolve(t.databases()).then(r=>r.map(n=>n.name).filter(n=>n!==Kn)):jo(t,e).toCollection().primaryKeys()}function cd({indexedDB:t,IDBKeyRange:e},r){!Co(t)&&r!==Kn&&jo(t,e).put({name:r}).catch(ne)}function fd({indexedDB:t,IDBKeyRange:e},r){!Co(t)&&r!==Kn&&jo(t,e).delete(r).catch(ne)}function Ao(t){return yt(function(){return K.letThrough=!0,t()})}function dd(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(r){var n=function(){return indexedDB.databases().finally(r)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}function hd(t){let e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?ye(e.dbOpenError):t);Je&&(e.openCanceller._stackHolder=Nt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new V.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,s=null,a=!1;return M.race([n,(typeof navigator=="undefined"?M.resolve():dd()).then(()=>new M((l,u)=>{if(i(),!r)throw new V.MissingAPI;let d=t.name,f=e.autoSchema?r.open(d):r.open(d,Math.round(t.verno*10));if(!f)throw new V.MissingAPI;f.onerror=Xe(u),f.onblocked=se(t._fireOnBlocked),f.onupgradeneeded=se(c=>{if(s=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=en,s.abort(),f.result.close();let w=r.deleteDatabase(d);w.onsuccess=w.onerror=se(()=>{u(new V.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{s.onerror=Xe(u);var y=c.oldVersion>Math.pow(2,62)?0:c.oldVersion;a=y<1,t._novip.idbdb=f.result,td(t,y/10,s,u)}},u),f.onsuccess=se(()=>{s=null;let c=t._novip.idbdb=f.result,y=An(c.objectStoreNames);if(y.length>0)try{let w=c.transaction(Qf(y),"readonly");e.autoSchema?od(t,c,w):(wo(t,t._dbSchema,w),sd(t,w)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),yo(t,w)}catch{}Jr.push(t),c.onversionchange=se(w=>{e.vcFired=!0,t.on("versionchange").fire(w)}),c.onclose=se(w=>{t.on("close").fire(w)}),a&&cd(t._deps,d),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],M.resolve(Ao(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(Gi,ne);return e.onReadyBeingFired=[],M.resolve(Ao(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{s&&s.abort()}catch{}return n===e.openCanceller&&t._close(),ye(l)}).finally(()=>{e.openComplete=!0,o()})}function So(t){var e=s=>t.next(s),r=s=>t.throw(s),n=o(e),i=o(r);function o(s){return a=>{var l=s(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?Te(u)?Promise.all(u).then(n,i):n(u):u.then(n,i)}}return o(e)()}function pd(t,e,r){var n=arguments.length;if(n<2)throw new V.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var o=Ms(i);return[t,o,r]}function ya(t,e,r,n,i){return M.resolve().then(()=>{let o=K.transless||K,s=t._createTransaction(e,r,t._dbSchema,n),a={trans:s,transless:o};if(n)s.idbtrans=n.idbtrans;else try{s.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===Ui.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>ya(t,e,r,null,i))):ye(f)}let l=Hi(i);l&&dr();let u,d=M.follow(()=>{if(u=i.call(s,s),u)if(l){var f=ot.bind(null,null);u.then(f,f)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=So(u))},a);return(u&&typeof u.then=="function"?M.resolve(u).then(f=>s.active?f:ye(new V.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):d.then(()=>u)).then(f=>(n&&s._resolve(),s._completion.then(()=>f))).catch(f=>(s._reject(f),ye(f)))})}function Un(t,e,r){let n=Te(t)?t.slice():[t];for(let i=0;i<r;++i)n.push(e);return n}function md(t){return Oe(ue({},t),{table(e){let r=t.table(e),{schema:n}=r,i={},o=[];function s(c,y,w){let x=nn(c),b=i[x]=i[x]||[],h=c==null?0:typeof c=="string"?1:c.length,_=y>0,p=Oe(ue({},w),{isVirtual:_,keyTail:y,keyLength:h,extractKey:go(c),unique:!_&&w.unique});if(b.push(p),p.isPrimaryKey||o.push(p),h>1){let m=h===2?c[0]:c.slice(0,h-1);s(m,y+1,w)}return b.sort((m,v)=>m.keyTail-v.keyTail),p}let a=s(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(let c of n.indexes)s(c.keyPath,0,c);function l(c){let y=i[nn(c)];return y&&y[0]}function u(c,y){return{type:c.type===1?2:c.type,lower:Un(c.lower,c.lowerOpen?t.MAX_KEY:t.MIN_KEY,y),lowerOpen:!0,upper:Un(c.upper,c.upperOpen?t.MIN_KEY:t.MAX_KEY,y),upperOpen:!0}}function d(c){let y=c.query.index;return y.isVirtual?Oe(ue({},c),{query:{index:y,range:u(c.query.range,y.keyTail)}}):c}return Oe(ue({},r),{schema:Oe(ue({},n),{primaryKey:a,indexes:o,getIndexByKeyPath:l}),count(c){return r.count(d(c))},query(c){return r.query(d(c))},openCursor(c){let{keyTail:y,isVirtual:w,keyLength:x}=c.query.index;if(!w)return r.openCursor(c);function b(h){function _(m){m!=null?h.continue(Un(m,c.reverse?t.MAX_KEY:t.MIN_KEY,y)):c.unique?h.continue(h.key.slice(0,x).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,y)):h.continue()}return Object.create(h,{continue:{value:_},continuePrimaryKey:{value(m,v){h.continuePrimaryKey(Un(m,t.MAX_KEY,y),v)}},primaryKey:{get(){return h.primaryKey}},key:{get(){let m=h.key;return x===1?m[0]:m.slice(0,x)}},value:{get(){return h.value}}})}return r.openCursor(d(c)).then(h=>h&&b(h))}})}})}var gd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:md};function Fo(t,e,r,n){return r=r||{},n=n||"",he(t).forEach(i=>{if(!Ve(e,i))r[n+i]=void 0;else{var o=t[i],s=e[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){let a=zi(o),l=zi(s);a!==l?r[n+i]=e[i]:a==="Object"?Fo(o,s,r,n+i+"."):o!==s&&(r[n+i]=e[i])}else o!==s&&(r[n+i]=e[i])}}),he(e).forEach(i=>{Ve(t,i)||(r[n+i]=e[i])}),r}function yd(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var vd={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>Oe(ue({},t),{table(e){let r=t.table(e),{primaryKey:n}=r.schema;return Oe(ue({},r),{mutate(o){let s=K.trans,{deleting:a,creating:l,updating:u}=s.table(e).hook;switch(o.type){case"add":if(l.fire===ne)break;return s._promise("readwrite",()=>d(o),!0);case"put":if(l.fire===ne&&u.fire===ne)break;return s._promise("readwrite",()=>d(o),!0);case"delete":if(a.fire===ne)break;return s._promise("readwrite",()=>d(o),!0);case"deleteRange":if(a.fire===ne)break;return s._promise("readwrite",()=>f(o),!0)}return r.mutate(o);function d(y){let w=K.trans,x=y.keys||yd(n,y);if(!x)throw new Error("Keys missing");return y=y.type==="add"||y.type==="put"?Oe(ue({},y),{keys:x}):ue({},y),y.type!=="delete"&&(y.values=[...y.values]),y.keys&&(y.keys=[...y.keys]),_d(r,y,x).then(b=>{let h=x.map((_,p)=>{let m=b[p],v={onerror:null,onsuccess:null};if(y.type==="delete")a.fire.call(v,_,m,w);else if(y.type==="add"||m===void 0){let g=l.fire.call(v,_,y.values[p],w);_==null&&g!=null&&(_=g,y.keys[p]=_,n.outbound||Qe(y.values[p],n.keyPath,_))}else{let g=Fo(m,y.values[p]),j=u.fire.call(v,g,_,m,w);if(j){let C=y.values[p];Object.keys(j).forEach(S=>{Ve(C,S)?C[S]=j[S]:Qe(C,S,j[S])})}}return v});return r.mutate(y).then(({failures:_,results:p,numFailures:m,lastResult:v})=>{for(let g=0;g<x.length;++g){let j=p?p[g]:x[g],C=h[g];j==null?C.onerror&&C.onerror(_[g]):C.onsuccess&&C.onsuccess(y.type==="put"&&b[g]?y.values[g]:j)}return{failures:_,results:p,numFailures:m,lastResult:v}}).catch(_=>(h.forEach(p=>p.onerror&&p.onerror(_)),Promise.reject(_)))})}function f(y){return c(y.trans,y.range,1e4)}function c(y,w,x){return r.query({trans:y,values:!1,query:{index:n,range:w},limit:x}).then(({result:b})=>d({type:"delete",keys:b,trans:y}).then(h=>h.numFailures>0?Promise.reject(h.failures[0]):b.length<x?{failures:[],numFailures:0,lastResult:void 0}:c(y,Oe(ue({},w),{lower:b[b.length-1],lowerOpen:!0}),x)))}}})}})};function _d(t,e,r){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}function va(t,e,r){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)Me(e.keys[i],t[o])===0&&(n.push(r?Hr(e.values[i]):e.values[i]),++o);return n.length===t.length?n:null}catch{return null}}var bd={stack:"dbcore",level:-1,create:t=>({table:e=>{let r=t.table(e);return Oe(ue({},r),{getMany:n=>{if(!n.cache)return r.getMany(n);let i=va(n.keys,n.trans._cache,n.cache==="clone");return i?M.resolve(i):r.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Hr(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))})}})};function Eo(t){return!("from"in t)}var at=function(t,e){if(this)Pe(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let r=new at;return t&&"d"in t&&Pe(r,t),r}};ar(at.prototype,{add(t){return Gn(this,t),this},addKey(t){return on(this,t,t),this},addKeys(t){return t.forEach(e=>on(this,e,e)),this},[Vi](){return Do(this)}});function on(t,e,r){let n=Me(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Eo(t))return Pe(t,{from:e,to:r,d:1});let i=t.l,o=t.r;if(Me(r,t.from)<0)return i?on(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},_a(t);if(Me(e,t.to)>0)return o?on(o,e,r):t.r={from:e,to:r,d:1,l:null,r:null},_a(t);Me(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),Me(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);let s=!t.r;i&&!t.l&&Gn(t,i),o&&s&&Gn(t,o)}function Gn(t,e){function r(n,{from:i,to:o,l:s,r:a}){on(n,i,o),s&&r(n,s),a&&r(n,a)}Eo(e)||r(t,e)}function xd(t,e){let r=Do(e),n=r.next();if(n.done)return!1;let i=n.value,o=Do(t),s=o.next(i.from),a=s.value;for(;!n.done&&!s.done;){if(Me(a.from,i.to)<=0&&Me(a.to,i.from)>=0)return!0;Me(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function Do(t){let e=Eo(t)?null:{s:0,n:t};return{next(r){let n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Me(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Me(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function _a(t){var e,r;let n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){let o=i==="r"?"l":"r",s=ue({},t),a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],s[i]=a[o],t[o]=s,s.d=ba(s)}t.d=ba(t)}function ba({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var wd={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,r=new at(t.MIN_KEY,t.MAX_KEY);return Oe(ue({},t),{table:n=>{let i=t.table(n),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:l}=s,u=Oe(ue({},i),{mutate:c=>{let y=c.trans,w=y.mutatedParts||(y.mutatedParts={}),x=g=>{let j=`idb://${e}/${n}/${g}`;return w[j]||(w[j]=new at)},b=x(""),h=x(":dels"),{type:_}=c,[p,m]=c.type==="deleteRange"?[c.range]:c.type==="delete"?[c.keys]:c.values.length<50?[[],c.values]:[],v=c.trans._cache;return i.mutate(c).then(g=>{if(Te(p)){_!=="delete"&&(p=g.results),b.addKeys(p);let j=va(p,v);!j&&_!=="add"&&h.addKeys(p),(j||m)&&jd(x,o,j,m)}else if(p){let j={from:p.lower,to:p.upper};h.add(j),b.add(j)}else b.add(r),h.add(r),o.indexes.forEach(j=>x(j.name).add(r));return g})}}),d=({query:{index:c,range:y}})=>{var w,x;return[c,new at((w=y.lower)!==null&&w!==void 0?w:t.MIN_KEY,(x=y.upper)!==null&&x!==void 0?x:t.MAX_KEY)]},f={get:c=>[s,new at(c.key)],getMany:c=>[s,new at().addKeys(c.keys)],count:d,query:d,openCursor:d};return he(f).forEach(c=>{u[c]=function(y){let{subscr:w}=K;if(w){let x=m=>{let v=`idb://${e}/${n}/${m}`;return w[v]||(w[v]=new at)},b=x(""),h=x(":dels"),[_,p]=f[c](y);if(x(_.name||"").add(p),!_.isPrimaryKey)if(c==="count")h.add(r);else{let m=c==="query"&&l&&y.values&&i.query(Oe(ue({},y),{values:!1}));return i[c].apply(this,arguments).then(v=>{if(c==="query"){if(l&&y.values)return m.then(({result:j})=>(b.addKeys(j),v));let g=y.values?v.result.map(a):v.result;y.values?b.addKeys(g):h.addKeys(g)}else if(c==="openCursor"){let g=v,j=y.values;return g&&Object.create(g,{key:{get(){return h.addKey(g.primaryKey),g.key}},primaryKey:{get(){let C=g.primaryKey;return h.addKey(C),C}},value:{get(){return j&&b.addKey(g.primaryKey),g.value}}})}return v})}}return i[c].apply(this,arguments)}}),u}})}};function jd(t,e,r,n){function i(o){let s=t(o.name||"");function a(u){return u!=null?o.extractKey(u):null}let l=u=>o.multiEntry&&Te(u)?u.forEach(d=>s.addKey(d)):s.addKey(u);(r||n).forEach((u,d)=>{let f=r&&a(r[d]),c=n&&a(n[d]);Me(f,c)!==0&&(f!=null&&l(f),c!=null&&l(c))})}e.indexes.forEach(i)}var lt=class{constructor(e,r){this._middlewares={},this.verno=0;let n=lt.dependencies;this._options=r=ue({addons:lt.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};let{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};o.dbReadyPromise=new M(s=>{o.dbReadyResolve=s}),o.openCanceller=new M((s,a)=>{o.cancelOpen=a}),this._state=o,this.name=e,this.on=Xr(this,"populate","blocked","versionchange","close",{ready:[Gi,ne]}),this.on.ready.subscribe=Is(this.on.ready.subscribe,s=>(a,l)=>{lt.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||M.resolve().then(a),l&&s(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&s(a);else{s(a);let d=this;l||s(function f(){d.on.ready.unsubscribe(a),d.on.ready.unsubscribe(f)})}})}),this.Collection=Kf(this),this.Table=Rf(this),this.Transaction=Gf(this),this.Version=ld(this),this.WhereClause=Uf(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=rn(r.IDBKeyRange),this._createTransaction=(s,a,l,u)=>new this.Transaction(s,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=s=>{this.on("blocked").fire(s),Jr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(s))},this.use(gd),this.use(vd),this.use(wd),this.use(bd),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new V.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new V.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let r=this._versions;var n=r.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(ed),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new M((r,n)=>{if(this._state.openComplete)return n(new V.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){n(new V.DatabaseClosed);return}this.open().catch(ne)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:i}){i&&this.unuse({stack:e,name:i});let o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:r,level:n??10,name:i}),o.sort((s,a)=>s.level-a.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:r?i.name!==r:!1)),this}open(){return hd(this)}_close(){let e=this._state,r=Jr.indexOf(this);if(r>=0&&Jr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new M(n=>{e.dbReadyResolve=n}),e.openCanceller=new M((n,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new V.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,r=this._state;return new M((n,i)=>{let o=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=se(()=>{fd(this._deps,this.name),n()}),s.onerror=Xe(i),s.onblocked=this._fireOnBlocked};if(e)throw new V.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return he(this._allTables).map(e=>this._allTables[e])}transaction(){let e=pd.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let i=K.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let s,a;try{if(a=r.map(u=>{var d=u instanceof this.Table?u.name:u;if(typeof d!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return d}),e=="r"||e===lo)s=lo;else if(e=="rw"||e==uo)s=uo;else throw new V.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===lo&&s===uo)if(o)i=null;else throw new V.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(o)i=null;else throw new V.SubTransaction("Table "+u+" not included in parent transaction.")}),o&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(d,f)=>{f(u)}):ye(u)}let l=ya.bind(null,this,s,a,i,n);return i?i._promise(s,l,"lock"):K.trans?hr(K.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!Ve(this._allTables,e))throw new V.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Cd=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",xa=class{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(!e||typeof e=="function"?{next:e,error:r,complete:n}:e)}[Cd](){return this}};function wa(t,e){return he(e).forEach(r=>{let n=t[r]||(t[r]=new at);Gn(n,e[r])}),t}function Ad(t){return new xa(e=>{let r=Hi(t);function n(y){r&&dr();let w=()=>yt(t,{subscr:y,trans:null}),x=K.trans?hr(K.transless,w):w();return r&&x.then(ot,ot),x}let i=!1,o={},s={},a={get closed(){return i},unsubscribe:()=>{i=!0,xt.storagemutated.unsubscribe(f)}};e.start&&e.start(a);let l=!1,u=!1;function d(){return he(s).some(y=>o[y]&&xd(o[y],s[y]))}let f=y=>{wa(o,y),d()&&c()},c=()=>{if(l||i)return;o={};let y={},w=n(y);u||(xt(tn,f),u=!0),l=!0,Promise.resolve(w).then(x=>{l=!1,!i&&(d()?c():(o={},s=y,e.next&&e.next(x)))},x=>{l=!1,e.error&&e.error(x),a.unsubscribe()})};return c(),a})}var To;try{To={indexedDB:ie.indexedDB||ie.mozIndexedDB||ie.webkitIndexedDB||ie.msIndexedDB,IDBKeyRange:ie.IDBKeyRange||ie.webkitIDBKeyRange}}catch{To={indexedDB:null,IDBKeyRange:null}}var Wt=lt;ar(Wt,Oe(ue({},Fn),{delete(t){return new Wt(t,{addons:[]}).delete()},exists(t){return new Wt(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return ud(Wt.dependencies).then(t)}catch{return ye(new V.MissingAPI)}},defineClass(){function t(e){Pe(this,e)}return t},ignoreTransaction(t){return K.trans?hr(K.transless,t):t()},vip:Ao,async:function(t){return function(){try{var e=So(t.apply(this,arguments));return!e||typeof e.then!="function"?M.resolve(e):e}catch(r){return ye(r)}}},spawn:function(t,e,r){try{var n=So(t.apply(r,e||[]));return!n||typeof n.then!="function"?M.resolve(n):n}catch(i){return ye(i)}},currentTransaction:{get:()=>K.trans||null},waitFor:function(t,e){let r=M.resolve(typeof t=="function"?Wt.ignoreTransaction(t):t).timeout(e||6e4);return K.trans?K.trans.waitFor(r):r},Promise:M,debug:{get:()=>Je,set:t=>{Ls(t,t==="dexie"?()=>!0:ra)}},derive:lr,extend:Pe,props:ar,override:Is,Events:Xr,on:xt,liveQuery:Ad,extendObservabilitySet:wa,getByKeyPath:nt,setByKeyPath:Qe,delByKeyPath:lf,shallowClone:Ps,deepClone:Hr,getObjectDiff:Fo,cmp:Me,asap:Os,minKey:ao,addons:[],connections:Jr,errnames:Ui,dependencies:To,semVer:ea,version:ea.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,r*2))}));Wt.maxKey=rn(Wt.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(xt(tn,t=>{if(!ut){let e;Nn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(bt,!0,!0,t)):e=new CustomEvent(bt,{detail:t}),ut=!0,dispatchEvent(e),ut=!1}}),addEventListener(bt,({detail:t})=>{ut||Qn(t)}));function Qn(t){let e=ut;try{ut=!0,xt.storagemutated.fire(t)}finally{ut=e}}var ut=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(bt);xt(tn,e=>{ut||t.postMessage(e)}),t.onmessage=e=>{e.data&&Qn(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){xt(tn,e=>{try{ut||(typeof localStorage!="undefined"&&localStorage.setItem(bt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:bt,changedParts:e})))}catch{}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===bt){let r=JSON.parse(e.newValue);r&&Qn(r.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",Sd)}function Sd({data:t}){t&&t.type===bt&&Qn(t.changedParts)}M.rejectionMapper=yf;Ls(Je,ra);var Ze=class extends lt{constructor(){super(Ze.dbName);this.version(Ze.dbVersion).stores({searchHistory:"++id",minisearch:"date"})}static async clearOldDatabases(){let e=(await indexedDB.databases()).filter(r=>r.name===Ze.dbName&&r.version!==Ze.dbVersion*10);if(e.length){console.log("Omnisearch - Those IndexedDb databases will be deleted:");for(let r of e)r.name&&indexedDB.deleteDatabase(r.name)}}static getInstance(){return Ze.instance||(Ze.instance=new Ze),Ze.instance}async clearCache(){await this.minisearch.clear()}},gr=Ze;gr.dbVersion=8,gr.dbName="omnisearch/cache/"+app.appId;var Be=gr.getInstance();var Ut=Cn(!1),sn='<strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>',Io=class extends Y.PluginSettingTab{constructor(e){super(app,e);this.plugin=e,Ut.subscribe(async r=>{I.showExcerpt=r,await pe(this.plugin)})}display(){let{containerEl:e}=this;if(e.empty(),app.loadLocalStorage(an)=="1"){let f=e.createEl("span");f.innerHTML='<strong style="color: var(--text-accent)">\u26A0\uFE0F OMNISEARCH IS DISABLED \u26A0\uFE0F</strong>'}e.createEl("h2",{text:"Omnisearch"});let r=e.createDiv();r.innerHTML=`
        <iframe src="https://github.com/sponsors/scambier/button" title="Sponsor scambier" height="35" width="116" style="border: 0;"></iframe>
        <a href='https://ko-fi.com/B0B6LQ2C' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://cdn.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
    `,new Y.Setting(e).setName("Indexing").setHeading();let n=new DocumentFragment;et()?n.createSpan({},f=>{f.innerHTML=`\u{1F44D} You have installed <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a>, Omnisearch will use it to index PDFs and images.
            <br />Text extraction only works on desktop, but the cache can be synchronized with your mobile device.`}):n.createSpan({},f=>{f.innerHTML='\u26A0\uFE0F Omnisearch requires <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a> to index PDFs and images.'}),new Y.Setting(e).setDesc(n);let i=new DocumentFragment;i.createSpan({},f=>{f.innerHTML="Include PDFs in search results"}),new Y.Setting(e).setName(`PDFs Indexing ${et()?"":"\u26A0\uFE0F Disabled"}`).setDesc(i).addToggle(f=>f.setValue(I.PDFIndexing).onChange(async c=>{I.PDFIndexing=c,await pe(this.plugin)})).setDisabled(!et());let o=new DocumentFragment;o.createSpan({},f=>{f.innerHTML="Include images in search results"}),new Y.Setting(e).setName(`Images Indexing ${et()?"":"\u26A0\uFE0F Disabled"}`).setDesc(o).addToggle(f=>f.setValue(I.imagesIndexing).onChange(async c=>{I.imagesIndexing=c,await pe(this.plugin)})).setDisabled(!et());let s=new DocumentFragment;s.createSpan({},f=>{f.innerHTML=`In addition to standard <code>md</code> files, Omnisearch can also index other <strong style="color: var(--text-accent)">plaintext</strong> files.<br/>
      Add extensions separated by a space, without the dot. Example: "<code>txt org</code>".<br />
      \u26A0\uFE0F <span style="color: var(--text-accent)">Using extensions of non-plaintext files (like .docx or .pptx) WILL cause crashes,
      because Omnisearch will try to index their content.</span><br />
      ${sn}`}),new Y.Setting(e).setName("Additional files to index").setDesc(s).addText(f=>{f.setValue(I.indexedFileTypes.join(" ")).setPlaceholder("Example: txt org").onChange(async c=>{I.indexedFileTypes=c.split(" "),await pe(this.plugin)})}),new Y.Setting(e).setName("Behavior").setHeading(),new Y.Setting(e).setName("Save index to cache").setDesc("Enable caching to speed up indexing time. In rare cases, the cache write may cause a freeze in Obsidian. This option will disable itself if it happens.").addToggle(f=>f.setValue(I.useCache).onChange(async c=>{I.useCache=c,await pe(this.plugin)})),new Y.Setting(e).setName(`Respect Obsidian's "Excluded Files"`).setDesc(`By default, files that are in Obsidian's "Options > Files & Links > Excluded Files" list are downranked in results.
        Enable this option to completely hide them`).addToggle(f=>f.setValue(I.hideExcluded).onChange(async c=>{I.hideExcluded=c,await pe(this.plugin)}));let a=new DocumentFragment;a.createSpan({},f=>{f.innerHTML=`Normalize diacritics in search terms. Words like "br\xFBl\xE9e" or "\u017Elu\u0165ou\u010Dk\xFD" will be indexed as "brulee" and "zlutoucky".<br/>
        \u26A0\uFE0F <span style="color: var(--text-accent)">You probably should <strong>NOT</strong> disable this.</span><br>
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${sn}
        `}),new Y.Setting(e).setName("Ignore diacritics").setDesc(a).addToggle(f=>f.setValue(I.ignoreDiacritics).onChange(async c=>{await Be.clearCache(),I.ignoreDiacritics=c,await pe(this.plugin)}));let l=new DocumentFragment;l.createSpan({},f=>{f.innerHTML=`Enable this if you want to be able to search for CamelCaseWords as separate words.<br/>        
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${sn}
        `}),new Y.Setting(e).setName("Split CamelCaseWords").setDesc(l).addToggle(f=>f.setValue(I.splitCamelCase).onChange(async c=>{await Be.clearCache(),I.splitCamelCase=c,await pe(this.plugin)})),new Y.Setting(e).setName("Simpler search").setDesc(`Enable this if Obsidian often freezes while making searches.
        Words shorter than 3 characters won't be used as prefixes; this can reduce search delay but will return fewer results.`).addToggle(f=>f.setValue(I.simpleSearch).onChange(async c=>{I.simpleSearch=c,await pe(this.plugin)})),new Y.Setting(e).setName("Open in new pane").setDesc("Open and create files in a new pane instead of the current pane.").addToggle(f=>f.setValue(I.openInNewPane).onChange(async c=>{I.openInNewPane=c,await pe(this.plugin)})),new Y.Setting(e).setName("User Interface").setHeading(),new Y.Setting(e).setName("Show ribbon button").setDesc("Add a button on the sidebar to open the Vault search modal.").addToggle(f=>f.setValue(I.ribbonIcon).onChange(async c=>{I.ribbonIcon=c,await pe(this.plugin),c?this.plugin.addRibbonButton():this.plugin.removeRibbonButton()})),new Y.Setting(e).setName("Show excerpts").setDesc("Shows the contextual part of the note that matches the search. Disable this to only show filenames in results.").addToggle(f=>f.setValue(I.showExcerpt).onChange(async c=>{Ut.set(c)})),new Y.Setting(e).setName("Render line return in excerpts").setDesc("Activate this option to render line returns in result excerpts.").addToggle(f=>f.setValue(I.renderLineReturnInExcerpts).onChange(async c=>{I.renderLineReturnInExcerpts=c,await pe(this.plugin)})),new Y.Setting(e).setName("Show previous query results").setDesc("Re-executes the previous query when opening Omnisearch.").addToggle(f=>f.setValue(I.showPreviousQueryResults).onChange(async c=>{I.showPreviousQueryResults=c,await pe(this.plugin)}));let u=new DocumentFragment;u.createSpan({},f=>{f.innerHTML=`Shows a button next to the search input, to create a note.
        Acts the same as the <code>shift \u21B5</code> shortcut, can be useful for mobile device users.`}),new Y.Setting(e).setName('Show "Create note" button').setDesc(u).addToggle(f=>f.setValue(I.showCreateButton).onChange(async c=>{I.showCreateButton=c,await pe(this.plugin)})),new Y.Setting(e).setName("Highlight matching words in results").setDesc("Will highlight matching results when enabled. See README for more customization options.").addToggle(f=>f.setValue(I.highlight).onChange(async c=>{I.highlight=c,await pe(this.plugin)})),new Y.Setting(e).setName("Results weighting").setHeading(),new Y.Setting(e).setName(`File name & declared aliases (default: ${Gt.weightBasename})`).addSlider(f=>this.weightSlider(f,"weightBasename")),new Y.Setting(e).setName(`File directory (default: ${Gt.weightDirectory})`).addSlider(f=>this.weightSlider(f,"weightDirectory")),new Y.Setting(e).setName(`Headings level 1 (default: ${Gt.weightH1})`).addSlider(f=>this.weightSlider(f,"weightH1")),new Y.Setting(e).setName(`Headings level 2 (default: ${Gt.weightH2})`).addSlider(f=>this.weightSlider(f,"weightH2")),new Y.Setting(e).setName(`Headings level 3 (default: ${Gt.weightH3})`).addSlider(f=>this.weightSlider(f,"weightH3")),new Y.Setting(e).setName("Debugging").setHeading(),new Y.Setting(e).setName("Enable verbose logging").setDesc("Adds a LOT of logs for debugging purposes. Don't forget to disable it.").addToggle(f=>f.setValue(I.verboseLogging).onChange(async c=>{I.verboseLogging=c,await pe(this.plugin)})),new Y.Setting(e).setName("Danger Zone").setHeading();let d=new DocumentFragment;if(d.createSpan({},f=>{f.innerHTML=`Disable Omnisearch on this device only.<br>
        ${sn}`}),new Y.Setting(e).setName("Disable on this device").setDesc(d).addToggle(f=>f.setValue(Oo()).onChange(async c=>{c?app.saveLocalStorage(an,"1"):app.saveLocalStorage(an),new Y.Notice("Omnisearch - Disabled. Please restart Obsidian.")})),wt()){let f=new DocumentFragment;f.createSpan({},c=>{c.innerHTML=`Erase all Omnisearch cache data.
          Use this if Omnisearch results are inconsistent, missing, or appear outdated.<br>
          ${sn}`}),new Y.Setting(e).setName("Clear cache data").setDesc(f).addButton(c=>{c.setButtonText("Clear cache"),c.onClick(async()=>{await Be.clearCache(),new Y.Notice("Omnisearch - Cache cleared. Please restart Obsidian.")})})}}weightSlider(e,r){e.setLimits(1,5,.1).setValue(I[r]).setDynamicTooltip().onChange(n=>{I[r]=n,pe(this.plugin)})}},Gt={useCache:!0,hideExcluded:!1,ignoreDiacritics:!0,indexedFileTypes:[],PDFIndexing:!1,imagesIndexing:!1,splitCamelCase:!1,openInNewPane:!1,ribbonIcon:!0,showExcerpt:!0,renderLineReturnInExcerpts:!0,showCreateButton:!1,highlight:!0,showPreviousQueryResults:!0,simpleSearch:!1,weightBasename:3,weightDirectory:2,weightH1:1.5,weightH2:1.3,weightH3:1.1,welcomeMessage:"",verboseLogging:!1},I=Object.assign({},Gt);async function ja(t){I=Object.assign({},Gt,await t.loadData()),Ut.set(I.showExcerpt)}async function pe(t){await t.saveData(I)}function Oo(){return app.loadLocalStorage(an)=="1"}var Ca=Fe(require("obsidian"));var Aa=/[\u4e00-\u9fa5]/;var Sa=100,ln=300,Fa=`suggestion-highlight omnisearch-highlight ${I.highlight?"omnisearch-default-highlight":""}`,an="omnisearch-disabled",U=new Bi,qn={ToggleExcerpts:"toggle-excerpts"},We=(o=>(o[o.Done=0]="Done",o[o.LoadingCache=1]="LoadingCache",o[o.ReadingFiles=2]="ReadingFiles",o[o.IndexingFiles=3]="IndexingFiles",o[o.WritingCache=4]="WritingCache",o))(We||{});var jt=Cn(0),Ea=!1;function ko(t){Ea=t}function Da(){return Ea}function Yn(){return app.plugins.plugins["cm-chs-patch"]}function et(){return app.plugins?.plugins?.["text-extractor"]?.api}function wt(){return!Ca.Platform.isIosApp&&I.useCache}var Ct=/[|\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var za=Fe(require("obsidian"));var ct=Fe(require("obsidian"));var Ia=Fe(require("crypto")),Oa=Fe(Ta());function At(...t){return t[1]!==null&&t[1]!==void 0&&t[2]!==null&&t[2]!==void 0?`<span>${t[1]}</span><span class="${Fa}">${t[2]}</span>`:"&lt;no content&gt;"}function Fd(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function ka(t){let e=t.split("/");return e.pop(),e.join("/")}function Ed(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"[$&]")}function St(t){if(!t.length)return/^$/g;let e="("+(Yn()?"":I.splitCamelCase?`^|${Ct.source}|[A-Z]`:`^|${Ct.source}`)+`)(${t.map(n=>Ed(n)).join("|")})`;return new RegExp(`${e}`,"giu")}function Jn(t,e){return t.headings?.filter(r=>r.level===e).map(r=>r.heading)??[]}function Xn(t,e){return(t+e)%e}function yr(t,e){try{let r=e??-1,n=Math.max(0,r-Sa),i=Math.min(t.length,r+ln);if(r>-1?t=(n>0?"\u2026":"")+t.slice(n,i).trim()+(i<t.length-1?"\u2026":""):t=t.slice(0,ln),I.renderLineReturnInExcerpts){let o=new RegExp(/(?:\r\n|\r|\n)/g);t=t.split(o).filter(a=>a).join(`
`);let s=t.lastIndexOf(`
`,r-n);s>0&&(t=t.slice(s))}return t=Fd(t),I.renderLineReturnInExcerpts&&(t=t.trim().replaceAll(`
`,"<br>")),t}catch(r){return new ct.Notice("Omnisearch - Error while creating excerpt, see developer console"),console.error("Omnisearch - Error while creating excerpt"),console.error(r),""}}function Mo(t){return t.replace(/(\*|_)+(.+?)(\*|_)+/g,(e,r,n)=>n)}function Pa(t){return t?.frontmatter?(0,ct.parseFrontMatterAliases)(t.frontmatter)??[]:[]}function Ma(t){let e=t?(0,ct.getAllTags)(t)??[]:[];return e=[...new Set(e.reduce((r,n)=>[...r,...n.split("/").filter(i=>i).map(i=>i.startsWith("#")?i:`#${i}`),n],[]))],e}function ft(t){return t==null?"":(t=t.replaceAll("`","[__omnisearch__backtick__]"),t=t.normalize("NFD").replace(/\p{Diacritic}/gu,""),t=t.replaceAll("[__omnisearch__backtick__]","`"),t)}function Qt(){return ct.Platform.isMacOS?"\u2318":"ctrl"}function cn(t){let e=!!et(),r=e&&I.PDFIndexing,n=e&&I.imagesIndexing;return Ro(t)||dn(t)||r&&fn(t)||n&&Zn(t)}function Zn(t){let e=qt(t);return e==="png"||e==="jpg"||e==="jpeg"}function fn(t){return qt(t)==="pdf"}function Ro(t){return[...I.indexedFileTypes,"md"].some(e=>t.endsWith(`.${e}`))}function dn(t){return t.endsWith(".canvas")}function qt(t){let e=t.split(".");return e[e.length-1]??""}function Ra(t){return ct.Platform.isMobileApp?(0,Oa.md5)(t.toString()):(0,Ia.createHash)("md5").update(t).digest("hex")}function La(t,e){let r=[],n=0,i=t.length;for(;n<i;)r.push(t.slice(n,n+=e));return r}function Ba(t){return t.replace(/([a-z](?=[A-Z]))/g,"$1 ").split(" ")}function fe(...t){Ka(console.log,...t)}function Na(...t){Ka(console.warn,...t)}function Ka(t,...e){if(I.verboseLogging){let r=new Date,n=`${r.getMinutes()}:${r.getSeconds()}:${r.getMilliseconds()}`;t("Omnisearch -",n+" -",...e)}}async function Dd(t){let e=app.vault.getFiles().find(o=>o.path===t);if(!e)throw new Error(`Invalid file path: "${t}"`);let r=null,n=et();if(Ro(t))r=await app.vault.cachedRead(e);else if(dn(t)){let o=JSON.parse(await app.vault.cachedRead(e)),s=[];for(let a of o.nodes)a.type==="text"?s.push(a.text):a.type==="file"&&s.push(a.file);for(let a of o.edges.filter(l=>!!l.label))s.push(a.label);r=s.join(`\r
`)}else if(n?.canFileBeExtracted(t))r=await n.extractText(e);else throw new Error(`Unsupported file type: "${t}"`);r==null&&(console.warn(`Omnisearch: ${r} content for file`,e.path),r=""),r=ft(r);let i=app.metadataCache.getFileCache(e);if(i&&i.frontmatter?.["excalidraw-plugin"]){let o=i.sections?.filter(s=>s.type==="comment")??[];for(let{start:s,end:a}of o.map(l=>l.position))r=r.substring(0,s.offset-1)+r.substring(a.offset)}return{basename:ft(e.basename),content:r,path:e.path,mtime:e.stat.mtime,tags:Ma(i),aliases:Pa(i).join(""),headings1:i?Jn(i,1).join(" "):"",headings2:i?Jn(i,2).join(" "):"",headings3:i?Jn(i,3).join(" "):""}}var Va=class{constructor(){this.nextQueryIsEmpty=!1;this.documents=new Map}async addToLiveCache(e){try{let r=await Dd(e);if(!r.path){console.error(`Missing .path field in IndexedDocument "${r.basename}", skipping`);return}this.documents.set(e,r)}catch(r){console.warn(`Omnisearch: Error while adding "${e}" to live cache`,r),this.removeFromLiveCache(e)}}removeFromLiveCache(e){this.documents.delete(e)}async getDocument(e){return this.documents.has(e)?this.documents.get(e):(fe("Generating IndexedDocument from",e),await this.addToLiveCache(e),this.documents.get(e))}async addToSearchHistory(e){if(!e){this.nextQueryIsEmpty=!0;return}this.nextQueryIsEmpty=!1;let r=await Be.searchHistory.toArray();r=r.filter(n=>n.query!==e).reverse(),r.unshift({query:e}),r=r.slice(0,10),await Be.searchHistory.clear(),await Be.searchHistory.bulkAdd(r)}async getSearchHistory(){let e=(await Be.searchHistory.toArray()).reverse().map(r=>r.query);return this.nextQueryIsEmpty&&e.unshift(""),e}getDocumentsChecksum(e){return Ra(JSON.stringify(e.sort((r,n)=>r.path<n.path?-1:r.path>n.path?1:0)))}async getMinisearchCache(){try{return(await Be.minisearch.toArray())[0]}catch(e){return new za.Notice("Omnisearch - Cache missing or invalid. Some freezes may occur while Omnisearch indexes your vault."),console.error("Omnisearch - Error while loading Minisearch cache"),console.error(e),null}}async writeMinisearchCache(e,r){let n=Array.from(r).map(([i,o])=>({path:i,mtime:o}));await Be.minisearch.clear(),await Be.minisearch.add({date:new Date().toISOString(),paths:n,data:e.toJSON()}),console.log("Omnisearch - Search cache written")}},we=new Va;function Td(t){let e,r,n,i,o,s,a,l,u=t[8].default,d=tr(u,t,t[7],null);return{c(){e=R("div"),r=R("div"),n=R("input"),o=W(),d&&d.c(),B(n,"class","prompt-input"),B(n,"placeholder",t[0]),B(n,"spellcheck","false"),B(n,"type","text"),B(r,"class","omnisearch-input-field"),B(e,"class","omnisearch-input-container")},m(f,c){$(f,e,c),T(e,r),T(r,n),t[9](n),Ii(n,t[1]),T(e,o),d&&d.m(e,null),s=!0,a||(l=[Ke(n,"input",t[10]),Cs(i=t[3].call(null,n)),Ke(n,"compositionend",t[11]),Ke(n,"compositionstart",t[12]),Ke(n,"input",t[4])],a=!0)},p(f,[c]){(!s||c&1)&&B(n,"placeholder",f[0]),c&2&&n.value!==f[1]&&Ii(n,f[1]),d&&d.p&&(!s||c&128)&&nr(d,u,f,f[7],s?rr(u,f[7],c,null):ir(f[7]),null)},i(f){s||(ee(d,f),s=!0)},o(f){re(d,f),s=!1},d(f){f&&H(e),t[9](null),d&&d.d(f),a=!1,Ue(l)}}}function Id(t,e,r){let{$$slots:n={},$$scope:i}=e,{initialValue:o=""}=e,{placeholder:s=""}=e,a=!1,l="",u,d=Pi();function f(p){r(1,l=p)}function c(p){p&&!a&&!l&&(a=!0,r(1,l=p),y())}function y(p){mt().then(()=>(u.focus(),mt())).then(()=>{u.select()})}let w=(0,Ha.debounce)(()=>{we.addToSearchHistory(""),d("input",l)},300);function x(p){tt[p?"unshift":"push"](()=>{u=p,r(2,u)})}function b(){l=this.value,r(1,l)}let h=p=>ko(!1),_=p=>ko(!0);return t.$$set=p=>{"initialValue"in p&&r(5,o=p.initialValue),"placeholder"in p&&r(0,s=p.placeholder),"$$scope"in p&&r(7,i=p.$$scope)},t.$$.update=()=>{if(t.$$.dirty&32){e:c(o)}},[s,l,u,y,w,o,f,i,n,x,b,h,_]}var $a=class extends Ae{constructor(e){super();De(this,e,Id,Td,be,{initialValue:5,placeholder:0,setInputValue:6})}get setInputValue(){return this.$$.ctx[6]}},ei=$a;function Od(t){let e,r,n,i,o=t[1].default,s=tr(o,t,t[0],null);return{c(){e=R("div"),s&&s.c(),B(e,"class","prompt-results")},m(a,l){$(a,e,l),s&&s.m(e,null),r=!0,n||(i=Ke(e,"mousedown",kd),n=!0)},p(a,[l]){s&&s.p&&(!r||l&1)&&nr(s,o,a,a[0],r?rr(o,a[0],l,null):ir(a[0]),null)},i(a){r||(ee(s,a),r=!0)},o(a){re(s,a),r=!1},d(a){a&&H(e),s&&s.d(a),n=!1,i()}}}var kd=t=>t.preventDefault();function Pd(t,e,r){let{$$slots:n={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&r(0,i=o.$$scope)},[i,n]}var Wa=class extends Ae{constructor(e){super();De(this,e,Pd,Od,be,{})}},ti=Wa;var Lo=Fe(require("obsidian"));async function ri(t,e=!1){let r=St(t.foundWords);r.exec(t.content);let n=r.lastIndex,i=!1;app.workspace.iterateAllLeaves(a=>{a.view instanceof Lo.MarkdownView&&!e&&a.getViewState().state?.file===t.path&&a.getViewState()?.pinned&&(app.workspace.setActiveLeaf(a,{focus:!0}),i=!0)}),i||await app.workspace.openLinkText(t.path,"",e);let o=app.workspace.getActiveViewOfType(Lo.MarkdownView);if(!o)return;let s=o.editor.offsetToPos(n);s.ch=0,o.editor.setCursor(s),o.editor.scrollIntoView({from:{line:s.line-10,ch:0},to:{line:s.line+10,ch:0}})}async function Ua(t,e=!1){try{let r;switch(app.vault.getConfig("newFileLocation")){case"current":r=(app.workspace.getActiveFile()?.parent?.path??"")+"/";break;case"folder":r=app.vault.getConfig("newFileFolderPath")+"/";break;default:r="";break}await app.workspace.openLinkText(`${r}${t}.md`,"",e)}catch(r){throw r.message="OmniSearch - Could not create note: "+r.message,console.error(r),r}}function Md(t){let e;return{c(){e=R("span"),e.innerHTML='<svg viewBox="0 0 100 100" class="add-note-glyph" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="M23.3,6.7c-3.7,0-6.7,3-6.7,6.7v73.3c0,3.7,3,6.7,6.7,6.7h28.4c-3.2-4.8-5.1-10.5-5.1-16.7c0-16.6,13.4-30,30-30 c2.3,0,4.5,0.3,6.7,0.8V31.7c0-0.9-0.3-1.7-1-2.4L60.7,7.6c-0.6-0.6-1.5-1-2.4-1L23.3,6.7z M56.7,13L77,33.3H60 c-1.8,0-3.3-1.5-3.3-3.3L56.7,13z M76.7,53.3c-12.9,0-23.3,10.4-23.3,23.3S63.8,100,76.7,100S100,89.6,100,76.7 S89.6,53.3,76.7,53.3z M76.7,63.3c1.8,0,3.3,1.5,3.3,3.3v6.7h6.7c1.8,0,3.3,1.5,3.3,3.3c0,1.8-1.5,3.3-3.3,3.3H80v6.7 c0,1.8-1.5,3.3-3.3,3.3c-1.8,0-3.3-1.5-3.3-3.3V80h-6.7c-1.8,0-3.3-1.5-3.3-3.3s1.5-3.3,3.3-3.3h6.7v-6.7 C73.3,64.8,74.8,63.3,76.7,63.3L76.7,63.3z"></path></svg>',B(e,"class","suggestion-flair"),B(e,"aria-label","Not created yet, select to create")},m(r,n){$(r,e,n)},p:ce,i:ce,o:ce,d(r){r&&H(e)}}}function Rd(t){"use strict";return[]}var Ga=class extends Ae{constructor(e){super();De(this,e,Rd,Md,be,{})}},Qa=Ga;function qa(t){let e,r;return e=new Qa({}),{c(){Le(e.$$.fragment)},m(n,i){ke(e,n,i),r=!0},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function Ld(t){let e,r,n,i,o,s=t[2]&&qa(t),a=t[4].default,l=tr(a,t,t[3],null);return{c(){e=R("div"),s&&s.c(),r=W(),l&&l.c(),B(e,"data-result-id",t[0]),B(e,"class","suggestion-item omnisearch-result"),Oi(e,"is-selected",t[1])},m(u,d){$(u,e,d),s&&s.m(e,null),T(e,r),l&&l.m(e,null),n=!0,i||(o=[Ke(e,"mousemove",t[5]),Ke(e,"click",t[6]),Ke(e,"auxclick",t[7])],i=!0)},p(u,[d]){u[2]?s?d&4&&ee(s,1):(s=qa(u),s.c(),ee(s,1),s.m(e,r)):s&&(Lt(),re(s,1,1,()=>{s=null}),Bt()),l&&l.p&&(!n||d&8)&&nr(l,a,u,u[3],n?rr(a,u[3],d,null):ir(u[3]),null),(!n||d&1)&&B(e,"data-result-id",u[0]),(!n||d&2)&&Oi(e,"is-selected",u[1])},i(u){n||(ee(s),ee(l,u),n=!0)},o(u){re(s),re(l,u),n=!1},d(u){u&&H(e),s&&s.d(),l&&l.d(u),i=!1,Ue(o)}}}function Bd(t,e,r){let{$$slots:n={},$$scope:i}=e,{id:o}=e,{selected:s=!1}=e,{glyph:a=!1}=e;function l(f){$e.call(this,t,f)}function u(f){$e.call(this,t,f)}function d(f){$e.call(this,t,f)}return t.$$set=f=>{"id"in f&&r(0,o=f.id),"selected"in f&&r(1,s=f.selected),"glyph"in f&&r(2,a=f.glyph),"$$scope"in f&&r(3,i=f.$$scope)},[o,s,a,i,n,l,u,d]}var Ya=class extends Ae{constructor(e){super();De(this,e,Bd,Ld,be,{id:0,selected:1,glyph:2})}},ni=Ya;var vr=Fe(require("obsidian"));function Ja(t){let e,r=t[1].matches.length+"",n,i,o=(t[1].matches.length>1?"matches":"match")+"",s;return{c(){e=R("span"),n=xe(r),i=xe("\xA0"),s=xe(o),B(e,"class","omnisearch-result__counter")},m(a,l){$(a,e,l),T(e,n),T(e,i),T(e,s)},p(a,l){l&2&&r!==(r=a[1].matches.length+"")&&Ge(n,r),l&2&&o!==(o=(a[1].matches.length>1?"matches":"match")+"")&&Ge(s,o)},d(a){a&&H(e)}}}function Xa(t){let e,r,n,i,o;return{c(){e=R("div"),r=R("span"),n=W(),i=R("span"),o=xe(t[6]),B(e,"class","omnisearch-result__folder-path")},m(s,a){$(s,e,a),T(e,r),t[12](r),T(e,n),T(e,i),T(i,o)},p(s,a){a&64&&Ge(o,s[6])},d(s){s&&H(e),t[12](null)}}}function Za(t){let e,r=t[8].replace(t[9],At)+"";return{c(){e=R("div"),B(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&768&&r!==(r=n[8].replace(n[9],At)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function el(t){let e,r,n;return{c(){e=R("div"),r=R("img"),ze(r,"width","100px"),Ti(r.src,n=t[5])||B(r,"src",n),B(r,"alt",""),B(e,"class","omnisearch-result__image-container")},m(i,o){$(i,e,o),T(e,r)},p(i,o){o&32&&!Ti(r.src,n=i[5])&&B(r,"src",n)},d(i){i&&H(e)}}}function Nd(t){let e,r,n,i,o,s,a=t[2].replace(t[9],At)+"",l,u,d,f=qt(t[1].path)+"",c,y,w,x,b,h,_=t[1].matches.length>0&&Ja(t),p=t[6]&&Xa(t),m=t[10]&&Za(t),v=t[5]&&el(t);return{c(){e=R("div"),r=R("div"),n=R("span"),i=R("span"),o=W(),s=R("span"),l=W(),u=R("span"),d=xe("."),c=xe(f),y=W(),_&&_.c(),w=W(),p&&p.c(),x=W(),b=R("div"),m&&m.c(),h=W(),v&&v.c(),B(u,"class","omnisearch-result__extension"),B(n,"class","omnisearch-result__title"),B(r,"class","omnisearch-result__title-container"),ze(b,"display","flex"),ze(b,"flex-direction","row")},m(g,j){$(g,e,j),T(e,r),T(r,n),T(n,i),t[11](i),T(n,o),T(n,s),s.innerHTML=a,T(n,l),T(n,u),T(u,d),T(u,c),T(n,y),_&&_.m(n,null),T(e,w),p&&p.m(e,null),T(e,x),T(e,b),m&&m.m(b,null),T(b,h),v&&v.m(b,null)},p(g,j){j&516&&a!==(a=g[2].replace(g[9],At)+"")&&(s.innerHTML=a),j&2&&f!==(f=qt(g[1].path)+"")&&Ge(c,f),g[1].matches.length>0?_?_.p(g,j):(_=Ja(g),_.c(),_.m(n,null)):_&&(_.d(1),_=null),g[6]?p?p.p(g,j):(p=Xa(g),p.c(),p.m(e,x)):p&&(p.d(1),p=null),g[10]?m?m.p(g,j):(m=Za(g),m.c(),m.m(b,h)):m&&(m.d(1),m=null),g[5]?v?v.p(g,j):(v=el(g),v.c(),v.m(b,null)):v&&(v.d(1),v=null)},d(g){g&&H(e),t[11](null),_&&_.d(),p&&p.d(),m&&m.d(),v&&v.d()}}}function Kd(t){let e,r;return e=new ni({props:{glyph:t[7],id:t[1].path,selected:t[0],$$slots:{default:[Nd]},$$scope:{ctx:t}}}),e.$on("click",t[13]),e.$on("auxclick",t[14]),e.$on("mousemove",t[15]),{c(){Le(e.$$.fragment)},m(n,i){ke(e,n,i),r=!0},p(n,[i]){let o={};i&128&&(o.glyph=n[7]),i&2&&(o.id=n[1].path),i&1&&(o.selected=n[0]),i&67454&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function zd(t,e,r){let n,i,o,s;_n(t,Ut,p=>r(10,s=p));let{selected:a=!1}=e,{note:l}=e,u=null,d="",f="",c,y;function w(p){tt[p?"unshift":"push"](()=>{y=p,r(4,y)})}function x(p){tt[p?"unshift":"push"](()=>{c=p,r(3,c)})}function b(p){$e.call(this,t,p)}function h(p){$e.call(this,t,p)}function _(p){$e.call(this,t,p)}t.$$set=p=>{"selected"in p&&r(0,a=p.selected),"note"in p&&r(1,l=p.note)},t.$$.update=()=>{if(t.$$.dirty&2){e:if(r(5,u=null),Zn(l.path)){let p=app.vault.getFiles().find(m=>m.path===l.path);p&&r(5,u=app.vault.getResourcePath(p))}}if(t.$$.dirty&2){e:r(9,n=St(l.foundWords))}if(t.$$.dirty&2){e:r(8,i=yr(l.content,l.matches[0]?.offset??-1))}if(t.$$.dirty&30){e:r(2,d=l.basename),r(6,f=ka(l.path)),I.ignoreDiacritics&&r(2,d=ft(d)),c&&(0,vr.setIcon)(c,"folder-open"),y&&(Zn(l.path)?(0,vr.setIcon)(y,"image"):fn(l.path)?(0,vr.setIcon)(y,"file-text"):dn(l.path)?(0,vr.setIcon)(y,"layout-dashboard"):(0,vr.setIcon)(y,"file"))}};e:r(7,o=!1);return[a,l,d,c,y,u,f,o,i,n,s,w,x,b,h,_]}var tl=class extends Ae{constructor(e){super();De(this,e,zd,Kd,be,{selected:0,note:1})}},rl=tl;var sl=Fe(ol()),Bo=["ext","path"],Yt=class{constructor(e=""){this.extensions=[];I.ignoreDiacritics&&(e=ft(e));let r=(0,sl.parse)(e.toLowerCase(),{tokenize:!0,keywords:Bo});r.text=r.text??[],r.exclude=r.exclude??{},r.exclude.text=r.exclude.text??[],Array.isArray(r.exclude.text)||(r.exclude.text=[r.exclude.text]);for(let n of Bo){let i=r[n];i&&(r[n]=Array.isArray(i)?i:[i]);let o=r.exclude[n];o&&(r.exclude[n]=Array.isArray(o)?o:[o])}this.query=r,this.extensions=this.query.ext??[]}isEmpty(){for(let e of Bo)if(this.query[e]?.length||this.query.text.length)return!1;return!0}segmentsToStr(){return this.query.text.join(" ")}getTags(){return this.query.text.filter(e=>e.startsWith("#"))}getTagsWithoutHashtag(){return this.getTags().map(e=>e.replace(/^#/,""))}getExactTerms(){return this.query.text.filter(e=>e.split(" ").length>1)}};var ae=function(){return ae=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},ae.apply(this,arguments)};function Vd(t,e,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(f){s(f)}}function l(d){try{u(n.throw(d))}catch(f){s(f)}}function u(d){d.done?o(d.value):i(d.value).then(a,l)}u((n=n.apply(t,e||[])).next())})}function Hd(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return l([u,d])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(d){u=[6,d],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function G(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}var $d="ENTRIES",al="KEYS",ll="VALUES",Se="",No=function(){function t(e,r){var n=e._tree,i=Array.from(n.keys());this.set=e,this._type=r,this._path=i.length>0?[{node:n,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=_r(this._path),r=e.node,n=e.keys;if(_r(n)===Se)return{done:!1,value:this.result()};var i=r.get(_r(n));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=_r(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var r=e.keys;return _r(r)}).filter(function(e){return e!==Se}).join("")},t.prototype.value=function(){return _r(this._path).node.get(Se)},t.prototype.result=function(){switch(this._type){case ll:return this.value();case al:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),_r=function(t){return t[t.length-1]},Wd=function(t,e,r){var n=new Map;if(e===void 0)return n;for(var i=e.length+1,o=i+r,s=new Uint8Array(o*i).fill(r+1),a=0;a<i;++a)s[a]=a;for(var l=1;l<o;++l)s[l*i]=l;return ul(t,e,r,n,s,1,i,""),n},ul=function(t,e,r,n,i,o,s,a){var l,u,d=o*s;try{e:for(var f=G(t.keys()),c=f.next();!c.done;c=f.next()){var y=c.value;if(y===Se){var w=i[d-1];w<=r&&n.set(a,[t.get(y),w])}else{for(var x=o,b=0;b<y.length;++b,++x){for(var h=y[b],_=s*x,p=_-s,m=i[_],v=Math.max(0,x-r-1),g=Math.min(s-1,x+r),j=v;j<g;++j){var C=h!==e[j],S=i[p+j]+ +C,E=i[p+j+1]+1,P=i[_+j]+1,L=i[_+j+1]=Math.min(S,E,P);L<m&&(m=L)}if(m>r)continue e}ul(t.get(y),e,r,n,i,x,s,a+y)}}}catch(k){l={error:k}}finally{try{c&&!c.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}},Ko=function(){function t(e,r){e===void 0&&(e=new Map),r===void 0&&(r=""),this._size=void 0,this._tree=e,this._prefix=r}return t.prototype.atPrefix=function(e){var r,n;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=me(oi(this._tree,e.slice(this._prefix.length)),2),o=i[0],s=i[1];if(o===void 0){var a=me(Ho(s),2),l=a[0],u=a[1];try{for(var d=G(l.keys()),f=d.next();!f.done;f=d.next()){var c=f.value;if(c!==Se&&c.startsWith(u)){var y=new Map;return y.set(c.slice(u.length),l.get(c)),new t(y,e)}}}catch(w){r={error:w}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}return new t(o,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,Ud(this._tree,e)},t.prototype.entries=function(){return new No(this,$d)},t.prototype.forEach=function(e){var r,n;try{for(var i=G(this),o=i.next();!o.done;o=i.next()){var s=me(o.value,2),a=s[0],l=s[1];e(a,l,this)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.fuzzyGet=function(e,r){return Wd(this._tree,e,r)},t.prototype.get=function(e){var r=zo(this._tree,e);return r!==void 0?r.get(Se):void 0},t.prototype.has=function(e){var r=zo(this._tree,e);return r!==void 0&&r.has(Se)},t.prototype.keys=function(){return new No(this,al)},t.prototype.set=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Vo(this._tree,e);return n.set(Se,r),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Vo(this._tree,e);return n.set(Se,r(n.get(Se))),this},t.prototype.fetch=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Vo(this._tree,e),i=n.get(Se);return i===void 0&&n.set(Se,i=r()),i},t.prototype.values=function(){return new No(this,ll)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var r,n,i=new t;try{for(var o=G(e),s=o.next();!s.done;s=o.next()){var a=me(s.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(d){r={error:d}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),oi=function(t,e,r){var n,i;if(r===void 0&&(r=[]),e.length===0||t==null)return[t,r];try{for(var o=G(t.keys()),s=o.next();!s.done;s=o.next()){var a=s.value;if(a!==Se&&e.startsWith(a))return r.push([t,a]),oi(t.get(a),e.slice(a.length),r)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r.push([t,e]),oi(void 0,"",r)},zo=function(t,e){var r,n;if(e.length===0||t==null)return t;try{for(var i=G(t.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s!==Se&&e.startsWith(s))return zo(t.get(s),e.slice(s.length))}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Vo=function(t,e){var r,n,i=e.length;e:for(var o=0;t&&o<i;){try{for(var s=(r=void 0,G(t.keys())),a=s.next();!a.done;a=s.next()){var l=a.value;if(l!==Se&&e[o]===l[0]){for(var u=Math.min(i-o,l.length),d=1;d<u&&e[o+d]===l[d];)++d;var f=t.get(l);if(d===l.length)t=f;else{var c=new Map;c.set(l.slice(d),f),t.set(e.slice(o,o+d),c),t.delete(l),t=c}o+=d;continue e}}}catch(w){r={error:w}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var y=new Map;return t.set(e.slice(o),y),y}return t},Ud=function(t,e){var r=me(oi(t,e),2),n=r[0],i=r[1];if(n!==void 0){if(n.delete(Se),n.size===0)cl(i);else if(n.size===1){var o=me(n.entries().next().value,2),s=o[0],a=o[1];fl(i,s,a)}}},cl=function(t){if(t.length!==0){var e=me(Ho(t),2),r=e[0],n=e[1];if(r.delete(n),r.size===0)cl(t.slice(0,-1));else if(r.size===1){var i=me(r.entries().next().value,2),o=i[0],s=i[1];o!==Se&&fl(t.slice(0,-1),o,s)}}},fl=function(t,e,r){if(t.length!==0){var n=me(Ho(t),2),i=n[0],o=n[1];i.set(o+e,r),i.delete(o)}},Ho=function(t){return t[t.length-1]},hn,$o="or",dl="and",Gd="and_not",Wo=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var r=e.autoVacuum==null||e.autoVacuum===!0?Yo:e.autoVacuum;this._options=ae(ae(ae({},Go),e),{autoVacuum:r,searchOptions:ae(ae({},hl),e.searchOptions||{}),autoSuggestOptions:ae(ae({},Xd),e.autoSuggestOptions||{})}),this._index=new Ko,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=qo,this.addFields(this._options.fields)}return t.prototype.add=function(e){var r,n,i,o,s,a,l=this._options,u=l.extractField,d=l.tokenize,f=l.processTerm,c=l.fields,y=l.idField,w=u(e,y);if(w==null)throw new Error('MiniSearch: document does not have ID field "'.concat(y,'"'));if(this._idToShortId.has(w))throw new Error("MiniSearch: duplicate ID ".concat(w));var x=this.addDocumentId(w);this.saveStoredFields(x,e);try{for(var b=G(c),h=b.next();!h.done;h=b.next()){var _=h.value,p=u(e,_);if(p!=null){var m=d(p.toString(),_),v=this._fieldIds[_],g=new Set(m).size;this.addFieldLength(x,v,this._documentCount-1,g);try{for(var j=(i=void 0,G(m)),C=j.next();!C.done;C=j.next()){var S=C.value,E=f(S,_);if(Array.isArray(E))try{for(var P=(s=void 0,G(E)),L=P.next();!L.done;L=P.next()){var k=L.value;this.addTerm(v,x,k)}}catch(z){s={error:z}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(s)throw s.error}}else E&&this.addTerm(v,x,E)}}catch(z){i={error:z}}finally{try{C&&!C.done&&(o=j.return)&&o.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{h&&!h.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}},t.prototype.addAll=function(e){var r,n;try{for(var i=G(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.addAllAsync=function(e,r){var n=this;r===void 0&&(r={});var i=r.chunkSize,o=i===void 0?10:i,s={chunk:[],promise:Promise.resolve()},a=e.reduce(function(d,f,c){var y=d.chunk,w=d.promise;return y.push(f),(c+1)%o==0?{chunk:[],promise:w.then(function(){return new Promise(function(x){return setTimeout(x,0)})}).then(function(){return n.addAll(y)})}:{chunk:y,promise:w}},s),l=a.chunk,u=a.promise;return u.then(function(){return n.addAll(l)})},t.prototype.remove=function(e){var r,n,i,o,s,a,l=this._options,u=l.tokenize,d=l.processTerm,f=l.extractField,c=l.fields,y=l.idField,w=f(e,y);if(w==null)throw new Error('MiniSearch: document does not have ID field "'.concat(y,'"'));var x=this._idToShortId.get(w);if(x==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(w,": it is not in the index"));try{for(var b=G(c),h=b.next();!h.done;h=b.next()){var _=h.value,p=f(e,_);if(p!=null){var m=u(p.toString(),_),v=this._fieldIds[_],g=new Set(m).size;this.removeFieldLength(x,v,this._documentCount,g);try{for(var j=(i=void 0,G(m)),C=j.next();!C.done;C=j.next()){var S=C.value,E=d(S,_);if(Array.isArray(E))try{for(var P=(s=void 0,G(E)),L=P.next();!L.done;L=P.next()){var k=L.value;this.removeTerm(v,x,k)}}catch(z){s={error:z}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(s)throw s.error}}else E&&this.removeTerm(v,x,E)}}catch(z){i={error:z}}finally{try{C&&!C.done&&(o=j.return)&&o.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{h&&!h.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}this._storedFields.delete(x),this._documentIds.delete(x),this._idToShortId.delete(w),this._fieldLength.delete(x),this._documentCount-=1},t.prototype.removeAll=function(e){var r,n;if(e)try{for(var i=G(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.remove(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Ko,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var r=this,n=this._idToShortId.get(e);if(n==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach(function(i,o){r.removeFieldLength(n,o,r._documentCount,i)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,r=e.minDirtFactor,n=e.minDirtCount,i=e.batchSize,o=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:o},{minDirtCount:n,minDirtFactor:r})}},t.prototype.discardAll=function(e){var r,n,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var o=G(e),s=o.next();!s.done;s=o.next()){var a=s.value;this.discard(a)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var r=this._options,n=r.idField,i=r.extractField,o=i(e,n);this.discard(o),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,r){var n=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&r,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=n._enqueuedVacuumConditions;return n._enqueuedVacuumConditions=qo,n.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(r)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,r){return Vd(this,void 0,void 0,function(){var n,i,o,s,a,l,u,d,f,c,y,w,x,b,h,_,p,m,v,g,j,C,S,E,P;return Hd(this,function(L){switch(L.label){case 0:if(n=this._dirtCount,!this.vacuumConditionsMet(r))return[3,10];i=e.batchSize||Qo.batchSize,o=e.batchWait||Qo.batchWait,s=1,L.label=1;case 1:L.trys.push([1,7,8,9]),a=G(this._index),l=a.next(),L.label=2;case 2:if(l.done)return[3,6];u=me(l.value,2),d=u[0],f=u[1];try{for(c=(C=void 0,G(f)),y=c.next();!y.done;y=c.next()){w=me(y.value,2),x=w[0],b=w[1];try{for(h=(E=void 0,G(b)),_=h.next();!_.done;_=h.next())p=me(_.value,1),m=p[0],!this._documentIds.has(m)&&(b.size<=1?f.delete(x):b.delete(m))}catch(k){E={error:k}}finally{try{_&&!_.done&&(P=h.return)&&P.call(h)}finally{if(E)throw E.error}}}}catch(k){C={error:k}}finally{try{y&&!y.done&&(S=c.return)&&S.call(c)}finally{if(C)throw C.error}}return this._index.get(d).size===0&&this._index.delete(d),s%i!=0?[3,4]:[4,new Promise(function(k){return setTimeout(k,o)})];case 3:L.sent(),L.label=4;case 4:s+=1,L.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return v=L.sent(),g={error:v},[3,9];case 8:try{l&&!l.done&&(j=a.return)&&j.call(a)}finally{if(g)throw g.error}return[7];case 9:this._dirtCount-=n,L.label=10;case 10:return[4,null];case 11:return L.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var r=e.minDirtCount,n=e.minDirtFactor;return r=r||Yo.minDirtCount,n=n||Yo.minDirtFactor,this.dirtCount>=r&&this.dirtFactor>=n},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.search=function(e,r){var n,i;r===void 0&&(r={});var o=this.executeQuery(e,r),s=[];try{for(var a=G(o),l=a.next();!l.done;l=a.next()){var u=me(l.value,2),d=u[0],f=u[1],c=f.score,y=f.terms,w=f.match,x=y.length,b={id:this._documentIds.get(d),score:c*x,terms:Object.keys(w),match:w};Object.assign(b,this._storedFields.get(d)),(r.filter==null||r.filter(b))&&s.push(b)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.sort(ml),s},t.prototype.autoSuggest=function(e,r){var n,i,o,s;r===void 0&&(r={}),r=ae(ae({},this._options.autoSuggestOptions),r);var a=new Map;try{for(var l=G(this.search(e,r)),u=l.next();!u.done;u=l.next()){var d=u.value,f=d.score,c=d.terms,y=c.join(" "),w=a.get(y);w!=null?(w.score+=f,w.count+=1):a.set(y,{score:f,terms:c,count:1})}}catch(v){n={error:v}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}var x=[];try{for(var b=G(a),h=b.next();!h.done;h=b.next()){var _=me(h.value,2),w=_[0],p=_[1],f=p.score,c=p.terms,m=p.count;x.push({suggestion:w,terms:c,score:f/m})}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}return x.sort(ml),x},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,r){if(r==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),r)},t.getDefault=function(e){if(Go.hasOwnProperty(e))return Uo(Go,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,r){var n,i,o,s,a,l,u=e.index,d=e.documentCount,f=e.nextId,c=e.documentIds,y=e.fieldIds,w=e.fieldLength,x=e.averageFieldLength,b=e.storedFields,h=e.dirtCount,_=e.serializationVersion;if(_!==1&&_!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var p=new t(r);p._documentCount=d,p._nextId=f,p._documentIds=si(c),p._idToShortId=new Map,p._fieldIds=y,p._fieldLength=si(w),p._avgFieldLength=x,p._storedFields=si(b),p._dirtCount=h||0,p._index=new Ko;try{for(var m=G(p._documentIds),v=m.next();!v.done;v=m.next()){var g=me(v.value,2),j=g[0],C=g[1];p._idToShortId.set(C,j)}}catch(F){n={error:F}}finally{try{v&&!v.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}try{for(var S=G(u),E=S.next();!E.done;E=S.next()){var P=me(E.value,2),L=P[0],k=P[1],z=new Map;try{for(var J=(a=void 0,G(Object.keys(k))),Q=J.next();!Q.done;Q=J.next()){var Z=Q.value,A=k[Z];_===1&&(A=A.ds),z.set(parseInt(Z,10),si(A))}}catch(F){a={error:F}}finally{try{Q&&!Q.done&&(l=J.return)&&l.call(J)}finally{if(a)throw a.error}}p._index.set(L,z)}}catch(F){o={error:F}}finally{try{E&&!E.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}return p},t.prototype.executeQuery=function(e,r){var n=this;if(r===void 0&&(r={}),typeof e!="string"){var i=ae(ae(ae({},r),e),{queries:void 0}),o=e.queries.map(function(b){return n.executeQuery(b,i)});return this.combineResults(o,e.combineWith)}var s=this._options,a=s.tokenize,l=s.processTerm,u=s.searchOptions,d=ae(ae({tokenize:a,processTerm:l},u),r),f=d.tokenize,c=d.processTerm,y=f(e).flatMap(function(b){return c(b)}).filter(function(b){return!!b}),w=y.map(Jd(d)),x=w.map(function(b){return n.executeQuerySpec(b,d)});return this.combineResults(x,d.combineWith)},t.prototype.executeQuerySpec=function(e,r){var n,i,o,s,a=ae(ae({},this._options.searchOptions),r),l=(a.fields||this._options.fields).reduce(function(Z,A){var F;return ae(ae({},Z),(F={},F[A]=Uo(Z,A)||1,F))},a.boost||{}),u=a.boostDocument,d=a.weights,f=a.maxFuzzy,c=a.bm25,y=ae(ae({},hl.weights),d),w=y.fuzzy,x=y.prefix,b=this._index.get(e.term),h=this.termResults(e.term,e.term,1,b,l,u,c),_,p;if(e.prefix&&(_=this._index.atPrefix(e.term)),e.fuzzy){var m=e.fuzzy===!0?.2:e.fuzzy,v=m<1?Math.min(f,Math.round(e.term.length*m)):m;v&&(p=this._index.fuzzyGet(e.term,v))}if(_)try{for(var g=G(_),j=g.next();!j.done;j=g.next()){var C=me(j.value,2),S=C[0],E=C[1],P=S.length-e.term.length;if(!!P){p==null||p.delete(S);var L=x*S.length/(S.length+.3*P);this.termResults(e.term,S,L,E,l,u,c,h)}}}catch(Z){n={error:Z}}finally{try{j&&!j.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}if(p)try{for(var k=G(p.keys()),z=k.next();!z.done;z=k.next()){var S=z.value,J=me(p.get(S),2),Q=J[0],P=J[1];if(!!P){var L=w*S.length/(S.length+P);this.termResults(e.term,S,L,Q,l,u,c,h)}}}catch(Z){o={error:Z}}finally{try{z&&!z.done&&(s=k.return)&&s.call(k)}finally{if(o)throw o.error}}return h},t.prototype.combineResults=function(e,r){if(r===void 0&&(r=$o),e.length===0)return new Map;var n=r.toLowerCase();return e.reduce(Qd[n])||new Map},t.prototype.toJSON=function(){var e,r,n,i,o=[];try{for(var s=G(this._index),a=s.next();!a.done;a=s.next()){var l=me(a.value,2),u=l[0],d=l[1],f={};try{for(var c=(n=void 0,G(d)),y=c.next();!y.done;y=c.next()){var w=me(y.value,2),x=w[0],b=w[1];f[x]=Object.fromEntries(b)}}catch(h){n={error:h}}finally{try{y&&!y.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}o.push([u,f])}}catch(h){e={error:h}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:o,serializationVersion:2}},t.prototype.termResults=function(e,r,n,i,o,s,a,l){var u,d,f,c,y;if(l===void 0&&(l=new Map),i==null)return l;try{for(var w=G(Object.keys(o)),x=w.next();!x.done;x=w.next()){var b=x.value,h=o[b],_=this._fieldIds[b],p=i.get(_);if(p!=null){var m=p.size,v=this._avgFieldLength[_];try{for(var g=(f=void 0,G(p.keys())),j=g.next();!j.done;j=g.next()){var C=j.value;if(!this._documentIds.has(C)){this.removeTerm(_,C,r),m-=1;continue}var S=s?s(this._documentIds.get(C),r):1;if(!!S){var E=p.get(C),P=this._fieldLength.get(C)[_],L=Yd(E,m,this._documentCount,P,v,a),k=n*h*S*L,z=l.get(C);if(z){z.score+=k,Zd(z.terms,e);var J=Uo(z.match,r);J?J.push(b):z.match[r]=[b]}else l.set(C,{score:k,terms:[e],match:(y={},y[r]=[b],y)})}}}catch(Q){f={error:Q}}finally{try{j&&!j.done&&(c=g.return)&&c.call(g)}finally{if(f)throw f.error}}}}}catch(Q){u={error:Q}}finally{try{x&&!x.done&&(d=w.return)&&d.call(w)}finally{if(u)throw u.error}}return l},t.prototype.addTerm=function(e,r,n){var i=this._index.fetch(n,gl),o=i.get(e);if(o==null)o=new Map,o.set(r,1),i.set(e,o);else{var s=o.get(r);o.set(r,(s||0)+1)}},t.prototype.removeTerm=function(e,r,n){if(!this._index.has(n)){this.warnDocumentChanged(r,e,n);return}var i=this._index.fetch(n,gl),o=i.get(e);o==null||o.get(r)==null?this.warnDocumentChanged(r,e,n):o.get(r)<=1?o.size<=1?i.delete(e):o.delete(r):o.set(r,o.get(r)-1),this._index.get(n).size===0&&this._index.delete(n)},t.prototype.warnDocumentChanged=function(e,r,n){var i,o;try{for(var s=G(Object.keys(this._fieldIds)),a=s.next();!a.done;a=s.next()){var l=a.value;if(this._fieldIds[l]===r){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(n,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var r=this._nextId;return this._idToShortId.set(e,r),this._documentIds.set(r,e),this._documentCount+=1,this._nextId+=1,r},t.prototype.addFields=function(e){for(var r=0;r<e.length;r++)this._fieldIds[e[r]]=r},t.prototype.addFieldLength=function(e,r,n,i){var o=this._fieldLength.get(e);o==null&&this._fieldLength.set(e,o=[]),o[r]=i;var s=this._avgFieldLength[r]||0,a=s*n+i;this._avgFieldLength[r]=a/(n+1)},t.prototype.removeFieldLength=function(e,r,n,i){if(n===1){this._avgFieldLength[r]=0;return}var o=this._avgFieldLength[r]*n-i;this._avgFieldLength[r]=o/(n-1)},t.prototype.saveStoredFields=function(e,r){var n,i,o=this._options,s=o.storeFields,a=o.extractField;if(!(s==null||s.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=G(s),d=u.next();!d.done;d=u.next()){var f=d.value,c=a(r,f);c!==void 0&&(l[f]=c)}}catch(y){n={error:y}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}},t}(),Uo=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},Qd=(hn={},hn[$o]=function(t,e){var r,n;try{for(var i=G(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value,a=t.get(s);if(a==null)t.set(s,e.get(s));else{var l=e.get(s),u=l.score,d=l.terms,f=l.match;a.score=a.score+u,a.match=Object.assign(a.match,f),pl(a.terms,d)}}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},hn[dl]=function(t,e){var r,n,i=new Map;try{for(var o=G(e.keys()),s=o.next();!s.done;s=o.next()){var a=s.value,l=t.get(a);if(l!=null){var u=e.get(a),d=u.score,f=u.terms,c=u.match;pl(l.terms,f),i.set(a,{score:l.score+d,terms:l.terms,match:Object.assign(l.match,c)})}}}catch(y){r={error:y}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},hn[Gd]=function(t,e){var r,n;try{for(var i=G(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;t.delete(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},hn),qd={k:1.2,b:.7,d:.5},Yd=function(t,e,r,n,i,o){var s=o.k,a=o.b,l=o.d,u=Math.log(1+(r-e+.5)/(e+.5));return u*(l+t*(s+1)/(t+s*(1-a+a*n/i)))},Jd=function(t){return function(e,r,n){var i=typeof t.fuzzy=="function"?t.fuzzy(e,r,n):t.fuzzy||!1,o=typeof t.prefix=="function"?t.prefix(e,r,n):t.prefix===!0;return{term:e,fuzzy:i,prefix:o}}},Go={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t,e){return t.split(eh)},processTerm:function(t,e){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e,r){return console!=null&&console.warn!=null&&console[t](e)},autoVacuum:!0},hl={combineWith:$o,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:qd},Xd={combineWith:dl,prefix:function(t,e,r){return e===r.length-1}},Qo={batchSize:1e3,batchWait:10},qo={minDirtFactor:.1,minDirtCount:20},Yo=ae(ae({},Qo),qo),Zd=function(t,e){t.includes(e)||t.push(e)},pl=function(t,e){var r,n;try{for(var i=G(e),o=i.next();!o.done;o=i.next()){var s=o.value;t.includes(s)||t.push(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},ml=function(t,e){var r=t.score,n=e.score;return n-r},gl=function(){return new Map},si=function(t){var e,r,n=new Map;try{for(var i=G(Object.keys(t)),o=i.next();!o.done;o=i.next()){var s=o.value;n.set(parseInt(s,10),t[s])}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},eh=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var _c=Fe(require("obsidian"));var th=typeof global=="object"&&global&&global.Object===Object&&global,ai=th;var rh=typeof self=="object"&&self&&self.Object===Object&&self,nh=ai||rh||Function("return this")(),je=nh;var ih=je.Symbol,Re=ih;var yl=Object.prototype,oh=yl.hasOwnProperty,sh=yl.toString,pn=Re?Re.toStringTag:void 0;function ah(t){var e=oh.call(t,pn),r=t[pn];try{t[pn]=void 0;var n=!0}catch{}var i=sh.call(t);return n&&(e?t[pn]=r:delete t[pn]),i}var vl=ah;var lh=Object.prototype,uh=lh.toString;function ch(t){return uh.call(t)}var _l=ch;var fh="[object Null]",dh="[object Undefined]",bl=Re?Re.toStringTag:void 0;function hh(t){return t==null?t===void 0?dh:fh:bl&&bl in Object(t)?vl(t):_l(t)}var qe=hh;function ph(t){return t!=null&&typeof t=="object"}var Ye=ph;var mh="[object Symbol]";function gh(t){return typeof t=="symbol"||Ye(t)&&qe(t)==mh}var dt=gh;function yh(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var br=yh;var vh=Array.isArray,de=vh;var _h=1/0,xl=Re?Re.prototype:void 0,wl=xl?xl.toString:void 0;function jl(t){if(typeof t=="string")return t;if(de(t))return br(t,jl)+"";if(dt(t))return wl?wl.call(t):"";var e=t+"";return e=="0"&&1/t==-_h?"-0":e}var Cl=jl;function bh(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Ft=bh;function xh(t){return t}var Et=xh;var wh="[object AsyncFunction]",jh="[object Function]",Ch="[object GeneratorFunction]",Ah="[object Proxy]";function Sh(t){if(!Ft(t))return!1;var e=qe(t);return e==jh||e==Ch||e==wh||e==Ah}var li=Sh;var Fh=je["__core-js_shared__"],ui=Fh;var Al=function(){var t=/[^.]+$/.exec(ui&&ui.keys&&ui.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Eh(t){return!!Al&&Al in t}var Sl=Eh;var Dh=Function.prototype,Th=Dh.toString;function Ih(t){if(t!=null){try{return Th.call(t)}catch{}try{return t+""}catch{}}return""}var ht=Ih;var Oh=/[\\^$.*+?()[\]{}|]/g,kh=/^\[object .+?Constructor\]$/,Ph=Function.prototype,Mh=Object.prototype,Rh=Ph.toString,Lh=Mh.hasOwnProperty,Bh=RegExp("^"+Rh.call(Lh).replace(Oh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Nh(t){if(!Ft(t)||Sl(t))return!1;var e=li(t)?Bh:kh;return e.test(ht(t))}var Fl=Nh;function Kh(t,e){return t==null?void 0:t[e]}var El=Kh;function zh(t,e){var r=El(t,e);return Fl(r)?r:void 0}var Ne=zh;var Vh=Ne(je,"WeakMap"),ci=Vh;function Hh(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Dl=Hh;var $h=800,Wh=16,Uh=Date.now;function Gh(t){var e=0,r=0;return function(){var n=Uh(),i=Wh-(n-r);if(r=n,i>0){if(++e>=$h)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Tl=Gh;function Qh(t){return function(){return t}}var Il=Qh;var qh=function(){try{var t=Ne(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Jo=qh;var Yh=Jo?function(t,e){return Jo(t,"toString",{configurable:!0,enumerable:!1,value:Il(e),writable:!0})}:Et,Ol=Yh;var Jh=Tl(Ol),kl=Jh;var Xh=9007199254740991,Zh=/^(?:0|[1-9]\d*)$/;function ep(t,e){var r=typeof t;return e=e??Xh,!!e&&(r=="number"||r!="symbol"&&Zh.test(t))&&t>-1&&t%1==0&&t<e}var xr=ep;function tp(t,e){return t===e||t!==t&&e!==e}var wr=tp;var Pl=Math.max;function rp(t,e,r){return e=Pl(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=Pl(n.length-e,0),s=Array(o);++i<o;)s[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(s),Dl(t,this,a)}}var Ml=rp;function np(t,e){return kl(Ml(t,e,Et),t+"")}var Rl=np;var ip=9007199254740991;function op(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ip}var jr=op;function sp(t){return t!=null&&jr(t.length)&&!li(t)}var Dt=sp;function ap(t,e,r){if(!Ft(r))return!1;var n=typeof e;return(n=="number"?Dt(r)&&xr(e,r.length):n=="string"&&e in r)?wr(r[e],t):!1}var Xo=ap;var lp=Object.prototype;function up(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||lp;return t===r}var Ll=up;function cp(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Bl=cp;var fp="[object Arguments]";function dp(t){return Ye(t)&&qe(t)==fp}var Zo=dp;var Nl=Object.prototype,hp=Nl.hasOwnProperty,pp=Nl.propertyIsEnumerable,mp=Zo(function(){return arguments}())?Zo:function(t){return Ye(t)&&hp.call(t,"callee")&&!pp.call(t,"callee")},Cr=mp;function gp(){return!1}var Kl=gp;var zl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Vl=zl&&typeof module=="object"&&module&&!module.nodeType&&module,yp=Vl&&Vl.exports===zl,Hl=yp?je.Buffer:void 0,vp=Hl?Hl.isBuffer:void 0,_p=vp||Kl,mn=_p;var bp="[object Arguments]",xp="[object Array]",wp="[object Boolean]",jp="[object Date]",Cp="[object Error]",Ap="[object Function]",Sp="[object Map]",Fp="[object Number]",Ep="[object Object]",Dp="[object RegExp]",Tp="[object Set]",Ip="[object String]",Op="[object WeakMap]",kp="[object ArrayBuffer]",Pp="[object DataView]",Mp="[object Float32Array]",Rp="[object Float64Array]",Lp="[object Int8Array]",Bp="[object Int16Array]",Np="[object Int32Array]",Kp="[object Uint8Array]",zp="[object Uint8ClampedArray]",Vp="[object Uint16Array]",Hp="[object Uint32Array]",oe={};oe[Mp]=oe[Rp]=oe[Lp]=oe[Bp]=oe[Np]=oe[Kp]=oe[zp]=oe[Vp]=oe[Hp]=!0;oe[bp]=oe[xp]=oe[kp]=oe[wp]=oe[Pp]=oe[jp]=oe[Cp]=oe[Ap]=oe[Sp]=oe[Fp]=oe[Ep]=oe[Dp]=oe[Tp]=oe[Ip]=oe[Op]=!1;function $p(t){return Ye(t)&&jr(t.length)&&!!oe[qe(t)]}var $l=$p;function Wp(t){return function(e){return t(e)}}var fi=Wp;var Wl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,gn=Wl&&typeof module=="object"&&module&&!module.nodeType&&module,Up=gn&&gn.exports===Wl,es=Up&&ai.process,Gp=function(){try{var t=gn&&gn.require&&gn.require("util").types;return t||es&&es.binding&&es.binding("util")}catch{}}(),ts=Gp;var Ul=ts&&ts.isTypedArray,Qp=Ul?fi(Ul):$l,di=Qp;var qp=Object.prototype,Yp=qp.hasOwnProperty;function Jp(t,e){var r=de(t),n=!r&&Cr(t),i=!r&&!n&&mn(t),o=!r&&!n&&!i&&di(t),s=r||n||i||o,a=s?Bl(t.length,String):[],l=a.length;for(var u in t)(e||Yp.call(t,u))&&!(s&&(u=="length"||i&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||xr(u,l)))&&a.push(u);return a}var Gl=Jp;function Xp(t,e){return function(r){return t(e(r))}}var Ql=Xp;var Zp=Ql(Object.keys,Object),ql=Zp;var em=Object.prototype,tm=em.hasOwnProperty;function rm(t){if(!Ll(t))return ql(t);var e=[];for(var r in Object(t))tm.call(t,r)&&r!="constructor"&&e.push(r);return e}var Yl=rm;function nm(t){return Dt(t)?Gl(t):Yl(t)}var Ar=nm;var im=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,om=/^\w*$/;function sm(t,e){if(de(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||dt(t)?!0:om.test(t)||!im.test(t)||e!=null&&t in Object(e)}var Sr=sm;var am=Ne(Object,"create"),pt=am;function lm(){this.__data__=pt?pt(null):{},this.size=0}var Jl=lm;function um(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Xl=um;var cm="__lodash_hash_undefined__",fm=Object.prototype,dm=fm.hasOwnProperty;function hm(t){var e=this.__data__;if(pt){var r=e[t];return r===cm?void 0:r}return dm.call(e,t)?e[t]:void 0}var Zl=hm;var pm=Object.prototype,mm=pm.hasOwnProperty;function gm(t){var e=this.__data__;return pt?e[t]!==void 0:mm.call(e,t)}var eu=gm;var ym="__lodash_hash_undefined__";function vm(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=pt&&e===void 0?ym:e,this}var tu=vm;function Fr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Fr.prototype.clear=Jl;Fr.prototype.delete=Xl;Fr.prototype.get=Zl;Fr.prototype.has=eu;Fr.prototype.set=tu;var rs=Fr;function _m(){this.__data__=[],this.size=0}var ru=_m;function bm(t,e){for(var r=t.length;r--;)if(wr(t[r][0],e))return r;return-1}var Tt=bm;var xm=Array.prototype,wm=xm.splice;function jm(t){var e=this.__data__,r=Tt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():wm.call(e,r,1),--this.size,!0}var nu=jm;function Cm(t){var e=this.__data__,r=Tt(e,t);return r<0?void 0:e[r][1]}var iu=Cm;function Am(t){return Tt(this.__data__,t)>-1}var ou=Am;function Sm(t,e){var r=this.__data__,n=Tt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var su=Sm;function Er(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Er.prototype.clear=ru;Er.prototype.delete=nu;Er.prototype.get=iu;Er.prototype.has=ou;Er.prototype.set=su;var It=Er;var Fm=Ne(je,"Map"),Ot=Fm;function Em(){this.size=0,this.__data__={hash:new rs,map:new(Ot||It),string:new rs}}var au=Em;function Dm(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var lu=Dm;function Tm(t,e){var r=t.__data__;return lu(e)?r[typeof e=="string"?"string":"hash"]:r.map}var kt=Tm;function Im(t){var e=kt(this,t).delete(t);return this.size-=e?1:0,e}var uu=Im;function Om(t){return kt(this,t).get(t)}var cu=Om;function km(t){return kt(this,t).has(t)}var fu=km;function Pm(t,e){var r=kt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var du=Pm;function Dr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Dr.prototype.clear=au;Dr.prototype.delete=uu;Dr.prototype.get=cu;Dr.prototype.has=fu;Dr.prototype.set=du;var Jt=Dr;var Mm="Expected a function";function ns(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Mm);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(ns.Cache||Jt),r}ns.Cache=Jt;var hu=ns;var Rm=500;function Lm(t){var e=hu(t,function(n){return r.size===Rm&&r.clear(),n}),r=e.cache;return e}var pu=Lm;var Bm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nm=/\\(\\)?/g,Km=pu(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Bm,function(r,n,i,o){e.push(i?o.replace(Nm,"$1"):n||r)}),e}),mu=Km;function zm(t){return t==null?"":Cl(t)}var gu=zm;function Vm(t,e){return de(t)?t:Sr(t,e)?[t]:mu(gu(t))}var hi=Vm;var Hm=1/0;function $m(t){if(typeof t=="string"||dt(t))return t;var e=t+"";return e=="0"&&1/t==-Hm?"-0":e}var Pt=$m;function Wm(t,e){e=hi(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Pt(e[r++])];return r&&r==n?t:void 0}var Tr=Wm;function Um(t,e,r){var n=t==null?void 0:Tr(t,e);return n===void 0?r:n}var yu=Um;function Gm(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var pi=Gm;var vu=Re?Re.isConcatSpreadable:void 0;function Qm(t){return de(t)||Cr(t)||!!(vu&&t&&t[vu])}var _u=Qm;function bu(t,e,r,n,i){var o=-1,s=t.length;for(r||(r=_u),i||(i=[]);++o<s;){var a=t[o];e>0&&r(a)?e>1?bu(a,e-1,r,n,i):pi(i,a):n||(i[i.length]=a)}return i}var xu=bu;function qm(){this.__data__=new It,this.size=0}var wu=qm;function Ym(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var ju=Ym;function Jm(t){return this.__data__.get(t)}var Cu=Jm;function Xm(t){return this.__data__.has(t)}var Au=Xm;var Zm=200;function eg(t,e){var r=this.__data__;if(r instanceof It){var n=r.__data__;if(!Ot||n.length<Zm-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Jt(n)}return r.set(t,e),this.size=r.size,this}var Su=eg;function Ir(t){var e=this.__data__=new It(t);this.size=e.size}Ir.prototype.clear=wu;Ir.prototype.delete=ju;Ir.prototype.get=Cu;Ir.prototype.has=Au;Ir.prototype.set=Su;var Or=Ir;function tg(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var s=t[r];e(s,r,t)&&(o[i++]=s)}return o}var Fu=tg;function rg(){return[]}var Eu=rg;var ng=Object.prototype,ig=ng.propertyIsEnumerable,Du=Object.getOwnPropertySymbols,og=Du?function(t){return t==null?[]:(t=Object(t),Fu(Du(t),function(e){return ig.call(t,e)}))}:Eu,Tu=og;function sg(t,e,r){var n=e(t);return de(t)?n:pi(n,r(t))}var Iu=sg;function ag(t){return Iu(t,Ar,Tu)}var is=ag;var lg=Ne(je,"DataView"),mi=lg;var ug=Ne(je,"Promise"),gi=ug;var cg=Ne(je,"Set"),yi=cg;var Ou="[object Map]",fg="[object Object]",ku="[object Promise]",Pu="[object Set]",Mu="[object WeakMap]",Ru="[object DataView]",dg=ht(mi),hg=ht(Ot),pg=ht(gi),mg=ht(yi),gg=ht(ci),Xt=qe;(mi&&Xt(new mi(new ArrayBuffer(1)))!=Ru||Ot&&Xt(new Ot)!=Ou||gi&&Xt(gi.resolve())!=ku||yi&&Xt(new yi)!=Pu||ci&&Xt(new ci)!=Mu)&&(Xt=function(t){var e=qe(t),r=e==fg?t.constructor:void 0,n=r?ht(r):"";if(n)switch(n){case dg:return Ru;case hg:return Ou;case pg:return ku;case mg:return Pu;case gg:return Mu}return e});var os=Xt;var yg=je.Uint8Array,ss=yg;var vg="__lodash_hash_undefined__";function _g(t){return this.__data__.set(t,vg),this}var Lu=_g;function bg(t){return this.__data__.has(t)}var Bu=bg;function vi(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Jt;++e<r;)this.add(t[e])}vi.prototype.add=vi.prototype.push=Lu;vi.prototype.has=Bu;var Nu=vi;function xg(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var Ku=xg;function wg(t,e){return t.has(e)}var zu=wg;var jg=1,Cg=2;function Ag(t,e,r,n,i,o){var s=r&jg,a=t.length,l=e.length;if(a!=l&&!(s&&l>a))return!1;var u=o.get(t),d=o.get(e);if(u&&d)return u==e&&d==t;var f=-1,c=!0,y=r&Cg?new Nu:void 0;for(o.set(t,e),o.set(e,t);++f<a;){var w=t[f],x=e[f];if(n)var b=s?n(x,w,f,e,t,o):n(w,x,f,t,e,o);if(b!==void 0){if(b)continue;c=!1;break}if(y){if(!Ku(e,function(h,_){if(!zu(y,_)&&(w===h||i(w,h,r,n,o)))return y.push(_)})){c=!1;break}}else if(!(w===x||i(w,x,r,n,o))){c=!1;break}}return o.delete(t),o.delete(e),c}var _i=Ag;function Sg(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var Vu=Sg;function Fg(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Hu=Fg;var Eg=1,Dg=2,Tg="[object Boolean]",Ig="[object Date]",Og="[object Error]",kg="[object Map]",Pg="[object Number]",Mg="[object RegExp]",Rg="[object Set]",Lg="[object String]",Bg="[object Symbol]",Ng="[object ArrayBuffer]",Kg="[object DataView]",$u=Re?Re.prototype:void 0,as=$u?$u.valueOf:void 0;function zg(t,e,r,n,i,o,s){switch(r){case Kg:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Ng:return!(t.byteLength!=e.byteLength||!o(new ss(t),new ss(e)));case Tg:case Ig:case Pg:return wr(+t,+e);case Og:return t.name==e.name&&t.message==e.message;case Mg:case Lg:return t==e+"";case kg:var a=Vu;case Rg:var l=n&Eg;if(a||(a=Hu),t.size!=e.size&&!l)return!1;var u=s.get(t);if(u)return u==e;n|=Dg,s.set(t,e);var d=_i(a(t),a(e),n,i,o,s);return s.delete(t),d;case Bg:if(as)return as.call(t)==as.call(e)}return!1}var Wu=zg;var Vg=1,Hg=Object.prototype,$g=Hg.hasOwnProperty;function Wg(t,e,r,n,i,o){var s=r&Vg,a=is(t),l=a.length,u=is(e),d=u.length;if(l!=d&&!s)return!1;for(var f=l;f--;){var c=a[f];if(!(s?c in e:$g.call(e,c)))return!1}var y=o.get(t),w=o.get(e);if(y&&w)return y==e&&w==t;var x=!0;o.set(t,e),o.set(e,t);for(var b=s;++f<l;){c=a[f];var h=t[c],_=e[c];if(n)var p=s?n(_,h,c,e,t,o):n(h,_,c,t,e,o);if(!(p===void 0?h===_||i(h,_,r,n,o):p)){x=!1;break}b||(b=c=="constructor")}if(x&&!b){var m=t.constructor,v=e.constructor;m!=v&&"constructor"in t&&"constructor"in e&&!(typeof m=="function"&&m instanceof m&&typeof v=="function"&&v instanceof v)&&(x=!1)}return o.delete(t),o.delete(e),x}var Uu=Wg;var Ug=1,Gu="[object Arguments]",Qu="[object Array]",bi="[object Object]",Gg=Object.prototype,qu=Gg.hasOwnProperty;function Qg(t,e,r,n,i,o){var s=de(t),a=de(e),l=s?Qu:os(t),u=a?Qu:os(e);l=l==Gu?bi:l,u=u==Gu?bi:u;var d=l==bi,f=u==bi,c=l==u;if(c&&mn(t)){if(!mn(e))return!1;s=!0,d=!1}if(c&&!d)return o||(o=new Or),s||di(t)?_i(t,e,r,n,i,o):Wu(t,e,l,r,n,i,o);if(!(r&Ug)){var y=d&&qu.call(t,"__wrapped__"),w=f&&qu.call(e,"__wrapped__");if(y||w){var x=y?t.value():t,b=w?e.value():e;return o||(o=new Or),i(x,b,r,n,o)}}return c?(o||(o=new Or),Uu(t,e,r,n,i,o)):!1}var Yu=Qg;function Ju(t,e,r,n,i){return t===e?!0:t==null||e==null||!Ye(t)&&!Ye(e)?t!==t&&e!==e:Yu(t,e,r,n,Ju,i)}var xi=Ju;var qg=1,Yg=2;function Jg(t,e,r,n){var i=r.length,o=i,s=!n;if(t==null)return!o;for(t=Object(t);i--;){var a=r[i];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<o;){a=r[i];var l=a[0],u=t[l],d=a[1];if(s&&a[2]){if(u===void 0&&!(l in t))return!1}else{var f=new Or;if(n)var c=n(u,d,l,t,e,f);if(!(c===void 0?xi(d,u,qg|Yg,n,f):c))return!1}}return!0}var Xu=Jg;function Xg(t){return t===t&&!Ft(t)}var wi=Xg;function Zg(t){for(var e=Ar(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,wi(i)]}return e}var Zu=Zg;function ey(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var ji=ey;function ty(t){var e=Zu(t);return e.length==1&&e[0][2]?ji(e[0][0],e[0][1]):function(r){return r===t||Xu(r,t,e)}}var ec=ty;function ry(t,e){return t!=null&&e in Object(t)}var tc=ry;function ny(t,e,r){e=hi(e,t);for(var n=-1,i=e.length,o=!1;++n<i;){var s=Pt(e[n]);if(!(o=t!=null&&r(t,s)))break;t=t[s]}return o||++n!=i?o:(i=t==null?0:t.length,!!i&&jr(i)&&xr(s,i)&&(de(t)||Cr(t)))}var rc=ny;function iy(t,e){return t!=null&&rc(t,e,tc)}var nc=iy;var oy=1,sy=2;function ay(t,e){return Sr(t)&&wi(e)?ji(Pt(t),e):function(r){var n=yu(r,t);return n===void 0&&n===e?nc(r,t):xi(e,n,oy|sy)}}var ic=ay;function ly(t){return function(e){return e==null?void 0:e[t]}}var oc=ly;function uy(t){return function(e){return Tr(e,t)}}var sc=uy;function cy(t){return Sr(t)?oc(Pt(t)):sc(t)}var ac=cy;function fy(t){return typeof t=="function"?t:t==null?Et:typeof t=="object"?de(t)?ic(t[0],t[1]):ec(t):ac(t)}var lc=fy;function dy(t){return function(e,r,n){for(var i=-1,o=Object(e),s=n(e),a=s.length;a--;){var l=s[t?a:++i];if(r(o[l],l,o)===!1)break}return e}}var uc=dy;var hy=uc(),cc=hy;function py(t,e){return t&&cc(t,e,Ar)}var fc=py;function my(t,e){return function(r,n){if(r==null)return r;if(!Dt(r))return t(r,n);for(var i=r.length,o=e?i:-1,s=Object(r);(e?o--:++o<i)&&n(s[o],o,s)!==!1;);return r}}var dc=my;var gy=dc(fc),hc=gy;function yy(t,e){var r=-1,n=Dt(t)?Array(t.length):[];return hc(t,function(i,o,s){n[++r]=e(i,o,s)}),n}var pc=yy;function vy(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}var mc=vy;function _y(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,o=dt(t),s=e!==void 0,a=e===null,l=e===e,u=dt(e);if(!a&&!u&&!o&&t>e||o&&s&&l&&!a&&!u||n&&s&&l||!r&&l||!i)return 1;if(!n&&!o&&!u&&t<e||u&&r&&i&&!n&&!o||a&&r&&i||!s&&i||!l)return-1}return 0}var gc=_y;function by(t,e,r){for(var n=-1,i=t.criteria,o=e.criteria,s=i.length,a=r.length;++n<s;){var l=gc(i[n],o[n]);if(l){if(n>=a)return l;var u=r[n];return l*(u=="desc"?-1:1)}}return t.index-e.index}var yc=by;function xy(t,e,r){e.length?e=br(e,function(o){return de(o)?function(s){return Tr(s,o.length===1?o[0]:o)}:o}):e=[Et];var n=-1;e=br(e,fi(lc));var i=pc(t,function(o,s,a){var l=br(e,function(u){return u(o)});return{criteria:l,index:++n,value:o}});return mc(i,function(o,s){return yc(o,s,r)})}var vc=xy;var wy=Rl(function(t,e){if(t==null)return[];var r=e.length;return r>1&&Xo(t,e[0],e[1])?e=[]:r>2&&Xo(e[0],e[1],e[2])&&(e=[e[0]]),vc(t,xu(e,1),[])}),ls=wy;var jy=t=>{let e=t.split(Ct),r=Yn();return r?e.flatMap(n=>Aa.test(n)?r.cut(n):[n]):I.splitCamelCase?[...e,...e.flatMap(Ba)]:e},Ci=class{constructor(){this.indexedDocuments=new Map;this.minisearch=new Wo(Ci.options)}async loadCache(){let e=await we.getMinisearchCache();return e?(this.minisearch=Wo.loadJS(e.data,Ci.options),this.indexedDocuments=new Map(e.paths.map(r=>[r.path,r.mtime])),!0):(console.log("Omnisearch - No cache found"),!1)}getDiff(e){let r=new Map(e.map(o=>[o.path,o.mtime])),n=e.filter(o=>!this.indexedDocuments.has(o.path)||this.indexedDocuments.get(o.path)!==o.mtime),i=[...this.indexedDocuments].filter(([o,s])=>!r.has(o)||r.get(o)!==s).map(o=>({path:o[0],mtime:o[1]}));return{toAdd:n,toRemove:i}}async addFromPaths(e){fe("Adding files",e);let r=(await Promise.all(e.map(async i=>await we.getDocument(i)))).filter(i=>!!i?.path);fe("Sorting documents to first index markdown"),r=ls(r,i=>i.path.endsWith(".md")?0:1),this.removeFromPaths(r.filter(i=>this.indexedDocuments.has(i.path)).map(i=>i.path));let n=La(r,500);for(let i of n){fe("Indexing into search engine",i),i.forEach(s=>this.indexedDocuments.set(s.path,s.mtime));let o=i.filter(s=>this.minisearch.has(s.path));this.removeFromPaths(o.map(s=>s.path)),await this.minisearch.addAllAsync(i)}}removeFromPaths(e){e.forEach(n=>this.indexedDocuments.delete(n));let r=e.filter(n=>this.minisearch.has(n));this.minisearch.discardAll(r)}async search(e,r){if(e.isEmpty())return[];fe("Starting search for",e);let n=this.minisearch.search(e.segmentsToStr(),{prefix:l=>l.length>=r.prefixLength,fuzzy:l=>l.length<=3?0:l.length<=5?.1:.2,combineWith:"AND",boost:{basename:I.weightBasename,directory:I.weightDirectory,aliases:I.weightBasename,headings1:I.weightH1,headings2:I.weightH2,headings3:I.weightH3}});if(fe("Found",n.length,"results"),e.query.ext?.length&&(n=n.filter(l=>{let u="."+l.id.split(".").pop();return e.query.ext?.some(d=>u.startsWith(d.startsWith(".")?d:"."+d))}),console.log(e.query.ext,n.length)),e.query.path&&(n=n.filter(l=>e.query.path?.some(u=>l.id.toLowerCase().includes(u.toLowerCase())))),e.query.exclude.path&&(n=n.filter(l=>!e.query.exclude.path?.some(u=>l.id.toLowerCase().includes(u.toLowerCase())))),!n.length)return[];if(r.singleFilePath)return n.filter(l=>l.id===r.singleFilePath);I.hideExcluded?n=n.filter(l=>!(app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id))):n.forEach(l=>{app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id)&&(l.score/=10)});let i=e.getTags();for(let l of i)for(let u of n)(u.tags??[]).includes(l)&&(u.score*=100);fe("Sorting and limiting results"),n=n.sort((l,u)=>u.score-l.score).slice(0,50);let o=await Promise.all(n.map(async l=>await we.getDocument(l.id))),s=e.getExactTerms();s.length&&(fe("Filtering with quoted terms"),n=n.filter(l=>{let u=o.find(c=>c.path===l.id),d=u?.path.toLowerCase()??"",f=Mo(u?.content??"").toLowerCase();return s.every(c=>f.includes(c)||d.includes(c))}));let a=e.query.exclude.text;return a.length&&(fe("Filtering with exclusions"),n=n.filter(l=>{let u=Mo(o.find(d=>d.path===l.id)?.content??"").toLowerCase();return a.every(d=>!u.includes(d))})),fe("Deduping"),n=n.filter((l,u,d)=>d.findIndex(f=>f.id===l.id)===u),n}getMatches(e,r,n){let i=new Date().getTime(),o=null,s=[],a=0;for(;(o=r.exec(e))!==null;){if(++a>=100||new Date().getTime()-i>50){Na("Stopped getMatches at",a,"results");break}let u=o[0];u&&s.push({match:u,offset:o.index})}let l=e.toLowerCase().indexOf(n.segmentsToStr());return l>-1&&s.unshift({offset:l,match:n.segmentsToStr()}),s}async getSuggestions(e,r){let n;I.simpleSearch?n=await this.search(e,{prefixLength:3,singleFilePath:r?.singleFilePath}):n=await this.search(e,{prefixLength:1,singleFilePath:r?.singleFilePath});let i=await Promise.all(n.map(async s=>await we.getDocument(s.id)));return n.map(s=>{fe("Locating matches for",s.id);let a=i.find(f=>f.path===s.id);a||(console.warn(`Omnisearch - Note "${s.id}" not in the live cache`),a={content:"",basename:s.id,path:s.id});let l=[...Object.keys(s.match),...e.getExactTerms(),...e.getTags()].filter(f=>f.length>1||/\p{Emoji}/u.test(f));fe("Matching tokens:",l),fe("Getting matches locations...");let u=this.getMatches(a.content,St(l),e);return fe("Matches:",u),ue({score:s.score,foundWords:l,matches:u},a)})}async writeToCache(){await we.writeMinisearchCache(this.minisearch,this.indexedDocuments)}},us=Ci;us.options={tokenize:jy,extractField:(e,r)=>{if(r==="directory"){let n=e.path.split("/");return n.pop(),n.join("/")}return e[r]},processTerm:e=>(I.ignoreDiacritics?ft(e):e).toLowerCase(),idField:"path",fields:["basename","directory","aliases","content","headings1","headings2","headings3"],storeFields:["tags"],logger(e,r,n){n==="version_conflict"&&new _c.Notice("Omnisearch - Your index cache may be incorrect or corrupted. If this message keeps appearing, go to Settings to clear the cache.",5e3)}};var ve=new us;var cs=new Set;function bc(t){cs.add(t)}async function Ai(){let t=[...cs].map(e=>e.path);t.length&&(ve.removeFromPaths(t),ve.addFromPaths(t),cs.clear())}var wc=Fe(xc());function jc(t,e,r){let n=t.slice();return n[35]=e[r],n[37]=r,n}function Cy(t){let e,r,n;return{c(){e=R("button"),e.textContent="Create note"},m(i,o){$(i,e,o),r||(n=Ke(e,"click",t[12]),r=!0)},p:ce,d(i){i&&H(e),r=!1,n()}}}function Ay(t){let e,r=I.showCreateButton&&Cy(t);return{c(){r&&r.c(),e=or()},m(n,i){r&&r.m(n,i),$(n,e,i)},p(n,i){I.showCreateButton&&r.p(n,i)},d(n){r&&r.d(n),n&&H(e)}}}function Cc(t){let e,r,n;return{c(){e=R("div"),r=xe("\u23F3 Work in progress: "),n=xe(t[3]),ze(e,"text-align","center"),ze(e,"color","var(--text-accent)"),ze(e,"margin-top","10px")},m(i,o){$(i,e,o),T(e,r),T(e,n)},p(i,o){o[0]&8&&Ge(n,i[3])},d(i){i&&H(e)}}}function Ac(t){let e,r;function n(...i){return t[18](t[37],...i)}return e=new rl({props:{selected:t[37]===t[0],note:t[35]}}),e.$on("mousemove",n),e.$on("click",t[10]),e.$on("auxclick",t[19]),{c(){Le(e.$$.fragment)},m(i,o){ke(e,i,o),r=!0},p(i,o){t=i;let s={};o[0]&1&&(s.selected=t[37]===t[0]),o[0]&4&&(s.note=t[35]),e.$set(s)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){re(e.$$.fragment,i),r=!1},d(i){Ee(e,i)}}}function Sy(t){let e;return{c(){e=xe("Searching...")},m(r,n){$(r,e,n)},p:ce,d(r){r&&H(e)}}}function Fy(t){let e,r=I.simpleSearch&&t[1].split(Ct).some(Fc),n,i=r&&Sc(t);return{c(){e=xe(`We found 0 result for your search here.
      `),i&&i.c(),n=or()},m(o,s){$(o,e,s),i&&i.m(o,s),$(o,n,s)},p(o,s){s[0]&2&&(r=I.simpleSearch&&o[1].split(Ct).some(Fc)),r?i||(i=Sc(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(o){o&&H(e),i&&i.d(o),o&&H(n)}}}function Sc(t){let e,r,n;return{c(){e=R("br"),r=W(),n=R("span"),n.textContent=`You have enabled "Simpler Search" in the settings, try to type more
          characters.`,ze(n,"color","var(--text-accent)"),ze(n,"font-size","small")},m(i,o){$(i,e,o),$(i,r,o),$(i,n,o)},d(i){i&&H(e),i&&H(r),i&&H(n)}}}function Ey(t){let e,r,n,i=t[2],o=[];for(let d=0;d<i.length;d+=1)o[d]=Ac(jc(t,i,d));let s=d=>re(o[d],1,1,()=>{o[d]=null});function a(d,f){if(!d[2].length&&d[1]&&!d[4])return Fy;if(d[4])return Sy}let l=a(t,[-1,-1]),u=l&&l(t);return{c(){for(let d=0;d<o.length;d+=1)o[d].c();e=W(),r=R("div"),u&&u.c(),ze(r,"text-align","center")},m(d,f){for(let c=0;c<o.length;c+=1)o[c].m(d,f);$(d,e,f),$(d,r,f),u&&u.m(r,null),n=!0},p(d,f){if(f[0]&3077){i=d[2];let c;for(c=0;c<i.length;c+=1){let y=jc(d,i,c);o[c]?(o[c].p(y,f),ee(o[c],1)):(o[c]=Ac(y),o[c].c(),ee(o[c],1),o[c].m(e.parentNode,e))}for(Lt(),c=i.length;c<o.length;c+=1)s(c);Bt()}l===(l=a(d,f))&&u?u.p(d,f):(u&&u.d(1),u=l&&l(d),u&&(u.c(),u.m(r,null)))},i(d){if(!n){for(let f=0;f<i.length;f+=1)ee(o[f]);n=!0}},o(d){o=o.filter(Boolean);for(let f=0;f<o.length;f+=1)re(o[f]);n=!1},d(d){bn(o,d),d&&H(e),d&&H(r),u&&u.d()}}}function Dy(t){let e,r,n,i,o,s,a,l,u,d,f,c,y,w,x,b,h,_,p,m,v,g,j,C,S,E,P,L,k,z,J,Q,Z,A,F,D,N,O,X,le,_e,Ce={initialValue:t[1],placeholder:"Omnisearch - Vault",$$slots:{default:[Ay]},$$scope:{ctx:t}};e=new ei({props:Ce}),t[16](e),e.$on("input",t[17]);let te=t[3]&&Cc(t);return i=new ti({props:{$$slots:{default:[Ey]},$$scope:{ctx:t}}}),{c(){Le(e.$$.fragment),r=W(),te&&te.c(),n=W(),Le(i.$$.fragment),o=W(),s=R("div"),a=R("div"),a.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',l=W(),u=R("div"),u.innerHTML=`<span class="prompt-instruction-command">alt \u2191\u2193</span> 
    <span>to cycle history</span>`,d=W(),f=R("div"),c=R("span"),y=xe(t[7]),w=R("span"),w.textContent="to open",x=W(),b=R("div"),b.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to In-File Search</span>`,h=W(),_=R("div"),p=R("span"),m=xe(t[6]),v=W(),g=R("span"),g.textContent="to open in a new pane",j=W(),C=R("div"),S=R("span"),E=xe(t[9]),P=W(),L=R("span"),L.textContent="to create",k=W(),z=R("div"),J=R("span"),Q=xe(t[8]),Z=W(),A=R("span"),A.textContent="to create in a new pane",F=W(),D=R("div"),D.innerHTML=`<span class="prompt-instruction-command">alt \u21B5</span> 
    <span>to insert a link</span>`,N=W(),O=R("div"),O.innerHTML=`<span class="prompt-instruction-command">ctrl+h</span> 
    <span>to toggle excerpts</span>`,X=W(),le=R("div"),le.innerHTML='<span class="prompt-instruction-command">esc</span><span>to close</span>',B(a,"class","prompt-instruction"),B(u,"class","prompt-instruction"),B(c,"class","prompt-instruction-command"),B(f,"class","prompt-instruction"),B(b,"class","prompt-instruction"),B(p,"class","prompt-instruction-command"),B(_,"class","prompt-instruction"),B(S,"class","prompt-instruction-command"),B(C,"class","prompt-instruction"),B(J,"class","prompt-instruction-command"),B(z,"class","prompt-instruction"),B(D,"class","prompt-instruction"),B(O,"class","prompt-instruction"),B(le,"class","prompt-instruction"),B(s,"class","prompt-instructions")},m(q,ge){ke(e,q,ge),$(q,r,ge),te&&te.m(q,ge),$(q,n,ge),ke(i,q,ge),$(q,o,ge),$(q,s,ge),T(s,a),T(s,l),T(s,u),T(s,d),T(s,f),T(f,c),T(c,y),T(f,w),T(s,x),T(s,b),T(s,h),T(s,_),T(_,p),T(p,m),T(_,v),T(_,g),T(s,j),T(s,C),T(C,S),T(S,E),T(C,P),T(C,L),T(s,k),T(s,z),T(z,J),T(J,Q),T(z,Z),T(z,A),T(s,F),T(s,D),T(s,N),T(s,O),T(s,X),T(s,le),_e=!0},p(q,ge){let Ei={};ge[0]&2&&(Ei.initialValue=q[1]),ge[1]&128&&(Ei.$$scope={dirty:ge,ctx:q}),e.$set(Ei),q[3]?te?te.p(q,ge):(te=Cc(q),te.c(),te.m(n.parentNode,n)):te&&(te.d(1),te=null);let ms={};ge[0]&23|ge[1]&128&&(ms.$$scope={dirty:ge,ctx:q}),i.$set(ms),(!_e||ge[0]&128)&&Ge(y,q[7]),(!_e||ge[0]&64)&&Ge(m,q[6]),(!_e||ge[0]&512)&&Ge(E,q[9]),(!_e||ge[0]&256)&&Ge(Q,q[8])},i(q){_e||(ee(e.$$.fragment,q),ee(i.$$.fragment,q),_e=!0)},o(q){re(e.$$.fragment,q),re(i.$$.fragment,q),_e=!1},d(q){t[16](null),Ee(e,q),q&&H(r),te&&te.d(q),q&&H(n),Ee(i,q),q&&H(o),q&&H(s)}}}var Fc=t=>t.length<3;function Ty(t,e,r){let n,i;_n(t,jt,O=>r(15,i=O));let{modal:o}=e,{previousQuery:s}=e,a=0,l=0,u,d=[],f,c="",y=!0,w,x,b,h,_;Br(async()=>{U.enable("vault"),U.on("vault","enter",C),U.on("vault","create-note",k),U.on("vault","open-in-new-pane",S),U.on("vault","insert-link",z),U.on("vault","tab",J),U.on("vault","arrow-up",()=>Q(-1)),U.on("vault","arrow-down",()=>Q(1)),U.on("vault","prev-search-history",p),U.on("vault","next-search-history",m),await Ai(),I.showPreviousQueryResults&&r(13,s=(await we.getSearchHistory())[0])}),Nr(()=>{U.disable("vault")});async function p(){let O=(await we.getSearchHistory()).filter(X=>X);++l>=O.length&&(l=0),r(1,u=O[l]),w?.setInputValue(u)}async function m(){let O=(await we.getSearchHistory()).filter(X=>X);--l<0&&(l=O.length?O.length-1:0),r(1,u=O[l]),w?.setInputValue(u)}let v=null;async function g(){v&&(v.cancel(),v=null),f=new Yt(u),v=(0,wc.cancelable)(new Promise(O=>{O(ve.getSuggestions(f))})),r(2,d=await v),r(0,a=0),await Z()}function j(O){!n||(O?.ctrlKey?S():C(),o.close())}function C(){!n||(P(n),o.close())}function S(){!n||(P(n,!0),o.close())}function E(){u&&we.addToSearchHistory(u)}function P(O,X=!1){E(),ri(O,X)}async function L(O){await k()}async function k(O){if(u){try{await Ua(u,O?.newLeaf)}catch(X){new Mt.Notice(X.message);return}o.close()}}function z(){if(!n)return;let O=app.vault.getMarkdownFiles().find(te=>te.path===n.path),X=app.workspace.getActiveFile(),le=app.workspace.getActiveViewOfType(Mt.MarkdownView);if(!le?.editor){new Mt.Notice("Omnisearch - Error - No active editor",3e3);return}let _e;O&&X?_e=app.fileManager.generateMarkdownLink(O,X.path):_e=`[[${n.basename}.${qt(n.path)}]]`;let Ce=le.editor.getCursor();le.editor.replaceRange(_e,Ce,Ce),Ce.ch+=_e.length,le.editor.setCursor(Ce),o.close()}function J(){if(!(n&&(fn(n?.path)||!n?.matches.length)))if(E(),o.close(),n){let O=app.vault.getAbstractFileByPath(n.path);O&&O instanceof Mt.TFile&&new kr(app,O,u).open()}else{let O=app.workspace.getActiveViewOfType(Mt.MarkdownView);O&&new kr(app,O.file,u).open()}}function Q(O){r(0,a=Xn(a+O,d.length)),Z()}async function Z(){await mt(),n&&activeWindow.document.querySelector(`[data-result-id="${n.path}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}function A(O){tt[O?"unshift":"push"](()=>{w=O,r(5,w)})}let F=O=>r(1,u=O.detail),D=(O,X)=>r(0,a=O),N=O=>{O.button==1&&S()};t.$$set=O=>{"modal"in O&&r(14,o=O.modal),"previousQuery"in O&&r(13,s=O.previousQuery)},t.$$.update=()=>{if(t.$$.dirty[0]&8194){e:r(1,u=u??s)}if(t.$$.dirty[0]&2){e:u?(r(4,y=!0),g().then(()=>{r(4,y=!1)})):(r(4,y=!1),r(2,d=[]))}if(t.$$.dirty[0]&5){e:n=d[a]}if(t.$$.dirty[0]&32768){e:switch(i){case We.LoadingCache:r(3,c="Loading cache...");break;case We.ReadingFiles:r(3,c="Reading files...");break;case We.IndexingFiles:r(3,c="Indexing files...");break;case We.WritingCache:g(),r(3,c="Updating cache...");break;default:g(),r(3,c="");break}}};e:I.openInNewPane?(r(6,x="\u21B5"),r(7,b=Qt()+" \u21B5"),r(8,h="shift \u21B5"),r(9,_=Qt()+" shift \u21B5")):(r(6,x=Qt()+" \u21B5"),r(7,b="\u21B5"),r(8,h=Qt()+" shift \u21B5"),r(9,_="shift \u21B5"));return[a,u,d,c,y,w,x,b,h,_,j,S,L,s,o,i,A,F,D,N]}var Ec=class extends Ae{constructor(e){super();De(this,e,Ty,Dy,be,{modal:14,previousQuery:13},null,[-1,-1])}},Dc=Ec;var Oc=Fe(require("obsidian"));function Iy(t){let e,r=t[2].replace(t[3],At)+"";return{c(){e=R("div"),B(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&12&&r!==(r=n[2].replace(n[3],At)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function Oy(t){let e,r;return e=new ni({props:{id:t[0].toString(),selected:t[1],$$slots:{default:[Iy]},$$scope:{ctx:t}}}),e.$on("mousemove",t[6]),e.$on("click",t[7]),e.$on("auxclick",t[8]),{c(){Le(e.$$.fragment)},m(n,i){ke(e,n,i),r=!0},p(n,[i]){let o={};i&1&&(o.id=n[0].toString()),i&2&&(o.selected=n[1]),i&524&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function ky(t,e,r){let n,i,{offset:o}=e,{note:s}=e,{index:a=0}=e,{selected:l=!1}=e;function u(c){$e.call(this,t,c)}function d(c){$e.call(this,t,c)}function f(c){$e.call(this,t,c)}return t.$$set=c=>{"offset"in c&&r(4,o=c.offset),"note"in c&&r(5,s=c.note),"index"in c&&r(0,a=c.index),"selected"in c&&r(1,l=c.selected)},t.$$.update=()=>{if(t.$$.dirty&32){e:r(3,n=St(s.foundWords))}if(t.$$.dirty&48){e:r(2,i=yr(s?.content??"",o))}},[a,l,i,n,o,s,u,d,f]}var Tc=class extends Ae{constructor(e){super();De(this,e,ky,Oy,be,{offset:4,note:5,index:0,selected:1})}},Ic=Tc;function kc(t,e,r){let n=t.slice();return n[19]=e[r],n[21]=r,n}function Py(t){let e;return{c(){e=R("div"),e.textContent="We found 0 result for your search here.",ze(e,"text-align","center")},m(r,n){$(r,e,n)},p:ce,i:ce,o:ce,d(r){r&&H(e)}}}function My(t){let e,r,n=t[4],i=[];for(let s=0;s<n.length;s+=1)i[s]=Pc(kc(t,n,s));let o=s=>re(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=or()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);$(s,e,a),r=!0},p(s,a){if(a&120){n=s[4];let l;for(l=0;l<n.length;l+=1){let u=kc(s,n,l);i[l]?(i[l].p(u,a),ee(i[l],1)):(i[l]=Pc(u),i[l].c(),ee(i[l],1),i[l].m(e.parentNode,e))}for(Lt(),l=n.length;l<i.length;l+=1)o(l);Bt()}},i(s){if(!r){for(let a=0;a<n.length;a+=1)ee(i[a]);r=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)re(i[a]);r=!1},d(s){bn(i,s),s&&H(e)}}}function Pc(t){let e,r;function n(...i){return t[11](t[21],...i)}return e=new Ic({props:{offset:t[19],note:t[3],index:t[21],selected:t[21]===t[5]}}),e.$on("mousemove",n),e.$on("click",t[12]),e.$on("auxclick",t[13]),{c(){Le(e.$$.fragment)},m(i,o){ke(e,i,o),r=!0},p(i,o){t=i;let s={};o&16&&(s.offset=t[19]),o&8&&(s.note=t[3]),o&32&&(s.selected=t[21]===t[5]),e.$set(s)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){re(e.$$.fragment,i),r=!1},d(i){Ee(e,i)}}}function Ry(t){let e,r,n,i,o=[My,Py],s=[];function a(l,u){return l[4].length&&l[3]?0:1}return e=a(t,-1),r=s[e]=o[e](t),{c(){r.c(),n=or()},m(l,u){s[e].m(l,u),$(l,n,u),i=!0},p(l,u){let d=e;e=a(l,u),e===d?s[e].p(l,u):(Lt(),re(s[d],1,1,()=>{s[d]=null}),Bt(),r=s[e],r?r.p(l,u):(r=s[e]=o[e](l),r.c()),ee(r,1),r.m(n.parentNode,n))},i(l){i||(ee(r),i=!0)},o(l){re(r),i=!1},d(l){s[e].d(l),l&&H(n)}}}function Ly(t){let e;return{c(){e=R("span"),e.textContent="to close"},m(r,n){$(r,e,n)},d(r){r&&H(e)}}}function By(t){let e;return{c(){e=R("span"),e.textContent="to go back to Vault Search"},m(r,n){$(r,e,n)},d(r){r&&H(e)}}}function Ny(t){let e,r,n,i,o,s,a,l,u,d,f,c,y,w,x,b,h,_,p,m;e=new ei({props:{placeholder:"Omnisearch - File",initialValue:t[1]}}),e.$on("input",t[10]),n=new ti({props:{$$slots:{default:[Ry]},$$scope:{ctx:t}}});function v(C,S){return C[0]?By:Ly}let g=v(t,-1),j=g(t);return{c(){Le(e.$$.fragment),r=W(),Le(n.$$.fragment),i=W(),o=R("div"),s=R("div"),s.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=W(),l=R("div"),l.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',u=W(),d=R("div"),d.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to Vault Search</span>`,f=W(),c=R("div"),y=R("span"),y.textContent="esc",w=W(),j.c(),x=W(),b=R("div"),h=R("span"),h.textContent=`${Qt()} \u21B5`,_=W(),p=R("span"),p.textContent="to open in a new pane",B(s,"class","prompt-instruction"),B(l,"class","prompt-instruction"),B(d,"class","prompt-instruction"),B(y,"class","prompt-instruction-command"),B(c,"class","prompt-instruction"),B(h,"class","prompt-instruction-command"),B(b,"class","prompt-instruction"),B(o,"class","prompt-instructions")},m(C,S){ke(e,C,S),$(C,r,S),ke(n,C,S),$(C,i,S),$(C,o,S),T(o,s),T(o,a),T(o,l),T(o,u),T(o,d),T(o,f),T(o,c),T(c,y),T(c,w),j.m(c,null),T(o,x),T(o,b),T(b,h),T(b,_),T(b,p),m=!0},p(C,[S]){let E={};S&2&&(E.initialValue=C[1]),e.$set(E);let P={};S&4194360&&(P.$$scope={dirty:S,ctx:C}),n.$set(P),g!==(g=v(C,S))&&(j.d(1),j=g(C),j&&(j.c(),j.m(c,null)))},i(C){m||(ee(e.$$.fragment,C),ee(n.$$.fragment,C),m=!0)},o(C){re(e.$$.fragment,C),re(n.$$.fragment,C),m=!1},d(C){Ee(e,C),C&&H(r),Ee(n,C),C&&H(i),C&&H(o),j.d()}}}function Ky(t,e,r){let n=t.find(i=>i.offset>e);return n?t.filter(i=>i.offset>e&&i.offset<=n.offset+r):[]}function zy(t,e,r){let{modal:n}=e,{parent:i=null}=e,{singleFilePath:o=""}=e,{previousQuery:s}=e,a,l=[],u=0,d,f;Br(()=>{U.enable("infile"),U.on("infile","enter",b),U.on("infile","open-in-new-pane",x),U.on("infile","arrow-up",()=>y(-1)),U.on("infile","arrow-down",()=>y(1)),U.on("infile","tab",h)}),Nr(()=>{U.disable("infile")});function c(g){let j=[],C=-1,S=0;for(;;){let E=Ky(g,C,ln);if(!E.length||(C=E.last().offset,j.push(E),++S>100))break}return j}function y(g){r(5,u=Xn(u+g,l.length)),w()}async function w(){await mt(),document.querySelector(`[data-result-id="${u}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}async function x(){return b(!0)}async function b(g=!1){if(d){n.close(),i&&i.close(),await ri(d,g);let j=app.workspace.getActiveViewOfType(Oc.MarkdownView);if(!j)return;let C=l[u]??0,S=j.editor.offsetToPos(C);S.ch=0,j.editor.setCursor(S),j.editor.scrollIntoView({from:{line:S.line-10,ch:0},to:{line:S.line+10,ch:0}})}}function h(){new Zt(app,a??s).open(),n.close()}let _=g=>r(2,a=g.detail),p=(g,j)=>r(5,u=g),m=g=>b(g.ctrlKey),v=g=>{g.button==1&&b(!0)};return t.$$set=g=>{"modal"in g&&r(7,n=g.modal),"parent"in g&&r(0,i=g.parent),"singleFilePath"in g&&r(8,o=g.singleFilePath),"previousQuery"in g&&r(1,s=g.previousQuery)},t.$$.update=()=>{if(t.$$.dirty&2){e:r(2,a=s??"")}if(t.$$.dirty&772){e:(async()=>{a&&(r(9,f=new Yt(a)),r(3,d=(await ve.getSuggestions(f,{singleFilePath:o}))[0]??null)),r(5,u=0),await w()})()}if(t.$$.dirty&8){e:if(d){let g=c(d.matches);r(4,l=g.map(j=>Math.round((j.first().offset+j.last().offset)/2)))}}},[i,s,a,d,l,u,b,n,o,f,_,p,m,v]}var Mc=class extends Ae{constructor(e){super();De(this,e,zy,Ny,be,{modal:7,parent:0,singleFilePath:8,previousQuery:1})}},Rc=Mc;var ds=class extends Lc.Modal{constructor(e){super(e);this.modalEl.replaceChildren(),this.modalEl.addClass("omnisearch-modal","prompt"),this.modalEl.removeClass("modal"),this.modalEl.tabIndex=-1,this.scope.register([],"ArrowDown",s=>{s.preventDefault(),U.emit("arrow-down")}),this.scope.register([],"ArrowUp",s=>{s.preventDefault(),U.emit("arrow-up")});for(let s of[{k:"J",dir:"down"},{k:"K",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],s.k,l=>{this.app.vault.getConfig("vimMode")&&U.emit("arrow-"+s.dir)});for(let s of[{k:"N",dir:"down"},{k:"P",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],s.k,l=>{this.app.vault.getConfig("vimMode")&&U.emit("arrow-"+s.dir)});let r,n,i,o;I.openInNewPane?(r=["Mod"],n=[],i=["Mod","Shift"],o=["Shift"]):(r=[],n=["Mod"],i=["Shift"],o=["Mod","Shift"]),this.scope.register(n,"Enter",s=>{s.preventDefault(),U.emit("open-in-new-pane")}),this.scope.register(["Alt"],"Enter",s=>{s.preventDefault(),U.emit("insert-link")}),this.scope.register(i,"Enter",s=>{s.preventDefault(),U.emit("create-note")}),this.scope.register(o,"Enter",s=>{s.preventDefault(),U.emit("create-note",{newLeaf:!0})}),this.scope.register(r,"Enter",s=>{Da()||(s.preventDefault(),U.emit("enter"))}),this.scope.register([],"Tab",s=>{s.preventDefault(),U.emit("tab")}),this.scope.register(["Alt"],"ArrowDown",s=>{s.preventDefault(),U.emit("next-search-history")}),this.scope.register(["Alt"],"ArrowUp",s=>{s.preventDefault(),U.emit("prev-search-history")}),this.scope.register(["Ctrl"],"H",s=>{U.emit(qn.ToggleExcerpts)})}},Zt=class extends ds{constructor(e,r){super(e);let n=new Dc({target:this.modalEl,props:{modal:this,previousQuery:r}});this.onClose=()=>{n.$destroy()}}},kr=class extends ds{constructor(e,r,n="",i){super(e);let o=new Rc({target:this.modalEl,props:{modal:this,singleFilePath:r.path,parent:i,previousQuery:n}});i&&i.containerEl.toggleVisibility(!1),this.onClose=()=>{i&&i.containerEl.toggleVisibility(!0),o.$destroy()}}};var Bc=!1,Fi=[];function Vy(t){return t.map(e=>{let{score:r,path:n,basename:i,foundWords:o,matches:s,content:a}=e,l=yr(a,s[0]?.offset??-1);return{score:r,path:n,basename:i,foundWords:o,matches:s.map(u=>({match:u.match,offset:u.offset})),excerpt:l}})}async function Hy(t){let e=new Yt(t),r=await ve.getSuggestions(e);return Vy(r)}function $y(t){Fi.push(t),Bc&&t()}function Wy(t){Fi=Fi.filter(e=>e!==t)}function Nc(){Bc=!0,Fi.forEach(t=>t())}var hs={search:Hy,registerOnIndexed:$y,unregisterOnIndexed:Wy,refreshIndex:Ai};var ps=class extends Pr.Plugin{async onload(){if(await ja(this),this.addSettingTab(new Io(this)),Oo()){console.log("Omnisearch - Plugin disabled");return}await Uy(),await gr.clearOldDatabases(),Gy(this),I.ribbonIcon&&this.addRibbonButton(),U.disable("vault"),U.disable("infile"),U.on("global",qn.ToggleExcerpts,()=>{Ut.set(!I.showExcerpt)}),this.addCommand({id:"show-modal",name:"Vault search",callback:()=>{new Zt(app).open()}}),this.addCommand({id:"show-modal-infile",name:"In-file search",editorCallback:(e,r)=>{r.file&&new kr(app,r.file).open()}}),app.workspace.onLayoutReady(async()=>{this.registerEvent(this.app.vault.on("create",e=>{cn(e.path)&&(fe("Indexing new file",e.path),ve.addFromPaths([e.path]))})),this.registerEvent(this.app.vault.on("delete",e=>{fe("Removing file",e.path),we.removeFromLiveCache(e.path),ve.removeFromPaths([e.path])})),this.registerEvent(this.app.vault.on("modify",async e=>{cn(e.path)&&(fe("Updating file",e.path),await we.addToLiveCache(e.path),bc(e))})),this.registerEvent(this.app.vault.on("rename",async(e,r)=>{cn(e.path)&&(fe("Renaming file",e.path),we.removeFromLiveCache(r),we.addToLiveCache(e.path),ve.removeFromPaths([r]),await ve.addFromPaths([e.path]))})),this.executeFirstLaunchTasks(),await this.populateIndex()})}executeFirstLaunchTasks(){let e="1.10.1";if(I.welcomeMessage!==e){let r=new DocumentFragment;r.createSpan({},n=>{n.innerHTML="\u{1F50E} Omnisearch now requires the <strong>Text Extractor</strong> plugin to index PDF and images. See Omnisearch settings for more information."}),new Pr.Notice(r,2e4)}I.welcomeMessage=e,this.saveData(I)}async onunload(){delete globalThis.omnisearch,await Be.clearCache()}addRibbonButton(){this.ribbonButton=this.addRibbonIcon("search","Omnisearch",e=>{new Zt(app).open()})}removeRibbonButton(){this.ribbonButton&&this.ribbonButton.parentNode?.removeChild(this.ribbonButton)}async populateIndex(){console.time("Omnisearch - Indexing total time"),jt.set(We.ReadingFiles);let e=app.vault.getFiles().filter(n=>cn(n.path));console.log(`Omnisearch - ${e.length} files total`),console.log(`Omnisearch - Cache is ${wt()?"enabled":"disabled"}`),wt()&&(console.time("Omnisearch - Loading index from cache"),jt.set(We.LoadingCache),await ve.loadCache()&&console.timeEnd("Omnisearch - Loading index from cache"));let r=ve.getDiff(e.map(n=>({path:n.path,mtime:n.stat.mtime})));wt()&&(r.toAdd.length&&console.log("Omnisearch - Total number of files to add/update: "+r.toAdd.length),r.toRemove.length&&console.log("Omnisearch - Total number of files to remove: "+r.toRemove.length)),r.toAdd.length>=1e3&&wt()&&new Pr.Notice(`Omnisearch - ${r.toAdd.length} files need to be indexed. Obsidian may experience stutters and freezes during the process`,1e4),jt.set(We.IndexingFiles),ve.removeFromPaths(r.toRemove.map(n=>n.path)),await ve.addFromPaths(r.toAdd.map(n=>n.path)),(r.toRemove.length||r.toAdd.length)&&wt()&&(jt.set(We.WritingCache),I.useCache=!1,pe(this),await ve.writeToCache(),I.useCache=!0,pe(this)),console.timeEnd("Omnisearch - Indexing total time"),r.toAdd.length>=1e3&&new Pr.Notice("Omnisearch - Your files have been indexed."),jt.set(We.Done),Nc()}};async function Uy(){let t=[`${app.vault.configDir}/plugins/omnisearch/searchIndex.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.data`,`${app.vault.configDir}/plugins/omnisearch/searchIndex.data`,`${app.vault.configDir}/plugins/omnisearch/historyCache.json`,`${app.vault.configDir}/plugins/omnisearch/pdfCache.data`];for(let e of t)if(await app.vault.adapter.exists(e))try{await app.vault.adapter.remove(e)}catch{}}function Gy(t){t.registerObsidianProtocolHandler("omnisearch",e=>{new Zt(app,e.query).open()}),globalThis.omnisearch=hs,app.plugins.plugins.omnisearch.api=hs}
